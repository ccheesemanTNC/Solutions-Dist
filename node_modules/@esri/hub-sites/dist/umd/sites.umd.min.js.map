{"version":3,"file":"sites.umd.min.js","sources":["../esm/drafts/page-draft-include-list.js","../esm/drafts/site-draft-include-list.js","../esm/drafts/unpublished-changes-kw.js","../esm/is-site.js","../esm/unlink-site-and-page.js","../../../../node_modules/tslib/tslib.es6.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/process-params.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/encode-query-string.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/ArcGISRequestError.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/warn.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/request.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/encode-form-data.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/append-custom-params.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/get-portal-url.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/clean-url.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/helpers.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/update.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/create.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/scrub-control-chars.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/get.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/protect.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/sharing/helpers.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/get.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/remove.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/SearchQueryBuilder.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/search.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/generic-search.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/array.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/add-users.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/remove-users.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/update-user-membership.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/users/get-user.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/sharing/share-item-with-group.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/sharing/is-item-shared-with-group.js","../esm/pages/update-page.js","../esm/layout/get-card-dependencies.js","../esm/layout/get-row-dependencies.js","../esm/layout/get-section-dependencies.js","../esm/layout/get-layout-dependencies.js","../esm/pages/get-page-item-type.js","../esm/pages/page-type-keyword.js","../esm/pages/ensure-required-page-properties.js","../esm/link-site-and-page.js","../esm/layout/_get-image-crop-ids-from-layout.js","../esm/layout/convert-card.js","../esm/layout/convert-row.js","../esm/layout/extract-assets.js","../esm/layout/convert-section.js","../esm/layout/convert-layout-to-template.js","../esm/layout/remove-unused-resources.js","../esm/get-site-dependencies.js","../esm/drafts/_draft-resource-regex.js","../esm/pages/is-page.js","../esm/drafts/_include-list-from-item-type.js","../esm/drafts/has-unpublished-changes.js","../esm/site-ui-version.js","../esm/_get-portal-domain-type-keyword.js","../esm/_ensure-portal-domain-keyword.js","../esm/update-site.js","../esm/drafts/_get-draft-resource-names.js","../esm/drafts/delete-draft.js","../esm/drafts/get-draft-date.js","../esm/drafts/_get-most-recent-draft-name.js","../esm/drafts/upgrade-draft-schema.js","../esm/drafts/fetch-draft.js","../esm/drafts/apply-draft.js","../esm/get-domain.js","../esm/_remove-site-groups.js","../esm/_remove-parent-initiative.js","../esm/_remove-site-from-index.js","../esm/_remove-site-domains.js","../esm/get-site-item-type.js","../esm/_ensure-type-and-tags.js","../esm/update-app-redirect-uris.js","../esm/unlink-pages-from-site.js","../esm/ensure-required-site-properties.js","../esm/get-portal-site-hostname.js","../esm/get-portal-site-url.js","../esm/get-theme.js","../esm/_create-site-initiative.js","../esm/_update-team-tags.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/update.js","../esm/interpolate-site.js","../esm/create-site-model-from-template.js","../esm/_get-second-pass-sharing-options.js","../esm/_get-sharing-eligible-models.js","../esm/_share-items-to-site-groups.js","../esm/_second-pass-adlib-pages.js","../esm/_update-pages.js","../esm/get-members.js","../esm/pages/page-template-keyword.js","../esm/_add-site-domains.js","../esm/_ensure-optional-groups-templating.js","../esm/_get-site-data-by-id.js","../esm/pages/convert-page-to-template.js","../esm/convert-site-to-template.js","../esm/pages/create-page.js","../esm/pages/create-page-model-from-template.js","../esm/create-site.js","../esm/ensure-optional-groups-templating.js","../esm/pages/ensure-page-has-site-entry.js","../esm/drafts/fetch-and-apply-draft.js","../esm/get-data-for-site-item.js","../esm/pages/get-page-dependencies.js","../esm/pages/get-page-edit-url.js","../esm/get-site-edit-url.js","../esm/drafts/mark-published.js","../esm/drafts/mark-unpublished.js","../esm/register-browser-app.js","../esm/register-site-as-application.js","../esm/pages/remove-page.js","../esm/remove-site.js","../esm/pages/remove-site-from-page.js","../esm/drafts/save-draft.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/add.js","../esm/drafts/save-published-status.js","../esm/site-second-pass.js","../esm/update-site-application-uris.js"],"sourcesContent":["/**\n * This is the list of page model properties\n * that are included in a page's draft\n */\nexport var PAGE_DRAFT_INCLUDE_LIST = [\n    \"item.title\",\n    \"item.snippet\",\n    \"data.values.layout\"\n];\n//# sourceMappingURL=page-draft-include-list.js.map","/**\n * This is the list of site model properties\n * that are included in a site's draft\n */\nexport var SITE_DRAFT_INCLUDE_LIST = [\n    \"item.title\",\n    \"item.snippet\",\n    \"item.properties.schemaVersion\",\n    \"data.values.layout\",\n    \"data.values.theme\",\n    \"data.values.headerCss\",\n    \"data.values.headerSass\",\n    \"data.values.footerSass\",\n    \"data.values.footerCss\",\n    \"data.values.faviconUrl\",\n    \"data.values.telemetry\",\n    \"data.values.map\",\n    \"data.values.capabilities\",\n    \"data.values.contentViews\",\n];\n//# sourceMappingURL=site-draft-include-list.js.map","export var UNPUBLISHED_CHANGES_KW = \"state:hasUnpublishedChanges\";\n//# sourceMappingURL=unpublished-changes-kw.js.map","import { normalizeItemType } from \"@esri/hub-common\";\n/**\n * Determines whether an item is a site item or not\n * @param item - the item\n */\nexport function isSite(item) {\n    return normalizeItemType(item) === \"Hub Site Application\";\n}\n//# sourceMappingURL=is-site.js.map","import { getModelFromOptions, withoutByProp, getWithDefault, maybePush, getProp, failSafeUpdate, failSafe, unshareItemFromGroups } from \"@esri/hub-common\";\n/**\n * Unlink a Page from a Site and vice-versa\n * This is a super tolerant function. It can be passed ids, models or a mix.\n * It will handle either the site or the page items being missing\n * It will handle cases where the current user lacks update privs to either item or rights\n * to change the sharing. Of course in those cases we clearly can't make the changes, and\n * this function will resolve as though they were made, usually the UI tier will have\n * ensured that the current user has write access to at least one of the main entities\n * @param {IUnlinkRequestOptions} unlinkRequestOptions {siteModel || siteId, pageModel || pageId, authorization...}\n */\nexport function unlinkSiteAndPage(unlinkRequestOptions) {\n    var unshareGroups = [];\n    var promises = [];\n    var pageModel;\n    var siteModel;\n    var requestOptions = {\n        authentication: unlinkRequestOptions.authentication\n    };\n    // get the models from the options...\n    return Promise.all([\n        getModelFromOptions(\"page\", unlinkRequestOptions),\n        getModelFromOptions(\"site\", unlinkRequestOptions)\n    ])\n        .then(function (models) {\n        pageModel = models[0], siteModel = models[1];\n        // Handle the site\n        if (!siteModel.isMissing) {\n            var pages = getWithDefault(siteModel, \"data.values.pages\", []);\n            // remove the page from the pages array on the model\n            siteModel.data.values.pages = withoutByProp(\"id\", pageModel.item.id, pages);\n            // collect the groups we'll unshare the page from\n            unshareGroups = maybePush(getProp(siteModel, \"item.properties.collaborationGroupId\"), unshareGroups);\n            unshareGroups = maybePush(getProp(siteModel, \"item.properties.contentGroupId\"), unshareGroups);\n            // update the site, but failSafe so we don't have to do any checking if the current user can update it\n            promises.push(failSafeUpdate(siteModel, requestOptions));\n        }\n        // Handle the page\n        if (!pageModel.isMissing) {\n            var sites = getWithDefault(pageModel, \"data.values.sites\", []);\n            // remove site from sites array on the model\n            pageModel.data.values.sites = withoutByProp(\"id\", siteModel.item.id, sites);\n            promises.push(failSafeUpdate(pageModel, requestOptions));\n            // now about the groups\n            var failSafeUnshare = failSafe(unshareItemFromGroups);\n            promises.push(failSafeUnshare(pageModel.item.id, unshareGroups, requestOptions));\n        }\n        return Promise.all(promises);\n    })\n        .then(function () {\n        // return the updated models\n        return {\n            pageModel: pageModel,\n            siteModel: siteModel\n        };\n    });\n}\n//# sourceMappingURL=unlink-site-and-page.js.map","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Checks parameters to see if we should use FormData to send the request\n * @param params The object whose keys will be encoded.\n * @return A boolean indicating if FormData will be required.\n */\nexport function requiresFormData(params) {\n    return Object.keys(params).some(function (key) {\n        var value = params[key];\n        if (!value) {\n            return false;\n        }\n        if (value && value.toParam) {\n            value = value.toParam();\n        }\n        var type = value.constructor.name;\n        switch (type) {\n            case \"Array\":\n                return false;\n            case \"Object\":\n                return false;\n            case \"Date\":\n                return false;\n            case \"Function\":\n                return false;\n            case \"Boolean\":\n                return false;\n            case \"String\":\n                return false;\n            case \"Number\":\n                return false;\n            default:\n                return true;\n        }\n    });\n}\n/**\n * Converts parameters to the proper representation to send to the ArcGIS REST API.\n * @param params The object whose keys will be encoded.\n * @return A new object with properly encoded values.\n */\nexport function processParams(params) {\n    var newParams = {};\n    Object.keys(params).forEach(function (key) {\n        var _a, _b;\n        var param = params[key];\n        if (param && param.toParam) {\n            param = param.toParam();\n        }\n        if (!param &&\n            param !== 0 &&\n            typeof param !== \"boolean\" &&\n            typeof param !== \"string\") {\n            return;\n        }\n        var type = param.constructor.name;\n        var value;\n        // properly encodes objects, arrays and dates for arcgis.com and other services.\n        // ported from https://github.com/Esri/esri-leaflet/blob/master/src/Request.js#L22-L30\n        // also see https://github.com/Esri/arcgis-rest-js/issues/18:\n        // null, undefined, function are excluded. If you want to send an empty key you need to send an empty string \"\".\n        switch (type) {\n            case \"Array\":\n                // Based on the first element of the array, classify array as an array of arrays, an array of objects\n                // to be stringified, or an array of non-objects to be comma-separated\n                // eslint-disable-next-line no-case-declarations\n                var firstElementType = (_b = (_a = param[0]) === null || _a === void 0 ? void 0 : _a.constructor) === null || _b === void 0 ? void 0 : _b.name;\n                value =\n                    firstElementType === \"Array\" ? param : // pass thru array of arrays\n                        firstElementType === \"Object\" ? JSON.stringify(param) : // stringify array of objects\n                            param.join(\",\"); // join other types of array elements\n                break;\n            case \"Object\":\n                value = JSON.stringify(param);\n                break;\n            case \"Date\":\n                value = param.valueOf();\n                break;\n            case \"Function\":\n                value = null;\n                break;\n            case \"Boolean\":\n                value = param + \"\";\n                break;\n            default:\n                value = param;\n                break;\n        }\n        if (value || value === 0 || typeof value === \"string\" || Array.isArray(value)) {\n            newParams[key] = value;\n        }\n    });\n    return newParams;\n}\n//# sourceMappingURL=process-params.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { processParams } from \"./process-params\";\n/**\n * Encodes keys and parameters for use in a URL's query string.\n *\n * @param key Parameter's key\n * @param value Parameter's value\n * @returns Query string with key and value pairs separated by \"&\"\n */\nexport function encodeParam(key, value) {\n    // For array of arrays, repeat key=value for each element of containing array\n    if (Array.isArray(value) && value[0] && Array.isArray(value[0])) {\n        return value.map(function (arrayElem) { return encodeParam(key, arrayElem); }).join(\"&\");\n    }\n    return encodeURIComponent(key) + \"=\" + encodeURIComponent(value);\n}\n/**\n * Encodes the passed object as a query string.\n *\n * @param params An object to be encoded.\n * @returns An encoded query string.\n */\nexport function encodeQueryString(params) {\n    var newParams = processParams(params);\n    return Object.keys(newParams)\n        .map(function (key) {\n        return encodeParam(key, newParams[key]);\n    })\n        .join(\"&\");\n}\n//# sourceMappingURL=encode-query-string.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n// TypeScript 2.1 no longer allows you to extend built in types. See https://github.com/Microsoft/TypeScript/issues/12790#issuecomment-265981442\n// and https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n//\n// This code is from MDN https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types.\nvar ArcGISRequestError = /** @class */ (function () {\n    /**\n     * Create a new `ArcGISRequestError`  object.\n     *\n     * @param message - The error message from the API\n     * @param code - The error code from the API\n     * @param response - The original response from the API that caused the error\n     * @param url - The original url of the request\n     * @param options - The original options and parameters of the request\n     */\n    function ArcGISRequestError(message, code, response, url, options) {\n        message = message || \"UNKNOWN_ERROR\";\n        code = code || \"UNKNOWN_ERROR_CODE\";\n        this.name = \"ArcGISRequestError\";\n        this.message =\n            code === \"UNKNOWN_ERROR_CODE\" ? message : code + \": \" + message;\n        this.originalMessage = message;\n        this.code = code;\n        this.response = response;\n        this.url = url;\n        this.options = options;\n    }\n    return ArcGISRequestError;\n}());\nexport { ArcGISRequestError };\nArcGISRequestError.prototype = Object.create(Error.prototype);\nArcGISRequestError.prototype.constructor = ArcGISRequestError;\n//# sourceMappingURL=ArcGISRequestError.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Method used internally to surface messages to developers.\n */\nexport function warn(message) {\n    if (console && console.warn) {\n        console.warn.apply(console, [message]);\n    }\n}\n//# sourceMappingURL=warn.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign, __extends } from \"tslib\";\nimport { encodeFormData } from \"./utils/encode-form-data\";\nimport { encodeQueryString } from \"./utils/encode-query-string\";\nimport { requiresFormData } from \"./utils/process-params\";\nimport { ArcGISRequestError } from \"./utils/ArcGISRequestError\";\nimport { warn } from \"./utils/warn\";\nexport var NODEJS_DEFAULT_REFERER_HEADER = \"@esri/arcgis-rest-js\";\nvar DEFAULT_ARCGIS_REQUEST_OPTIONS = {\n    httpMethod: \"POST\",\n    params: {\n        f: \"json\",\n    },\n};\n/**\n * Sets the default options that will be passed in **all requests across all `@esri/arcgis-rest-js` modules**.\n *\n *\n * ```js\n * import { setDefaultRequestOptions } from \"@esri/arcgis-rest-request\";\n * setDefaultRequestOptions({\n *   authentication: userSession // all requests will use this session by default\n * })\n * ```\n * You should **never** set a default `authentication` when you are in a server side environment where you may be handling requests for many different authenticated users.\n *\n * @param options The default options to pass with every request. Existing default will be overwritten.\n * @param hideWarnings Silence warnings about setting default `authentication` in shared environments.\n */\nexport function setDefaultRequestOptions(options, hideWarnings) {\n    if (options.authentication && !hideWarnings) {\n        warn(\"You should not set `authentication` as a default in a shared environment such as a web server which will process multiple users requests. You can call `setDefaultRequestOptions` with `true` as a second argument to disable this warning.\");\n    }\n    DEFAULT_ARCGIS_REQUEST_OPTIONS = options;\n}\nvar ArcGISAuthError = /** @class */ (function (_super) {\n    __extends(ArcGISAuthError, _super);\n    /**\n     * Create a new `ArcGISAuthError`  object.\n     *\n     * @param message - The error message from the API\n     * @param code - The error code from the API\n     * @param response - The original response from the API that caused the error\n     * @param url - The original url of the request\n     * @param options - The original options of the request\n     */\n    function ArcGISAuthError(message, code, response, url, options) {\n        if (message === void 0) { message = \"AUTHENTICATION_ERROR\"; }\n        if (code === void 0) { code = \"AUTHENTICATION_ERROR_CODE\"; }\n        var _this = _super.call(this, message, code, response, url, options) || this;\n        _this.name = \"ArcGISAuthError\";\n        _this.message =\n            code === \"AUTHENTICATION_ERROR_CODE\" ? message : code + \": \" + message;\n        return _this;\n    }\n    ArcGISAuthError.prototype.retry = function (getSession, retryLimit) {\n        var _this = this;\n        if (retryLimit === void 0) { retryLimit = 3; }\n        var tries = 0;\n        var retryRequest = function (resolve, reject) {\n            getSession(_this.url, _this.options)\n                .then(function (session) {\n                var newOptions = __assign(__assign({}, _this.options), { authentication: session });\n                tries = tries + 1;\n                return request(_this.url, newOptions);\n            })\n                .then(function (response) {\n                resolve(response);\n            })\n                .catch(function (e) {\n                if (e.name === \"ArcGISAuthError\" && tries < retryLimit) {\n                    retryRequest(resolve, reject);\n                }\n                else if (e.name === \"ArcGISAuthError\" && tries >= retryLimit) {\n                    reject(_this);\n                }\n                else {\n                    reject(e);\n                }\n            });\n        };\n        return new Promise(function (resolve, reject) {\n            retryRequest(resolve, reject);\n        });\n    };\n    return ArcGISAuthError;\n}(ArcGISRequestError));\nexport { ArcGISAuthError };\n/**\n * Checks for errors in a JSON response from the ArcGIS REST API. If there are no errors, it will return the `data` passed in. If there is an error, it will throw an `ArcGISRequestError` or `ArcGISAuthError`.\n *\n * @param data The response JSON to check for errors.\n * @param url The url of the original request\n * @param params The parameters of the original request\n * @param options The options of the original request\n * @returns The data that was passed in the `data` parameter\n */\nexport function checkForErrors(response, url, params, options, originalAuthError) {\n    // this is an error message from billing.arcgis.com backend\n    if (response.code >= 400) {\n        var message = response.message, code = response.code;\n        throw new ArcGISRequestError(message, code, response, url, options);\n    }\n    // error from ArcGIS Online or an ArcGIS Portal or server instance.\n    if (response.error) {\n        var _a = response.error, message = _a.message, code = _a.code, messageCode = _a.messageCode;\n        var errorCode = messageCode || code || \"UNKNOWN_ERROR_CODE\";\n        if (code === 498 ||\n            code === 499 ||\n            messageCode === \"GWM_0003\" ||\n            (code === 400 && message === \"Unable to generate token.\")) {\n            if (originalAuthError) {\n                throw originalAuthError;\n            }\n            else {\n                throw new ArcGISAuthError(message, errorCode, response, url, options);\n            }\n        }\n        throw new ArcGISRequestError(message, errorCode, response, url, options);\n    }\n    // error from a status check\n    if (response.status === \"failed\" || response.status === \"failure\") {\n        var message = void 0;\n        var code = \"UNKNOWN_ERROR_CODE\";\n        try {\n            message = JSON.parse(response.statusMessage).message;\n            code = JSON.parse(response.statusMessage).code;\n        }\n        catch (e) {\n            message = response.statusMessage || response.message;\n        }\n        throw new ArcGISRequestError(message, code, response, url, options);\n    }\n    return response;\n}\n/**\n * ```js\n * import { request } from '@esri/arcgis-rest-request';\n * //\n * request('https://www.arcgis.com/sharing/rest')\n *   .then(response) // response.currentVersion === 5.2\n * //\n * request('https://www.arcgis.com/sharing/rest', {\n *   httpMethod: \"GET\"\n * })\n * //\n * request('https://www.arcgis.com/sharing/rest/search', {\n *   params: { q: 'parks' }\n * })\n *   .then(response) // response.total => 78379\n * ```\n * Generic method for making HTTP requests to ArcGIS REST API endpoints.\n *\n * @param url - The URL of the ArcGIS REST API endpoint.\n * @param requestOptions - Options for the request, including parameters relevant to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function request(url, requestOptions) {\n    if (requestOptions === void 0) { requestOptions = { params: { f: \"json\" } }; }\n    var options = __assign(__assign(__assign({ httpMethod: \"POST\" }, DEFAULT_ARCGIS_REQUEST_OPTIONS), requestOptions), {\n        params: __assign(__assign({}, DEFAULT_ARCGIS_REQUEST_OPTIONS.params), requestOptions.params),\n        headers: __assign(__assign({}, DEFAULT_ARCGIS_REQUEST_OPTIONS.headers), requestOptions.headers),\n    });\n    var missingGlobals = [];\n    var recommendedPackages = [];\n    // don't check for a global fetch if a custom implementation was passed through\n    if (!options.fetch && typeof fetch !== \"undefined\") {\n        options.fetch = fetch.bind(Function(\"return this\")());\n    }\n    else {\n        missingGlobals.push(\"`fetch`\");\n        recommendedPackages.push(\"`node-fetch`\");\n    }\n    if (typeof Promise === \"undefined\") {\n        missingGlobals.push(\"`Promise`\");\n        recommendedPackages.push(\"`es6-promise`\");\n    }\n    if (typeof FormData === \"undefined\") {\n        missingGlobals.push(\"`FormData`\");\n        recommendedPackages.push(\"`isomorphic-form-data`\");\n    }\n    if (!options.fetch ||\n        typeof Promise === \"undefined\" ||\n        typeof FormData === \"undefined\") {\n        throw new Error(\"`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing \" + missingGlobals.join(\", \") + \". We recommend installing the \" + recommendedPackages.join(\", \") + \" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.\");\n    }\n    var httpMethod = options.httpMethod, authentication = options.authentication, rawResponse = options.rawResponse;\n    var params = __assign({ f: \"json\" }, options.params);\n    var originalAuthError = null;\n    var fetchOptions = {\n        method: httpMethod,\n        /* ensures behavior mimics XMLHttpRequest.\n        needed to support sending IWA cookies */\n        credentials: options.credentials || \"same-origin\",\n    };\n    // the /oauth2/platformSelf route will add X-Esri-Auth-Client-Id header\n    // and that request needs to send cookies cross domain\n    // so we need to set the credentials to \"include\"\n    if (options.headers &&\n        options.headers[\"X-Esri-Auth-Client-Id\"] &&\n        url.indexOf(\"/oauth2/platformSelf\") > -1) {\n        fetchOptions.credentials = \"include\";\n    }\n    return (authentication\n        ? authentication.getToken(url, { fetch: options.fetch }).catch(function (err) {\n            /**\n             * append original request url and requestOptions\n             * to the error thrown by getToken()\n             * to assist with retrying\n             */\n            err.url = url;\n            err.options = options;\n            /**\n             * if an attempt is made to talk to an unfederated server\n             * first try the request anonymously. if a 'token required'\n             * error is thrown, throw the UNFEDERATED error then.\n             */\n            originalAuthError = err;\n            return Promise.resolve(\"\");\n        })\n        : Promise.resolve(\"\"))\n        .then(function (token) {\n        if (token.length) {\n            params.token = token;\n        }\n        if (authentication && authentication.getDomainCredentials) {\n            fetchOptions.credentials = authentication.getDomainCredentials(url);\n        }\n        // Custom headers to add to request. IRequestOptions.headers with merge over requestHeaders.\n        var requestHeaders = {};\n        if (fetchOptions.method === \"GET\") {\n            // Prevents token from being passed in query params when hideToken option is used.\n            /* istanbul ignore if - window is always defined in a browser. Test case is covered by Jasmine in node test */\n            if (params.token &&\n                options.hideToken &&\n                // Sharing API does not support preflight check required by modern browsers https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request\n                typeof window === \"undefined\") {\n                requestHeaders[\"X-Esri-Authorization\"] = \"Bearer \" + params.token;\n                delete params.token;\n            }\n            // encode the parameters into the query string\n            var queryParams = encodeQueryString(params);\n            // dont append a '?' unless parameters are actually present\n            var urlWithQueryString = queryParams === \"\" ? url : url + \"?\" + encodeQueryString(params);\n            if (\n            // This would exceed the maximum length for URLs specified by the consumer and requires POST\n            (options.maxUrlLength &&\n                urlWithQueryString.length > options.maxUrlLength) ||\n                // Or if the customer requires the token to be hidden and it has not already been hidden in the header (for browsers)\n                (params.token && options.hideToken)) {\n                // the consumer specified a maximum length for URLs\n                // and this would exceed it, so use post instead\n                fetchOptions.method = \"POST\";\n                // If the token was already added as a Auth header, add the token back to body with other params instead of header\n                if (token.length && options.hideToken) {\n                    params.token = token;\n                    // Remove existing header that was added before url query length was checked\n                    delete requestHeaders[\"X-Esri-Authorization\"];\n                }\n            }\n            else {\n                // just use GET\n                url = urlWithQueryString;\n            }\n        }\n        /* updateResources currently requires FormData even when the input parameters dont warrant it.\n    https://developers.arcgis.com/rest/users-groups-and-items/update-resources.htm\n        see https://github.com/Esri/arcgis-rest-js/pull/500 for more info. */\n        var forceFormData = new RegExp(\"/items/.+/updateResources\").test(url);\n        if (fetchOptions.method === \"POST\") {\n            fetchOptions.body = encodeFormData(params, forceFormData);\n        }\n        // Mixin headers from request options\n        fetchOptions.headers = __assign(__assign({}, requestHeaders), options.headers);\n        /* istanbul ignore next - karma reports coverage on browser tests only */\n        if (typeof window === \"undefined\" && !fetchOptions.headers.referer) {\n            fetchOptions.headers.referer = NODEJS_DEFAULT_REFERER_HEADER;\n        }\n        /* istanbul ignore else blob responses are difficult to make cross platform we will just have to trust the isomorphic fetch will do its job */\n        if (!requiresFormData(params) && !forceFormData) {\n            fetchOptions.headers[\"Content-Type\"] =\n                \"application/x-www-form-urlencoded\";\n        }\n        return options.fetch(url, fetchOptions);\n    })\n        .then(function (response) {\n        if (!response.ok) {\n            // server responded w/ an actual error (404, 500, etc)\n            var status_1 = response.status, statusText = response.statusText;\n            throw new ArcGISRequestError(statusText, \"HTTP \" + status_1, response, url, options);\n        }\n        if (rawResponse) {\n            return response;\n        }\n        switch (params.f) {\n            case \"json\":\n                return response.json();\n            case \"geojson\":\n                return response.json();\n            case \"html\":\n                return response.text();\n            case \"text\":\n                return response.text();\n            /* istanbul ignore next blob responses are difficult to make cross platform we will just have to trust that isomorphic fetch will do its job */\n            default:\n                return response.blob();\n        }\n    })\n        .then(function (data) {\n        if ((params.f === \"json\" || params.f === \"geojson\") && !rawResponse) {\n            var response = checkForErrors(data, url, params, options, originalAuthError);\n            if (originalAuthError) {\n                /* If the request was made to an unfederated service that\n                didn't require authentication, add the base url and a dummy token\n                to the list of trusted servers to avoid another federation check\n                in the event of a repeat request */\n                var truncatedUrl = url\n                    .toLowerCase()\n                    .split(/\\/rest(\\/admin)?\\/services\\//)[0];\n                options.authentication.federatedServers[truncatedUrl] = {\n                    token: [],\n                    // default to 24 hours\n                    expires: new Date(Date.now() + 86400 * 1000),\n                };\n                originalAuthError = null;\n            }\n            return response;\n        }\n        else {\n            return data;\n        }\n    });\n}\n//# sourceMappingURL=request.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { processParams, requiresFormData } from \"./process-params\";\nimport { encodeQueryString } from \"./encode-query-string\";\n/**\n * Encodes parameters in a [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) object in browsers or in a [FormData](https://github.com/form-data/form-data) in Node.js\n *\n * @param params An object to be encoded.\n * @returns The complete [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) object.\n */\nexport function encodeFormData(params, forceFormData) {\n    // see https://github.com/Esri/arcgis-rest-js/issues/499 for more info.\n    var useFormData = requiresFormData(params) || forceFormData;\n    var newParams = processParams(params);\n    if (useFormData) {\n        var formData_1 = new FormData();\n        Object.keys(newParams).forEach(function (key) {\n            if (typeof Blob !== \"undefined\" && newParams[key] instanceof Blob) {\n                /* To name the Blob:\n                 1. look to an alternate request parameter called 'fileName'\n                 2. see if 'name' has been tacked onto the Blob manually\n                 3. if all else fails, use the request parameter\n                */\n                var filename = newParams[\"fileName\"] || newParams[key].name || key;\n                formData_1.append(key, newParams[key], filename);\n            }\n            else {\n                formData_1.append(key, newParams[key]);\n            }\n        });\n        return formData_1;\n    }\n    else {\n        return encodeQueryString(params);\n    }\n}\n//# sourceMappingURL=encode-form-data.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\n/**\n * Helper for methods with lots of first order request options to pass through as request parameters.\n */\nexport function appendCustomParams(customOptions, keys, baseOptions) {\n    var requestOptionsKeys = [\n        \"params\",\n        \"httpMethod\",\n        \"rawResponse\",\n        \"authentication\",\n        \"portal\",\n        \"fetch\",\n        \"maxUrlLength\",\n        \"headers\"\n    ];\n    var options = __assign(__assign({ params: {} }, baseOptions), customOptions);\n    // merge all keys in customOptions into options.params\n    options.params = keys.reduce(function (value, key) {\n        if (customOptions[key] || typeof customOptions[key] === \"boolean\") {\n            value[key] = customOptions[key];\n        }\n        return value;\n    }, options.params);\n    // now remove all properties in options that don't exist in IRequestOptions\n    return requestOptionsKeys.reduce(function (value, key) {\n        if (options[key]) {\n            value[key] = options[key];\n        }\n        return value;\n    }, {});\n}\n//# sourceMappingURL=append-custom-params.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { cleanUrl } from \"@esri/arcgis-rest-request\";\n/**\n * Helper that returns the appropriate portal url for a given request. `requestOptions.portal` is given\n * precedence over `authentication.portal`. If neither `portal` nor `authentication` is present,\n * `www.arcgis.com/sharing/rest` is returned.\n *\n * @param requestOptions - Request options that may have authentication manager\n * @returns Portal url to be used in API requests\n */\nexport function getPortalUrl(requestOptions) {\n    if (requestOptions === void 0) { requestOptions = {}; }\n    // use portal in options if specified\n    if (requestOptions.portal) {\n        return cleanUrl(requestOptions.portal);\n    }\n    // if auth was passed, use that portal\n    if (requestOptions.authentication) {\n        // the portal url is already scrubbed in the auth package\n        return requestOptions.authentication.portal;\n    }\n    // default to arcgis.com\n    return \"https://www.arcgis.com/sharing/rest\";\n}\n//# sourceMappingURL=get-portal-url.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Helper method to ensure that user supplied urls don't include whitespace or a trailing slash.\n */\nexport function cleanUrl(url) {\n    // Guard so we don't try to trim something that's not a string\n    if (typeof url !== \"string\") {\n        return url;\n    }\n    // trim leading and trailing spaces, but not spaces inside the url\n    url = url.trim();\n    // remove the trailing slash to the url if one was included\n    if (url[url.length - 1] === \"/\") {\n        url = url.slice(0, -1);\n    }\n    return url;\n}\n//# sourceMappingURL=clean-url.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Serialize an item and its data into a json format accepted by the Portal API for create and update operations\n *\n * @param item Item to be serialized\n * @returns a formatted json object to be sent to Portal\n */\nexport function serializeItem(item) {\n    // create a clone so we're not messing with the original\n    var clone = JSON.parse(JSON.stringify(item));\n    // binary data needs POSTed as a `file`\n    // JSON object literals should be passed as `text`.\n    if (clone.data) {\n        (typeof Blob !== \"undefined\" && item.data instanceof Blob) ||\n            // Node.js doesn't implement Blob\n            item.data.constructor.name === \"ReadStream\"\n            ? (clone.file = item.data)\n            : (clone.text = item.data);\n        delete clone.data;\n    }\n    return clone;\n}\n/**\n * `requestOptions.owner` is given priority, `requestOptions.item.owner` will be checked next. If neither are present, `authentication.getUserName()` will be used instead.\n */\nexport function determineOwner(requestOptions) {\n    if (requestOptions.owner) {\n        return Promise.resolve(requestOptions.owner);\n    }\n    else if (requestOptions.item && requestOptions.item.owner) {\n        return Promise.resolve(requestOptions.item.owner);\n    }\n    else if (requestOptions.authentication &&\n        requestOptions.authentication.getUsername) {\n        return requestOptions.authentication.getUsername();\n    }\n    else {\n        return Promise.reject(new Error(\"Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option.\"));\n    }\n}\n//# sourceMappingURL=helpers.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { serializeItem, determineOwner } from \"./helpers\";\n/**\n * ```js\n * import { updateItem } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItem({\n *   item: {\n *     id: \"3ef\",\n *     description: \"A three hour tour\"\n *   },\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update an Item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm) for more information.\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that updates an item.\n */\nexport function updateItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = requestOptions.folderId\n            ? getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/\" + requestOptions.folderId + \"/items/\" + requestOptions.item.id + \"/update\"\n            : getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.item.id + \"/update\";\n        // serialize the item into something Portal will accept\n        requestOptions.params = __assign(__assign({}, requestOptions.params), serializeItem(requestOptions.item));\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { updateItemInfo } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItemInfo({\n *   id: '3ef',\n *   file: file,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update an info file associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-info.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that updates an item info file.\n */\nexport function updateItemInfo(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/updateinfo\";\n        // mix in user supplied params\n        requestOptions.params = __assign({ folderName: requestOptions.folderName, file: requestOptions.file }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { updateItemResource } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItemResource({\n *   id: '3ef',\n *   resource: file,\n *   name: 'bigkahuna.jpg',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update a resource associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-resources.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that updates an item resource.\n */\nexport function updateItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/updateResources\";\n        // mix in user supplied params\n        requestOptions.params = __assign({ file: requestOptions.resource, fileName: requestOptions.name, resourcesPrefix: requestOptions.prefix, text: requestOptions.content }, requestOptions.params);\n        // only override the access specified previously if 'private' is passed explicitly\n        if (typeof requestOptions.private !== \"undefined\") {\n            requestOptions.params.access = requestOptions.private\n                ? \"private\"\n                : \"inherit\";\n        }\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { moveItem } from \"@esri/arcgis-rest-portal\";\n * //\n * moveItem({\n *   itemId: \"3ef\",\n *   folderId: \"7c5\",\n *   authentication: userSession\n * })\n * ```\n * Move an item to a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/move-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with owner and folder details once the move has been completed\n */\nexport function moveItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.itemId + \"/move\";\n        var folderId = requestOptions.folderId;\n        if (!folderId) {\n            folderId = \"/\";\n        }\n        requestOptions.params = __assign({ folder: folderId }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=update.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { serializeItem, determineOwner } from \"./helpers\";\n/**\n * ```js\n * import { createFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * createFolder({\n *   title: 'Map Collection',\n *   authentication: userSession\n * })\n *   .then(response)\n * ```\n * Create a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/create-folder.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with folder details once the folder has been created\n */\nexport function createFolder(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var baseUrl = getPortalUrl(requestOptions) + \"/content/users/\" + owner;\n        var url = baseUrl + \"/createFolder\";\n        requestOptions.params = __assign({ title: requestOptions.title }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { createItemInFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * createItemInFolder({\n *   item: {\n *     title: \"The Amazing Voyage\",\n *     type: \"Web Map\"\n *   },\n *   folderId: 'fe8',\n *   authentication\n * })\n * ```\n * Create an item in a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-item.htm) for more information.\n *\n * @param requestOptions = Options for the request\n */\nexport function createItemInFolder(requestOptions) {\n    if (requestOptions.multipart && !requestOptions.filename) {\n        return Promise.reject(new Error(\"The filename is required for a multipart request.\"));\n    }\n    return determineOwner(requestOptions).then(function (owner) {\n        var baseUrl = getPortalUrl(requestOptions) + \"/content/users/\" + owner;\n        var url = baseUrl + \"/addItem\";\n        if (requestOptions.folderId) {\n            url = baseUrl + \"/\" + requestOptions.folderId + \"/addItem\";\n        }\n        requestOptions.params = __assign(__assign({}, requestOptions.params), serializeItem(requestOptions.item));\n        // serialize the item into something Portal will accept\n        var options = appendCustomParams(requestOptions, [\n            \"owner\",\n            \"folderId\",\n            \"file\",\n            \"dataUrl\",\n            \"text\",\n            \"async\",\n            \"multipart\",\n            \"filename\",\n            \"overwrite\"\n        ], {\n            params: __assign({}, requestOptions.params)\n        });\n        return request(url, options);\n    });\n}\n/**\n * ```js\n * import { createItem } from \"@esri/arcgis-rest-portal\";\n * //\n * createItem({\n *   item: {\n *     title: \"The Amazing Voyage\",\n *     type: \"Web Map\"\n *   },\n *   authentication\n * })\n * ```\n * Create an Item in the user's root folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that creates an item.\n */\nexport function createItem(requestOptions) {\n    // delegate to createItemInFolder placing in the root of the filestore\n    var options = __assign({ folderId: null }, requestOptions);\n    return createItemInFolder(options);\n}\n//# sourceMappingURL=create.js.map","// eslint-disable-next-line no-control-regex\nvar CONTROL_CHAR_MATCHER = /[\\x00-\\x1F\\x7F-\\x9F\\xA0]/g;\n/**\n * Returns a new string with all control characters removed.\n *\n * Doesn't remove characters from input string.\n *\n * @param str - the string to scrub\n */\nexport function scrubControlChars(str) {\n    return str.replace(CONTROL_CHAR_MATCHER, \"\");\n}\n//# sourceMappingURL=scrub-control-chars.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { scrubControlChars } from '../util/scrub-control-chars';\nimport { determineOwner } from \"./helpers\";\n/**\n * ```\n * import { getItem } from \"@esri/arcgis-rest-portal\";\n * //\n * getItem(\"ae7\")\n *   .then(response);\n * // or\n * getItem(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get an item by id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item.htm) for more information.\n *\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function getItem(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions);\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Get the fully qualified base URL to the REST end point for an item.\n * @param id Item Id\n * @param portalUrlOrRequestOptions a portal URL or request options\n * @returns URL to the item's REST end point, defaults to `https://www.arcgis.com/sharing/rest/content/items/{id}`\n */\nexport var getItemBaseUrl = function (id, portalUrlOrRequestOptions) {\n    var portalUrl = typeof portalUrlOrRequestOptions === \"string\"\n        ? portalUrlOrRequestOptions\n        : getPortalUrl(portalUrlOrRequestOptions);\n    return portalUrl + \"/content/items/\" + id;\n};\n/**\n * ```\n * import { getItemData } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemData(\"ae7\")\n *   .then(response)\n * // or\n * getItemData(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get the /data for an item. If no data exists, returns `undefined`. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-data.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the json data for the item.\n */\nexport function getItemData(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions) + \"/data\";\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\", params: {} }, requestOptions);\n    if (options.file) {\n        options.params.f = null;\n    }\n    return request(url, options).catch(function (err) {\n        /* if the item doesn't include data, the response will be empty\n           and the internal call to response.json() will fail */\n        var emptyResponseErr = RegExp(/The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i);\n        /* istanbul ignore else */\n        if (emptyResponseErr.test(err.message)) {\n            return;\n        }\n        else\n            throw err;\n    });\n}\n/**\n * ```\n * import { getRelatedItems } from \"@esri/arcgis-rest-portal\";\n * //\n * getRelatedItems({\n *   id: \"ae7\",\n *   relationshipType: \"Service2Layer\" // or several [\"Service2Layer\", \"Map2Area\"]\n * })\n *   .then(response)\n * ```\n * Get the related items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/related-items.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getRelatedItems(requestOptions) {\n    var url = getItemBaseUrl(requestOptions.id, requestOptions) + \"/relatedItems\";\n    var options = __assign({ httpMethod: \"GET\", params: {\n            direction: requestOptions.direction\n        } }, requestOptions);\n    if (typeof requestOptions.relationshipType === \"string\") {\n        options.params.relationshipType = requestOptions.relationshipType;\n    }\n    else {\n        options.params.relationshipTypes = requestOptions.relationshipType;\n    }\n    delete options.direction;\n    delete options.relationshipType;\n    return request(url, options);\n}\n/**\n * Get the resources associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getItemResources(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions) + \"/resources\";\n    // Mix in num:1000 with any user supplied params\n    // Key thing - we don't want to mutate the passed in requestOptions\n    // as that may be used in other (subsequent) calls in the course\n    // of a long promise chains\n    var options = __assign({}, requestOptions);\n    options.params = __assign({ num: 1000 }, options.params);\n    return request(url, options);\n}\n/**\n * ```js\n * import { getItemResource } from \"@esri/arcgis-rest-portal\";\n *\n * // Parses contents as blob by default\n * getItemResource(\"3ef\", { fileName: \"resource.jpg\", ...})\n *  .then(resourceContents => {});\n *\n * // Can override parse method\n * getItemResource(\"3ef\", { fileName: \"resource.json\", readAs: 'json', ...})\n *  .then(resourceContents => {});\n *\n * // Get the response object instead\n * getItemResource(\"3ef\",{ rawResponse: true, fileName: \"resource.json\" })\n *  .then(response => {})\n * ```\n * Fetches an item resource and optionally parses it to the correct format.\n *\n * Note: provides JSON parse error protection by sanitizing out any unescaped control\n * characters before parsing that would otherwise cause an error to be thrown\n *\n * @param {string} itemId\n * @param {IGetItemResourceOptions} requestOptions\n */\nexport function getItemResource(itemId, requestOptions) {\n    var readAs = requestOptions.readAs || 'blob';\n    return getItemFile(itemId, \"/resources/\" + requestOptions.fileName, readAs, requestOptions);\n}\n/**\n * ```js\n * import { getItemGroups } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemGroups(\"30e5fe3149c34df1ba922e6f5bbf808f\")\n *   .then(response)\n * ```\n * Lists the groups of which the item is a part, only showing the groups that the calling user can access. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/groups.htm) for more information.\n *\n * @param id - The Id of the item to query group association for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item groups.\n */\nexport function getItemGroups(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions) + \"/groups\";\n    return request(url, requestOptions);\n}\n/**\n * ```js\n * import { getItemStatus } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemStatus({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Inquire about status when publishing an item, adding an item in async mode, or adding with a multipart upload. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/status.htm) for more information.\n *\n * @param id - The Id of the item to get status for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item status.\n */\nexport function getItemStatus(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/status\";\n        var options = appendCustomParams(requestOptions, [\"jobId\", \"jobType\"], { params: __assign({}, requestOptions.params) });\n        return request(url, options);\n    });\n}\n/**\n * ```js\n * import { getItemParts } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemParts({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Lists the part numbers of the file parts that have already been uploaded in a multipart file upload. This method can be used to verify the parts that have been received as well as those parts that were not received by the server. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/parts.htm) for more information.\n *\n * @param id - The Id of the item to get part list.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item part list.\n */\nexport function getItemParts(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/parts\";\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```\n * import { getItemInfo } from \"@esri/arcgis-rest-portal\";\n * // get the \"Info Card\" for the item\n * getItemInfo(\"ae7\")\n *   .then(itemInfoXml) // XML document as a string\n * // or get the contents of a specific file\n * getItemInfo(\"ae7\", { fileName: \"form.json\", readAs: \"json\", authentication })\n *   .then(formJson) // JSON document as JSON\n * ```\n * Get an info file for an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-info-file.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request, including the file name which defaults to `iteminfo.xml`.\n * If the file is not a text file (XML, HTML, etc) you will need to specify the `readAs` parameter\n * @returns A Promise that will resolve with the contents of the info file for the item.\n */\nexport function getItemInfo(id, requestOptions) {\n    var _a = requestOptions || {}, _b = _a.fileName, fileName = _b === void 0 ? \"iteminfo.xml\" : _b, _c = _a.readAs, readAs = _c === void 0 ? \"text\" : _c;\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return getItemFile(id, \"/info/\" + fileName, readAs, options);\n}\n/**\n * ```\n * import { getItemMetadata } from \"@esri/arcgis-rest-portal\";\n * // get the metadata for the item\n * getItemMetadata(\"ae7\")\n *   .then(itemMetadataXml) // XML document as a string\n * // or with additional request options\n * getItemMetadata(\"ae7\", { authentication })\n *   .then(itemMetadataXml) // XML document as a string\n * ```\n * Get the standard formal metadata XML file for an item (`/info/metadata/metadata.xml`)\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the contents of the metadata file for the item as a string.\n */\nexport function getItemMetadata(id, requestOptions) {\n    var options = __assign(__assign({}, requestOptions), { fileName: \"metadata/metadata.xml\" });\n    return getItemInfo(id, options);\n}\n// overrides request()'s default behavior for reading the response\n// which is based on `params.f` and defaults to JSON\n// Also adds JSON parse error protection by sanitizing out any unescaped control characters before parsing\nfunction getItemFile(id, \n// NOTE: fileName should include any folder/subfolders\nfileName, readMethod, requestOptions) {\n    var url = \"\" + getItemBaseUrl(id, requestOptions) + fileName;\n    // preserve escape hatch to let the consumer read the response\n    // and ensure the f param is not appended to the query string\n    var options = __assign({ params: {} }, requestOptions);\n    var justReturnResponse = options.rawResponse;\n    options.rawResponse = true;\n    options.params.f = null;\n    return request(url, options).then(function (response) {\n        if (justReturnResponse) {\n            return response;\n        }\n        return readMethod !== 'json'\n            ? response[readMethod]()\n            : response.text().then(function (text) { return JSON.parse(scrubControlChars(text)); });\n    });\n}\n//# sourceMappingURL=get.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { determineOwner } from \"./helpers\";\n/**\n * Protect an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/protect.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to protect an item.\n */\nexport function protectItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/protect\";\n        return request(url, requestOptions);\n    });\n}\n/**\n * Unprotect an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/unprotect.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to unprotect an item.\n */\nexport function unprotectItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/unprotect\";\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=protect.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { getGroup } from \"../groups/get\";\nexport function getSharingUrl(requestOptions) {\n    var username = requestOptions.authentication.username;\n    var owner = requestOptions.owner || username;\n    return getPortalUrl(requestOptions) + \"/content/users/\" + encodeURIComponent(owner) + \"/items/\" + requestOptions.id + \"/share\";\n}\nexport function isItemOwner(requestOptions) {\n    var username = requestOptions.authentication.username;\n    var owner = requestOptions.owner || username;\n    return owner === username;\n}\n/**\n * Check it the user is a full org_admin\n * @param requestOptions\n * @returns Promise resolving in a boolean indicating if the user is an ArcGIS Organization administrator\n */\nexport function isOrgAdmin(requestOptions) {\n    var session = requestOptions.authentication;\n    return session.getUser(requestOptions).then(function (user) {\n        return user && user.role === \"org_admin\" && !user.roleId;\n    });\n}\n/**\n * Get the User Membership for a particular group. Use this if all you have is the groupId.\n * If you have the group object, check the `userMembership.memberType` property instead of calling this method.\n *\n * @param requestOptions\n * @returns A Promise that resolves with \"owner\" | \"admin\" | \"member\" | \"nonmember\"\n */\nexport function getUserMembership(requestOptions) {\n    // fetch the group...\n    return getGroup(requestOptions.groupId, requestOptions)\n        .then(function (group) {\n        return group.userMembership.memberType;\n    })\n        .catch(function () {\n        return \"none\";\n    });\n}\n//# sourceMappingURL=helpers.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { getGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * getGroup(\"fxb988\") // id\n *   .then(response)\n * ```\n * Fetch a group using its id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group.htm) for more information.\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns  A Promise that will resolve with the data from the response.\n */\nexport function getGroup(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id;\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Gets the category schema set on a group\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns A promise that will resolve with JSON of group's category schema\n * @see https://developers.arcgis.com/rest/users-groups-and-items/group-category-schema.htm\n */\nexport function getGroupCategorySchema(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/categorySchema\";\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Returns the content of a Group. Since the group may contain 1000s of items\n * the requestParams allow for paging.\n * @param id - Group Id\n * @param requestOptions  - Options for the request, including paging parameters.\n * @returns  A Promise that will resolve with the content of the group.\n */\nexport function getGroupContent(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/content/groups/\" + id;\n    // default to a GET request\n    var options = __assign(__assign({ httpMethod: \"GET\" }, { params: { start: 1, num: 100 } }), requestOptions);\n    // is this the most concise way to mixin with the defaults above?\n    if (requestOptions && requestOptions.paging) {\n        options.params = __assign({}, requestOptions.paging);\n    }\n    return request(url, options);\n}\n/**\n * Get the usernames of the admins and members. Does not return actual 'User' objects. Those must be\n * retrieved via separate calls to the User's API.\n * @param id - Group Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with arrays of the group admin usernames and the member usernames\n */\nexport function getGroupUsers(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/users\";\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * ```js\n * import { searchGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * searchGroupUsers('abc123')\n *   .then(response)\n * ```\n * Search the users in a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-users-list.htm) for more information.\n *\n * @param id - The group id\n * @param searchOptions - Options for the request, including paging parameters.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroupUsers(id, searchOptions) {\n    var url = getPortalUrl(searchOptions) + \"/community/groups/\" + id + \"/userlist\";\n    var options = appendCustomParams(searchOptions || {}, [\"name\", \"num\", \"start\", \"sortField\", \"sortOrder\", \"joined\", \"memberType\"], {\n        httpMethod: \"GET\"\n    });\n    return request(url, options);\n}\n//# sourceMappingURL=get.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { determineOwner } from \"./helpers\";\n/**\n * ```js\n * import { removeItem } from \"@esri/arcgis-rest-portal\";\n * //\n * removeItem({\n *   id: \"3ef\",\n *   authentication\n * })\n * ```\n * Delete an item from the portal. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item.\n */\nexport function removeItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/delete\";\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { removeItemRelationship } from \"@esri/arcgis-rest-portal\";\n * //\n * removeItemRelationship({\n *   originItemId: '3ef',\n *   destinationItemId: 'ae7',\n *   relationshipType: 'Service2Layer',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Remove a relationship between two items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-relationship.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function removeItemRelationship(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/deleteRelationship\";\n        var options = appendCustomParams(requestOptions, [\"originItemId\", \"destinationItemId\", \"relationshipType\"], { params: __assign({}, requestOptions.params) });\n        return request(url, options);\n    });\n}\n/**\n * Remove a resource associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item resource.\n */\nexport function removeItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/removeResources\";\n        // mix in user supplied params\n        requestOptions.params = __assign(__assign({}, requestOptions.params), { resource: requestOptions.resource });\n        // only override the deleteAll param specified previously if it is passed explicitly\n        if (typeof requestOptions.deleteAll !== \"undefined\") {\n            requestOptions.params.deleteAll = requestOptions.deleteAll;\n        }\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { removeFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * removeFolder({\n *   folderId: \"fe4\",\n *   owner: \"c@sey\",\n *   authentication\n * })\n *   .then(response)\n *\n * ```\n * Delete a non-root folder and all the items it contains. See the [REST\n * Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-folder.htm) for\n * more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes a folder\n */\nexport function removeFolder(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + encodeURIComponent(owner) + \"/\" + requestOptions.folderId + \"/delete\";\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=remove.js.map","/* Copyright (c) 2018-2021 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { warn } from \"@esri/arcgis-rest-request\";\n/**\n * `SearchQueryBuilder` can be used to construct the `q` param for\n * [`searchItems`](/arcgis-rest-js/api/portal/searchItems#searchItems-search) or\n * [`searchGroups`](/arcgis-rest-js/api/portal/searchGroups#searchGroups-search).\n * By chaining methods, it helps build complex search queries.\n *\n * ```js\n * const startDate = new Date(\"2020-01-01\");\n * const endDate = new Date(\"2020-09-01\");\n * const query = new SearchQueryBuilder()\n *  .match(\"Patrick\")\n *  .in(\"owner\")\n *  .and()\n *  .from(startDate)\n *  .to(endDate)\n *  .in(\"created\")\n *  .and()\n *  .startGroup()\n *    .match(\"Web Mapping Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Mobile Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Application\")\n *    .in(\"type\")\n *  .endGroup()\n *  .and()\n *  .match(\"Demo App\");\n *\n * searchItems(query).then((res) => {\n *   console.log(res.results);\n * });\n * ```\n *\n * Will search for items matching\n * ```\n * \"owner: Patrick AND created:[1577836800000 TO 1598918400000] AND (type:\"Web Mapping Application\" OR type:\"Mobile Application\" OR type:Application) AND Demo App\"\n * ```\n */\nvar SearchQueryBuilder = /** @class */ (function () {\n    /**\n     * @param q An existing query string to start building from.\n     */\n    function SearchQueryBuilder(q) {\n        if (q === void 0) { q = \"\"; }\n        this.termStack = [];\n        this.rangeStack = [];\n        this.openGroups = 0;\n        this.q = q;\n    }\n    /**\n     * Defines strings to search for.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"My Layer\")\n     * ```\n     *\n     * @param terms strings to search for.\n     */\n    SearchQueryBuilder.prototype.match = function () {\n        var terms = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            terms[_i] = arguments[_i];\n        }\n        this.termStack = this.termStack.concat(terms);\n        return this;\n    };\n    /**\n     * Defines fields to search in. You can pass `\"*\"` or call this method without arguments to search a default set of fields\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"My Layer\")\n     *   .in(\"title\")\n     * ```\n     *\n     * @param field The field to search for the previous match in.\n     */\n    SearchQueryBuilder.prototype.in = function (field) {\n        var fn = \"`in(\" + (field ? \"\\\"\" + field + \"\\\"\" : \"\") + \")`\";\n        if (!this.hasRange && !this.hasTerms) {\n            warn(\n            // apparently-p-rettier-ignore causes some\n            fn + \" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified.\");\n            return this;\n        }\n        if (field && field !== \"*\") {\n            this.q += field + \":\";\n        }\n        return this.commit();\n    };\n    /**\n     * Starts a new search group.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .startGroup()\n     *     .match(\"Lakes\")\n     *     .in(\"title\")\n     *   .endGroup()\n     *   .or()\n     *   .startGroup()\n     *     .match(\"Rivers\")\n     *     .in(\"title\")\n     *   .endGroup()\n     * ```\n     */\n    SearchQueryBuilder.prototype.startGroup = function () {\n        this.commit();\n        if (this.openGroups > 0) {\n            this.q += \" \";\n        }\n        this.openGroups++;\n        this.q += \"(\";\n        return this;\n    };\n    /**\n     * Ends a search group.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .startGroup()\n     *     .match(\"Lakes\")\n     *     .in(\"title\")\n     *   .endGroup()\n     *   .or()\n     *   .startGroup()\n     *     .match(\"Rivers\")\n     *     .in(\"title\")\n     *   .endGroup()\n     * ```\n     */\n    SearchQueryBuilder.prototype.endGroup = function () {\n        if (this.openGroups <= 0) {\n            warn(\"`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified.\");\n            return this;\n        }\n        this.commit();\n        this.openGroups--;\n        this.q += \")\";\n        return this;\n    };\n    /**\n     * Joins two sets of queries with an `AND` clause.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .and()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.and = function () {\n        return this.addModifier(\"and\");\n    };\n    /**\n     * Joins two sets of queries with an `OR` clause.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .or()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.or = function () {\n        return this.addModifier(\"or\");\n    };\n    /**\n     * Joins two sets of queries with a `NOT` clause. Another option for filtering results is the [prohibit operator '-'](https://developers.arcgis.com/rest/users-groups-and-items/search-reference.htm#ESRI_SECTION1_5C6C35DB9E4A4F4492C5B937BDA2BF67).\n     *\n     * ```js\n     * // omit results with \"Rivers\" in their title\n     * const query = new SearchQueryBuilder()\n     *   .not()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     *\n     * // equivalent\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Rivers\")\n     *   .in(\"-title\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.not = function () {\n        return this.addModifier(\"not\");\n    };\n    /**\n     * Begins a new range query.\n     *\n     * ```js\n     *\n     * const NEWYEARS = new Date(\"2020-01-01\")\n     * const TODAY = new Date()\n     *\n     * const query = new SearchQueryBuilder()\n     *   .from(NEWYEARS)\n     *   .to(TODAY)\n     *   .in(\"created\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.from = function (term) {\n        if (this.hasTerms) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date(\\\"2020-01-01\\\").  Your query was not modified.\");\n            return this;\n        }\n        this.rangeStack[0] = term;\n        return this;\n    };\n    /**\n     * Ends a range query.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .from(yesterdaysDate)\n     *   .to(todaysDate)\n     *   .in(\"created\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.to = function (term) {\n        if (this.hasTerms) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date(\\\"2020-01-01\\\"). Your query was not modified.\");\n            return this;\n        }\n        this.rangeStack[1] = term;\n        return this;\n    };\n    /**\n     * Boosts the previous term to increase its rank in the results.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .or()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     *   .boost(3)\n     * ```\n     */\n    SearchQueryBuilder.prototype.boost = function (num) {\n        this.commit();\n        this.q += \"^\" + num;\n        return this;\n    };\n    /**\n     * Returns the current query string. Called internally when the request is made.\n     */\n    SearchQueryBuilder.prototype.toParam = function () {\n        this.commit();\n        this.cleanup();\n        return this.q;\n    };\n    /**\n     * Returns a new instance of `SearchQueryBuilder` based on the current instance.\n     */\n    SearchQueryBuilder.prototype.clone = function () {\n        this.commit();\n        this.cleanup();\n        return new SearchQueryBuilder(this.q + \"\");\n    };\n    SearchQueryBuilder.prototype.addModifier = function (modifier) {\n        if (this.currentModifer) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"You have called `\" + this.currentModifer + \"()` after `\" + modifier + \"()`. Your current query was not modified.\");\n            return this;\n        }\n        this.commit();\n        if (this.q === \"\" && modifier !== \"not\") {\n            warn(\"You have called `\" + modifier + \"()` without calling another method to modify your query first. Try calling `match()` first.\");\n            return this;\n        }\n        this.currentModifer = modifier;\n        this.q += this.q === \"\" ? \"\" : \" \";\n        this.q += modifier.toUpperCase() + \" \";\n        return this;\n    };\n    SearchQueryBuilder.prototype.needsQuotes = function (s) {\n        return /\\s|:/g.test(s);\n    };\n    SearchQueryBuilder.prototype.formatTerm = function (term) {\n        if (term instanceof Date) {\n            return term.getTime();\n        }\n        if (typeof term === \"string\" && this.needsQuotes(term)) {\n            return \"\\\"\" + term + \"\\\"\";\n        }\n        return term;\n    };\n    SearchQueryBuilder.prototype.commit = function () {\n        var _this = this;\n        this.currentModifer = undefined;\n        if (this.hasRange) {\n            this.q += \"[\" + this.formatTerm(this.rangeStack[0]) + \" TO \" + this.formatTerm(this.rangeStack[1]) + \"]\";\n            this.rangeStack = [undefined, undefined];\n        }\n        if (this.hasTerms) {\n            this.q += this.termStack\n                .map(function (term) {\n                return _this.formatTerm(term);\n            })\n                .join(\" \");\n            this.termStack = [];\n        }\n        return this;\n    };\n    Object.defineProperty(SearchQueryBuilder.prototype, \"hasTerms\", {\n        get: function () {\n            return this.termStack.length > 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SearchQueryBuilder.prototype, \"hasRange\", {\n        get: function () {\n            return this.rangeStack.length && this.rangeStack[0] && this.rangeStack[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    SearchQueryBuilder.prototype.cleanup = function () {\n        // end a group if we have started one\n        if (this.openGroups > 0) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"Automatically closing \" + this.openGroups + \" group(s). You can use `endGroup(...)` to remove this warning.\");\n            while (this.openGroups > 0) {\n                this.q += \")\";\n                this.openGroups--;\n            }\n        }\n        var oldQ = this.q;\n        this.q = oldQ.replace(/( AND ?| NOT ?| OR ?)*$/, \"\");\n        if (oldQ !== this.q) {\n            warn(\"`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified.\");\n        }\n        // clear empty groups\n        this.q = this.q.replace(/(\\(\\))*/, \"\");\n    };\n    return SearchQueryBuilder;\n}());\nexport { SearchQueryBuilder };\n//# sourceMappingURL=SearchQueryBuilder.js.map","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { genericSearch } from \"../util/generic-search\";\n/**\n * ```js\n * import { searchItems } from \"@esri/arcgis-rest-portal\";\n * //\n * searchItems('water')\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/search.htm) for more information.\n *\n * @param search - A string or RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchItems(search) {\n    return genericSearch(search, \"item\");\n}\n//# sourceMappingURL=search.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, appendCustomParams, } from \"@esri/arcgis-rest-request\";\nimport { SearchQueryBuilder } from \"./SearchQueryBuilder\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nexport function genericSearch(search, searchType) {\n    var options;\n    if (typeof search === \"string\" || search instanceof SearchQueryBuilder) {\n        options = {\n            httpMethod: \"GET\",\n            params: {\n                q: search,\n            },\n        };\n    }\n    else {\n        // searchUserAccess has one (knonw) valid value: \"groupMember\"\n        options = appendCustomParams(search, [\n            \"q\",\n            \"num\",\n            \"start\",\n            \"sortField\",\n            \"sortOrder\",\n            \"searchUserAccess\",\n            \"searchUserName\",\n            \"filter\",\n            \"countFields\",\n            \"countSize\",\n            \"categories\",\n            \"categoryFilters\",\n        ], {\n            httpMethod: \"GET\",\n        });\n    }\n    var path;\n    switch (searchType) {\n        case \"item\":\n            path = \"/search\";\n            break;\n        case \"group\":\n            path = \"/community/groups\";\n            break;\n        case \"groupContent\":\n            // Need to have groupId property to do group contents search,\n            // cso filter out all but ISearchGroupContentOptions\n            if (typeof search !== \"string\" &&\n                !(search instanceof SearchQueryBuilder) &&\n                search.groupId) {\n                path = \"/content/groups/\" + search.groupId + \"/search\";\n            }\n            else {\n                return Promise.reject(new Error(\"you must pass a `groupId` option to `searchGroupContent`\"));\n            }\n            break;\n        default:\n            // \"users\"\n            path = \"/portals/self/users/search\";\n            break;\n    }\n    var url = getPortalUrl(options) + path;\n    // send the request\n    return request(url, options).then(function (r) {\n        if (r.nextStart && r.nextStart !== -1) {\n            r.nextPage = function () {\n                var newOptions;\n                if (typeof search === \"string\" ||\n                    search instanceof SearchQueryBuilder) {\n                    newOptions = {\n                        q: search,\n                        start: r.nextStart,\n                    };\n                }\n                else {\n                    newOptions = search;\n                    newOptions.start = r.nextStart;\n                }\n                return genericSearch(newOptions, searchType);\n            };\n        }\n        return r;\n    });\n}\n//# sourceMappingURL=generic-search.js.map","/* Copyright (c) 2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nexport function chunk(array, size) {\n    if (array.length === 0) {\n        return [];\n    }\n    var chunks = [];\n    for (var i = 0; i < array.length; i += size) {\n        chunks.push(array.slice(i, i + size));\n    }\n    return chunks;\n}\n//# sourceMappingURL=array.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign, __spreadArrays } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n/**\n * ```js\n * import { addGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * addGroupUsers({\n *   id: groupId,\n *   users: [\"username1\", \"username2\"],\n *   admins: [\"username3\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Add users to a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-users-to-group.htm) for more information.\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function addGroupUsers(requestOptions) {\n    var id = requestOptions.id;\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/addUsers\";\n    var baseOptions = Object.assign({}, requestOptions, {\n        admins: undefined,\n        users: undefined\n    });\n    var batchRequestOptions = __spreadArrays(_prepareRequests(\"users\", requestOptions.users, baseOptions), _prepareRequests(\"admins\", requestOptions.admins, baseOptions));\n    var promises = batchRequestOptions.map(function (options) {\n        return _sendSafeRequest(url, options);\n    });\n    return Promise.all(promises).then(_consolidateRequestResults);\n}\nfunction _prepareRequests(type, usernames, baseOptions) {\n    if (!usernames || usernames.length < 1) {\n        return [];\n    }\n    // the ArcGIS REST API only allows to add no more than 25 users per request,\n    // see https://developers.arcgis.com/rest/users-groups-and-items/add-users-to-group.htm\n    var userChunks = chunk(usernames, 25);\n    return userChunks.map(function (users) {\n        return _generateRequestOptions(type, users, baseOptions);\n    });\n}\nfunction _generateRequestOptions(type, usernames, baseOptions) {\n    var _a, _b;\n    return Object.assign({}, baseOptions, (_a = {},\n        _a[type] = usernames,\n        _a.params = __assign(__assign({}, baseOptions.params), (_b = {}, _b[type] = usernames, _b)),\n        _a));\n}\n// this request is safe since the request error will be handled\nfunction _sendSafeRequest(url, requestOptions) {\n    return request(url, requestOptions).catch(function (error) {\n        return {\n            errors: [error]\n        };\n    });\n}\nfunction _consolidateRequestResults(results) {\n    var notAdded = results\n        .filter(function (result) { return result.notAdded; })\n        .reduce(function (collection, result) { return collection.concat(result.notAdded); }, []);\n    var errors = results\n        .filter(function (result) { return result.errors; })\n        .reduce(function (collection, result) { return collection.concat(result.errors); }, []);\n    var consolidated = { notAdded: notAdded };\n    if (errors.length > 0) {\n        consolidated.errors = errors;\n    }\n    return consolidated;\n}\n//# sourceMappingURL=add-users.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n/**\n * ```js\n * import { removeGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * removeGroupUsers({\n *   id: groupId,\n *   users: [\"username1\", \"username2\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Add users to a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/remove-users-from-group.htm) for more information.\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function removeGroupUsers(requestOptions) {\n    var id = requestOptions.id, usersToRemove = requestOptions.users;\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/removeUsers\";\n    var safeSend = function (users) {\n        var options = __assign(__assign({}, requestOptions), { users: users, params: { users: users } });\n        return request(url, options)\n            .catch(function (error) { return ({ errors: [error] }); });\n    };\n    // the ArcGIS REST API only allows to add no more than 25 users per request,\n    // see https://developers.arcgis.com/rest/users-groups-and-items/remove-users-from-group.htm\n    var promises = chunk(usersToRemove, 25).map(function (usersChunk) { return safeSend(usersChunk); });\n    return Promise.all(promises)\n        .then(function (results) {\n        var filtered = function (propName) { return results\n            .filter(function (result) { return result[propName]; })\n            .reduce(function (collection, result) { return collection.concat(result[propName]); }, []); };\n        var errors = filtered('errors');\n        var consolidated = { notRemoved: filtered('notRemoved') };\n        return errors.length ? __assign(__assign({}, consolidated), { errors: errors }) : consolidated;\n    });\n}\n//# sourceMappingURL=remove-users.js.map","import { getPortalUrl } from \"../util/get-portal-url\";\nimport { request } from \"@esri/arcgis-rest-request\";\n/**\n * ```js\n * import { updateUserMemberships } from \"@esri/arcgis-rest-portal\";\n * //\n * updateUserMemberships({\n *   id: groupId,\n *   admins: [\"username3\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Change the user membership levels of existing users in a group\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function updateUserMemberships(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.id + \"/updateUsers\";\n    var opts = {\n        authentication: requestOptions.authentication,\n        params: {}\n    };\n    // add the correct params depending on the type of membership we are changing to\n    if (requestOptions.newMemberType === \"admin\") {\n        opts.params.admins = requestOptions.users;\n    }\n    else {\n        opts.params.users = requestOptions.users;\n    }\n    // make the request\n    return request(url, opts);\n}\n//# sourceMappingURL=update-user-membership.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { getUser } from '@esri/arcgis-rest-portal';\n * //\n * getUser(\"jsmith\")\n *   .then(response)\n * // => { firstName: \"John\", lastName: \"Smith\",tags: [\"GIS Analyst\", \"City of Redlands\"] }\n * ```\n * Get information about a user. This method has proven so generically useful that you can also call [`UserSession.getUser()`](/arcgis-rest-js/api/auth/UserSession#getUser-summary).\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with metadata about the user\n */\nexport function getUser(requestOptions) {\n    var url;\n    var options = { httpMethod: \"GET\" };\n    // if a username is passed, assume ArcGIS Online\n    if (typeof requestOptions === \"string\") {\n        url = \"https://www.arcgis.com/sharing/rest/community/users/\" + requestOptions;\n    }\n    else {\n        // if an authenticated session is passed, default to that user/portal unless another username is provided manually\n        var username = requestOptions.username || requestOptions.authentication.username;\n        url = getPortalUrl(requestOptions) + \"/community/users/\" + encodeURIComponent(username);\n        options = __assign(__assign({}, requestOptions), options);\n    }\n    // send the request\n    return request(url, options);\n}\n//# sourceMappingURL=get-user.js.map","import { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { getUserMembership, } from \"./helpers\";\nimport { getUser } from \"../users/get-user\";\nimport { addGroupUsers } from \"../groups/add-users\";\nimport { removeGroupUsers } from \"../groups/remove-users\";\nimport { updateUserMemberships, } from \"../groups/update-user-membership\";\nimport { isItemSharedWithGroup } from \"../sharing/is-item-shared-with-group\";\n/**\n * ```js\n * import { shareItemWithGroup } from '@esri/arcgis-rest-portal';\n * //\n * shareItemWithGroup({\n *   id: \"abc123\",\n *   groupId: \"xyz987\",\n *   owner: \"some-owner\",\n *   authentication\n * })\n * ```\n * Share an item with a group, either as an\n * [item owner](https://developers.arcgis.com/rest/users-groups-and-items/share-item-as-item-owner-.htm),\n * [group admin](https://developers.arcgis.com/rest/users-groups-and-items/share-item-as-group-admin-.htm) or\n * organization admin.\n *\n * Note: Sharing the item as an Admin will use the `/content/users/:ownername/items/:itemid/share` end-point\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function shareItemWithGroup(requestOptions) {\n    return isItemSharedWithGroup(requestOptions)\n        .then(function (isShared) {\n        if (isShared) {\n            // already shared, exit early with success response\n            return {\n                itemId: requestOptions.id,\n                shortcut: true,\n                notSharedWith: [],\n            };\n        }\n        var username = requestOptions.authentication.username, owner = requestOptions.owner, confirmItemControl = requestOptions.confirmItemControl;\n        var itemOwner = owner || username;\n        // non-item owner\n        if (itemOwner !== username) {\n            // need to track if the user is an admin\n            var isAdmin_1 = false;\n            // track if the admin & owner are in the same org\n            var isCrossOrgSharing_1 = false;\n            // next perform any necessary membership adjustments for\n            // current user and/or item owner\n            return Promise.all([\n                getUser({\n                    username: username,\n                    authentication: requestOptions.authentication,\n                }),\n                getUser({\n                    username: itemOwner,\n                    authentication: requestOptions.authentication,\n                }),\n                getUserMembership(requestOptions),\n            ])\n                .then(function (_a) {\n                var currentUser = _a[0], ownerUser = _a[1], membership = _a[2];\n                var isSharedEditingGroup = !!confirmItemControl;\n                isAdmin_1 = currentUser.role === \"org_admin\" && !currentUser.roleId;\n                isCrossOrgSharing_1 = currentUser.orgId !== ownerUser.orgId;\n                return getMembershipAdjustments(currentUser, isSharedEditingGroup, membership, isAdmin_1, ownerUser, requestOptions);\n            })\n                .then(function (membershipAdjustments) {\n                var _a = membershipAdjustments[0], revert = (_a === void 0 ? {\n                    promise: Promise.resolve({ notAdded: [] }),\n                    revert: function (sharingResults) {\n                        return Promise.resolve(sharingResults);\n                    },\n                } : _a).revert;\n                // perform all membership adjustments\n                return Promise.all(membershipAdjustments.map(function (_a) {\n                    var promise = _a.promise;\n                    return promise;\n                }))\n                    .then(function () {\n                    // then attempt the share\n                    return shareToGroup(requestOptions, isAdmin_1, isCrossOrgSharing_1);\n                })\n                    .then(function (sharingResults) {\n                    // lastly, if the admin user was added to the group,\n                    // remove them from the group. this is a no-op that\n                    // immediately resolves the sharingResults when no\n                    // membership adjustment was needed\n                    return revert(sharingResults);\n                });\n            });\n        }\n        // item owner, let it call through\n        return shareToGroup(requestOptions);\n    })\n        .then(function (sharingResponse) {\n        if (sharingResponse.notSharedWith.length) {\n            throw Error(\"Item \" + requestOptions.id + \" could not be shared to group \" + requestOptions.groupId + \".\");\n        }\n        else {\n            // all is well\n            return sharingResponse;\n        }\n    });\n}\nfunction getMembershipAdjustments(currentUser, isSharedEditingGroup, membership, isAdmin, ownerUser, requestOptions) {\n    var membershipGuarantees = [];\n    if (requestOptions.groupId !== currentUser.favGroupId) {\n        if (isSharedEditingGroup) {\n            if (!isAdmin) {\n                // abort and reject promise\n                throw Error(\"This item can not be shared to shared editing group \" + requestOptions.groupId + \" by \" + currentUser.username + \" as they not the item owner or org admin.\");\n            }\n            membershipGuarantees.push(\n            // admin user must be a group member to share, should be reverted afterwards\n            ensureMembership(currentUser, currentUser, false, \"Error adding \" + currentUser.username + \" as member to edit group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\", requestOptions), \n            // item owner must be a group admin\n            ensureMembership(currentUser, ownerUser, true, membership === \"none\"\n                ? \"Error adding user \" + ownerUser.username + \" to edit group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\"\n                : \"Error promoting user \" + ownerUser.username + \" to admin in edit group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\", requestOptions));\n        }\n        else if (isAdmin) {\n            // admin user must be a group member to share, should be reverted afterwards\n            membershipGuarantees.push(ensureMembership(currentUser, currentUser, false, \"Error adding \" + currentUser.username + \" as member to view group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\", requestOptions));\n        }\n        else if (membership === \"none\") {\n            // all other non-item owners must be a group member\n            throw new Error(\"This item can not be shared by \" + currentUser.username + \" as they are not a member of the specified group \" + requestOptions.groupId + \".\");\n        }\n    }\n    return membershipGuarantees;\n}\nfunction shareToGroup(requestOptions, isAdmin, isCrossOrgSharing) {\n    if (isAdmin === void 0) { isAdmin = false; }\n    if (isCrossOrgSharing === void 0) { isCrossOrgSharing = false; }\n    var username = requestOptions.authentication.username;\n    var itemOwner = requestOptions.owner || username;\n    // decide what url to use\n    // default to the non-owner url...\n    var url = getPortalUrl(requestOptions) + \"/content/items/\" + requestOptions.id + \"/share\";\n    // but if they are the owner, or org_admin, use this route\n    // Note: When using this end-point as an admin, apparently the admin does not need to be a member of the group (the itemOwner does)\n    // Note: Admin's can only use this route when the item is in the same org they are admin for\n    if (itemOwner === username || (isAdmin && !isCrossOrgSharing)) {\n        url = getPortalUrl(requestOptions) + \"/content/users/\" + itemOwner + \"/items/\" + requestOptions.id + \"/share\";\n    }\n    // now its finally time to do the sharing\n    requestOptions.params = {\n        groups: requestOptions.groupId,\n        confirmItemControl: requestOptions.confirmItemControl,\n    };\n    return request(url, requestOptions);\n}\nexport function ensureMembership(currentUser, ownerUser, shouldPromote, errorMessage, requestOptions) {\n    var _a;\n    var ownerGroups = ownerUser.groups || [];\n    var group = ownerGroups.find(function (g) {\n        return g.id === requestOptions.groupId;\n    });\n    // if they are in different orgs, eject\n    if (currentUser.orgId !== ownerUser.orgId) {\n        throw Error(\"User \" + ownerUser.username + \" is not a member of the same org as \" + currentUser.username + \". Consequently they can not be added added to group \" + requestOptions.groupId + \" nor can item \" + requestOptions.id + \" be shared to the group.\");\n    }\n    // if owner is not a member, and has 512 groups\n    if (!group && ownerGroups.length > 511) {\n        throw Error(\"User \" + ownerUser.username + \" already has 512 groups, and can not be added to group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" can not be shared to the group.\");\n    }\n    var promise;\n    var revert;\n    // decide if we need to add them or upgrade them\n    if (group) {\n        // they are in the group...\n        // check member type\n        if (shouldPromote && group.userMembership.memberType === \"member\") {\n            // promote them\n            promise = updateUserMemberships({\n                id: requestOptions.groupId,\n                users: [ownerUser.username],\n                newMemberType: \"admin\",\n                authentication: requestOptions.authentication,\n            })\n                .then(function (results) {\n                // convert the result into the right type\n                var notAdded = results.results.reduce(function (acc, entry) {\n                    if (!entry.success) {\n                        acc.push(entry.username);\n                    }\n                    return acc;\n                }, []);\n                // and return it\n                return Promise.resolve({ notAdded: notAdded });\n            })\n                .catch(function () { return ({ notAdded: [ownerUser.username] }); });\n            revert = function (sharingResults) {\n                return updateUserMemberships({\n                    id: requestOptions.groupId,\n                    users: [ownerUser.username],\n                    newMemberType: \"member\",\n                    authentication: requestOptions.authentication,\n                })\n                    .then(function () { return sharingResults; })\n                    .catch(function () { return sharingResults; });\n            };\n        }\n        else {\n            // they are already an admin in the group\n            // return the same response the API would if we added them\n            promise = Promise.resolve({ notAdded: [] });\n            revert = function (sharingResults) { return Promise.resolve(sharingResults); };\n        }\n    }\n    else {\n        // attempt to add user to group\n        var userType = shouldPromote ? \"admins\" : \"users\";\n        // can't currently determine if the group is within the admin's\n        // org without performing a search, so attempt to add and handle\n        // the api error\n        promise = addGroupUsers((_a = {\n                id: requestOptions.groupId\n            },\n            _a[userType] = [ownerUser.username],\n            _a.authentication = requestOptions.authentication,\n            _a))\n            .then(function (results) {\n            // results.errors includes an ArcGISAuthError when the group\n            // is in a different org, but notAdded is empty, throw here\n            // to normalize the results in below catch\n            if (results.errors && results.errors.length) {\n                throw results.errors[0];\n            }\n            return results;\n        })\n            .catch(function () { return ({ notAdded: [ownerUser.username] }); });\n        revert = function (sharingResults) {\n            return removeGroupUsers({\n                id: requestOptions.groupId,\n                users: [ownerUser.username],\n                authentication: requestOptions.authentication,\n            }).then(function () {\n                // always resolves, suppress any resolved errors\n                return sharingResults;\n            });\n        };\n    }\n    return {\n        promise: promise.then(function (membershipResponse) {\n            if (membershipResponse.notAdded.length) {\n                throw new Error(errorMessage);\n            }\n            return membershipResponse;\n        }),\n        revert: revert,\n    };\n}\n//# sourceMappingURL=share-item-with-group.js.map","import { searchItems } from \"../items/search\";\n/**\n * ```js\n * import { isItemSharedWithGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * isItemSharedWithGroup({\n *   groupId: 'bc3,\n *   itemId: 'f56,\n *   authentication\n * })\n * .then(isShared => {})\n * ```\n * Find out whether or not an item is already shared with a group.\n *\n * @param requestOptions - Options for the request. NOTE: `rawResponse` is not supported by this operation.\n * @returns Promise that will resolve with true/false\n */\nexport function isItemSharedWithGroup(requestOptions) {\n    var searchOpts = {\n        q: \"id: \" + requestOptions.id + \" AND group: \" + requestOptions.groupId,\n        start: 1,\n        num: 10,\n        sortField: \"title\",\n        authentication: requestOptions.authentication,\n        httpMethod: \"POST\"\n    };\n    return searchItems(searchOpts).then(function (searchResponse) {\n        var result = false;\n        if (searchResponse.total > 0) {\n            result = searchResponse.results.some(function (itm) {\n                return itm.id === requestOptions.id;\n            });\n            return result;\n        }\n    });\n}\n//# sourceMappingURL=is-item-shared-with-group.js.map","import { serializeModel, getModel, getProp, mergeObjects } from \"@esri/hub-common\";\nimport { updateItem } from \"@esri/arcgis-rest-portal\";\n/**\n * Update a Page item\n * @param {Object} model Page Model\n * @param {IUpdatePageOptions} updateSiteOptions\n *\n * This function supports the equivalent of a PATCH REST operation\n * It will fetch the current item from ago, and then apply\n * a subset of property changes to the model if a patchList is included.\n * The patchList can include any property paths on the item.\n * If the list is empty, then the entire page model is overwritten.\n * TODO: Add calls to remove unused image resources\n */\nexport function updatePage(model, updateSiteOptions) {\n    var patchList = Array.isArray(updateSiteOptions.allowList)\n        ? updateSiteOptions.allowList\n        : [];\n    // store info about last update and who did it\n    model.data.values.updatedAt = new Date().toISOString();\n    model.data.values.updatedBy = updateSiteOptions.authentication.username;\n    // nuke out the url property just for good measure\n    model.item.url = \"\";\n    var prms = Promise.resolve(model);\n    if (patchList.length) {\n        prms = getModel(getProp(model, \"item.id\"), updateSiteOptions);\n    }\n    return prms.then(function (modelFromAGO) {\n        if (patchList.length) {\n            // \"patch\" operation\n            model = mergeObjects(model, modelFromAGO, patchList);\n        }\n        // update it\n        var opts = Object.assign({ item: serializeModel(model) }, updateSiteOptions);\n        opts.params = { clearEmptyFields: true };\n        return updateItem(opts);\n    });\n}\n//# sourceMappingURL=update-page.js.map","import { getProp } from \"@esri/hub-common\";\nfunction getPaths(componentName) {\n    switch (componentName) {\n        case \"webmap-card\":\n            return [\"component.settings.webmap\"];\n        case \"survey-card\":\n            return [\"component.settings.surveyId\"];\n        case \"app-card\":\n            return [\"component.settings.itemId\"];\n        case \"summary-statistic-card\":\n            return [\"component.settings.itemId\"];\n        case \"items/gallery-card\":\n            return [\"component.settings.ids\"];\n        default:\n            return [];\n    }\n}\n/**\n * Find all the paths dependencies for the given card\n *\n * @param {ICard} card\n */\nexport function getCardDependencies(card) {\n    var componentName = getProp(card, \"component.name\");\n    var paths = getPaths(componentName);\n    return paths.reduce(collectAndFlattenPropertyValues(card), []);\n}\nfunction collectAndFlattenPropertyValues(card) {\n    return function (acc, path) {\n        var propertyValue = getProp(card, path);\n        if (!propertyValue) {\n            return acc;\n        }\n        if (Array.isArray(propertyValue)) {\n            return acc.concat(propertyValue);\n        }\n        else {\n            return acc.concat([propertyValue]);\n        }\n    };\n}\n//# sourceMappingURL=get-card-dependencies.js.map","import { getCardDependencies } from \"./get-card-dependencies\";\n/**\n * Find all the cards for the given row\n *\n * @param {IRow} row\n */\nexport function getRowDependencies(row) {\n    return row.cards.reduce(function (deps, card) {\n        var cardDeps = getCardDependencies(card);\n        if (cardDeps.length) {\n            deps = deps.concat(cardDeps);\n        }\n        return deps;\n    }, []);\n}\n//# sourceMappingURL=get-row-dependencies.js.map","import { getRowDependencies } from \"./get-row-dependencies\";\n/**\n * Find all the row and card dependencies for the given section\n *\n * @param {ISection} section\n */\nexport function getSectionDependencies(section) {\n    return section.rows.reduce(function (deps, row) {\n        return deps.concat(getRowDependencies(row));\n    }, []);\n}\n//# sourceMappingURL=get-section-dependencies.js.map","import { getSectionDependencies } from \"./get-section-dependencies\";\n/**\n * Find all the section/row/card dependencies for the given layout\n *\n * @param {ILayout} layout\n */\nexport function getLayoutDependencies(layout) {\n    return layout.sections.reduce(function (deps, section) {\n        return deps.concat(getSectionDependencies(section));\n    }, []);\n}\n//# sourceMappingURL=get-layout-dependencies.js.map","/**\n * The item type depends if the app is running\n * in ArcGIS Enterprise vs AGO\n * @param {boolean} isPortal Is this running in Enterprise?\n */\nexport function getPageItemType(isPortal) {\n    var type = \"Hub Page\";\n    if (isPortal) {\n        type = \"Site Page\";\n    }\n    return type;\n}\n//# sourceMappingURL=get-page-item-type.js.map","export var PAGE_TYPE_KEYWORD = \"hubPage\";\n//# sourceMappingURL=page-type-keyword.js.map","import { cloneObject } from \"@esri/hub-common\";\nimport { getPageItemType } from \"./get-page-item-type\";\nimport { PAGE_TYPE_KEYWORD } from \"./page-type-keyword\";\n/**\n * Given a Page Model, ensure that it has all the requires properties set correctly\n * and return a new object\n * @param {Object} pageModel Page Model object\n * @param {Object} options {username, isPortal}\n */\nexport function ensureRequiredPageProperties(pageModel, options) {\n    // clone\n    var result = cloneObject(pageModel);\n    result.item.owner = options.username;\n    result.item.access = \"private\";\n    if (!result.data.values) {\n        result.data.values = {};\n    }\n    result.data.values.updatedAt = new Date().toISOString();\n    result.data.values.updatedBy = options.username;\n    if (!result.data.values.sites) {\n        result.data.values.sites = [];\n    }\n    // NOTE: until we have hub-home, we are setting the page url to ''\n    if (result.item.url) {\n        result.item.url = \"\";\n    }\n    result.item.type = getPageItemType(options.isPortal);\n    // ensure it has the typeKeyword\n    if (result.item.typeKeywords.indexOf(PAGE_TYPE_KEYWORD) === -1) {\n        result.item.typeKeywords.push(PAGE_TYPE_KEYWORD);\n    }\n    return result;\n}\n//# sourceMappingURL=ensure-required-page-properties.js.map","import { getModelFromOptions, includes, getProp, serializeModel, mapBy, ensureUniqueString, slugify, maybePush, failSafe, shareItemToGroups, deepSet } from \"@esri/hub-common\";\nimport { updateItem } from \"@esri/arcgis-rest-portal\";\nimport { isSite } from \"./is-site\";\n/**\n * Link a Page and a Site, or vice-versa\n * This is a super tolerant function. It can be passed id's, models or a mix.\n * It will handle either the site or the page items being missing\n * It will handle cases where the current user lacks update privs to either item or rights\n * to change the sharing. Of course in those cases we clearly can't make the changes, and\n * this function will resolve as though they were made, usually the UI tier will have\n * ensured that the current user has write access to at least one of the main entities\n * @param {ILinkPageAndSiteRequestOptions} linkRequestOptions {siteModel || siteId, pageModel || pageId, authorization }\n */\nexport function linkSiteAndPage(linkRequestOptions) {\n    var shareGroups = [];\n    var promises = [];\n    var pageModel;\n    var siteModel;\n    var requestOptions = { authentication: linkRequestOptions.authentication };\n    // get the models from the options...\n    return Promise.all([\n        getModelFromOptions(\"page\", linkRequestOptions),\n        getModelFromOptions(\"site\", linkRequestOptions)\n    ])\n        .then(function (models) {\n        // Should we handle either item being inaccessible?\n        pageModel = models[0], siteModel = models[1];\n        if (!siteModel.isMissing && !pageModel.isMissing) {\n            // ensure we actually got a page and site\n            if (!isSite(siteModel.item) ||\n                !includes([\"Hub Page\", \"Site Page\"], pageModel.item.type)) {\n                return Promise.resolve([]);\n            }\n            // if we got a both...\n            // Link the Site into the Page...\n            var siteEntry = {\n                id: siteModel.item.id,\n                title: siteModel.item.title\n            };\n            if (!getProp(pageModel, \"data.values.sites\")) {\n                deepSet(pageModel, \"data.values.sites\", []);\n            }\n            var sites = getProp(pageModel, \"data.values.sites\");\n            var hasSiteAlready = includes(sites.map(function (p) { return p.id; }), siteEntry.id);\n            if (!hasSiteAlready) {\n                pageModel.data.values.sites.push(siteEntry);\n                var opts = Object.assign({ item: serializeModel(pageModel) }, requestOptions);\n                // Not failsafe - could reject\n                promises.push(updateItem(opts));\n            }\n            // Link the Page into the Site\n            var pageEntry = {\n                id: pageModel.item.id,\n                title: pageModel.item.title\n            };\n            if (!getProp(siteModel, \"data.values.pages\")) {\n                deepSet(siteModel, \"data.values.pages\", []);\n            }\n            var pages = getProp(siteModel, \"data.values.pages\");\n            var hasPageAlready = includes(pages.map(function (p) { return p.id; }), pageEntry.id);\n            if (!hasPageAlready) {\n                var slugs = mapBy(\"slug\", pages);\n                // use the passed in slug, or generate a unique slug and add to the page entry...\n                pageEntry.slug =\n                    linkRequestOptions.pageSlug ||\n                        ensureUniqueString(slugs, slugify(pageEntry.title));\n                // push entry into pages array...\n                siteModel.data.values.pages.push(pageEntry);\n                // update the site item...\n                var opts = Object.assign({ item: serializeModel(siteModel) }, requestOptions);\n                // Not failsafe - could reject\n                promises.push(updateItem(opts));\n            }\n            // Now we need to handle sharing of the Page to the site Collab & Content groups\n            // The share functions handle pre-flights so we don't need to be concerned if the page is\n            // somehow already shared to the group.\n            shareGroups = maybePush(getProp(siteModel, \"item.properties.collaborationGroupId\"), shareGroups);\n            shareGroups = maybePush(getProp(siteModel, \"item.properties.contentGroupId\"), shareGroups);\n            // NOTE: Since sharing is limited to the owner || admin we failSafe the calls, and hope for the best.\n            var failSafeShare = failSafe(shareItemToGroups);\n            promises.push(failSafeShare(pageEntry.id, shareGroups, requestOptions));\n            // return all the promises...\n            return Promise.all(promises);\n        }\n        else {\n            var msg = \"The Page item (\" + pageModel.item.id + \") is inaccessible.\";\n            if (siteModel.isMissing) {\n                if (pageModel.isMissing) {\n                    msg = \"Both the Page item (\" + pageModel.item.id + \") and the Site item (\" + siteModel.item.id + \") are inaccssible\";\n                }\n                else {\n                    msg = \"The Site item (\" + siteModel.item.id + \") is inaccessible.\";\n                }\n            }\n            throw new Error(\"Linking Failed: \" + msg);\n        }\n    })\n        .then(function () {\n        // Downside of optionally pusing entries into a promise array, is that you don't really know\n        // what is in what index, so we really can't use the return values...\n        return {\n            pageModel: pageModel,\n            siteModel: siteModel\n        };\n    })\n        .catch(function (err) {\n        throw Error(\"Error occured linking site \" + siteModel.item.id + \" with \" + pageModel.item.id + \": \" + err);\n    });\n}\n//# sourceMappingURL=link-site-and-page.js.map","import { getProp } from \"@esri/hub-common\";\n/**\n * Traverse the layout graph, locating any cards that may have image resources\n * returning an array containing the resource information.\n * @param {Object} layout the layout to extract image cropIds from\n * @private\n */\nexport function _getImageCropIdsFromLayout(layout) {\n    var imgAssets = [];\n    var headerLogo = getProp(layout, \"header.component.settings.logo\");\n    if (headerLogo && headerLogo.cropId) {\n        imgAssets.push(headerLogo);\n    }\n    var sections = getProp(layout, \"sections\") || [];\n    return sections\n        .reduce(collectSectionAssets, imgAssets)\n        .filter(hasCropId)\n        .map(extractCropId);\n}\nfunction collectSectionAssets(assets, section) {\n    var sectionAssets = section.rows\n        .reduce(collectCards, [])\n        .filter(isImageOrJumbotronCard)\n        .map(extractSettingsProperty);\n    // retain crop info if section has an image background\n    if (getProp(section, \"style.background.cropSrc\")) {\n        sectionAssets.unshift(section.style.background);\n    }\n    return assets.concat(sectionAssets);\n}\nfunction collectCards(acc, row) {\n    return acc.concat(row.cards);\n}\nfunction isImageOrJumbotronCard(card) {\n    return [\"image-card\", \"jumbotron-card\"].indexOf(card.component.name) > -1;\n}\nfunction extractSettingsProperty(card) {\n    return card.component.settings;\n}\nfunction hasCropId(entry) {\n    return !!entry.cropId;\n}\nfunction extractCropId(entry) {\n    return entry.cropId;\n}\n//# sourceMappingURL=_get-image-crop-ids-from-layout.js.map","import { cloneObject, getProp } from \"@esri/hub-common\";\nvar converters = {\n    \"event-list-card\": convertEventListCard,\n    \"follow-initiative-card\": convertFollowCard,\n    \"items/gallery-card\": convertItemGalleryCard,\n    \"image-card\": convertImageCard,\n    \"jumbotron-card\": convertImageCard\n};\n/**\n * Convert a card to a templatized version of itself\n * @param {ICard} card the card to templatize\n */\nexport function convertCard(card) {\n    var clone = cloneObject(card);\n    var converter = converters[clone.component.name];\n    if (converter) {\n        return converter(clone);\n    }\n    return {\n        card: clone,\n        assets: []\n    };\n}\nfunction convertEventListCard(card) {\n    card.component.settings.initiativeIds = [\"{{initiative.item.id}}\"];\n    return { card: card, assets: [] };\n}\nfunction convertFollowCard(card) {\n    card.component.settings.initiativeId = \"{{initiative.item.id}}\";\n    return { card: card, assets: [] };\n}\nfunction convertImageCard(card) {\n    var result = {\n        card: card,\n        assets: []\n    };\n    if (getProp(card, \"component.settings.fileSrc\")) {\n        result.assets.push(card.component.settings.fileSrc);\n    }\n    if (getProp(card, \"component.settings.cropSrc\")) {\n        result.assets.push(card.component.settings.cropSrc);\n    }\n    return result;\n}\nfunction convertItemGalleryCard(card) {\n    var settings = card.component.settings;\n    var version = getProp(settings, \"version\");\n    if (getProp(settings, \"groups\") && version < 4) {\n        settings.groups = [\n            {\n                title: \"{{solution.title}}\",\n                id: \"{{teams.contentGroupId}}\"\n            }\n        ];\n    }\n    if (getProp(settings, \"query.groups\")) {\n        if (version >= 4) {\n            settings.query.groups = [\"{{teams.contentGroupId}}\"];\n        }\n        else {\n            settings.query.groups = [\n                {\n                    title: \"{{solution.title}}\",\n                    id: \"{{teams.contentGroupId}}\"\n                }\n            ];\n        }\n    }\n    if (getProp(settings, \"query.orgId\")) {\n        settings.query.orgId = \"{{organization.id}}\";\n    }\n    if (getProp(settings, \"orgId\")) {\n        settings.orgId = \"{{organization.id}}\";\n    }\n    if (settings.siteId) {\n        settings.siteId = \"{{appid}}\";\n    }\n    return { card: card, assets: [] };\n}\n//# sourceMappingURL=convert-card.js.map","import { convertCard } from \"./convert-card\";\n/**\n * Convert a row, collecting assets along the way...\n * @param {IRow} row the row to templatize\n */\nexport function convertRow(row) {\n    // if the section has a background image, and it has a url, we should\n    // add that to the asset hash so it can be downloaded and added to the template item\n    // and also cook some unique asset name so we can inject a placeholder\n    return row.cards.reduce(convertToTemplatizedCard, { assets: [], cards: [] });\n}\nfunction convertToTemplatizedCard(acc, card) {\n    var result = convertCard(card);\n    acc.assets = acc.assets.concat(result.assets);\n    acc.cards.push(result.card);\n    return acc;\n}\n//# sourceMappingURL=convert-row.js.map","/**\n * Extract the fileSrc and cropSrc assets from settings.\n *\n * @param {ISettings} settings\n */\nexport function extractAssets(settings) {\n    var assets = [];\n    if (settings.fileSrc) {\n        assets.push(settings.fileSrc);\n    }\n    if (settings.cropSrc) {\n        assets.push(settings.cropSrc);\n    }\n    return assets;\n}\n//# sourceMappingURL=extract-assets.js.map","import { cloneObject, getProp } from \"@esri/hub-common\";\nimport { convertRow } from \"./convert-row\";\nimport { extractAssets } from \"./extract-assets\";\n/**\n * Convert a section, collecting assets along the way...\n * @param {ISection} section the section to templatize\n */\nexport function convertSection(section) {\n    var _a;\n    // if the section has a background image, and it has a url, we should\n    // add that to the asset hash so it can be downloaded and added to the template item\n    // and also cook some unique asset name so we can inject a placeholder\n    var _b = section.rows.reduce(toTemplatizedRows, {\n        assets: [],\n        rows: []\n    }), rows = _b.rows, assets = _b.assets;\n    var result = {\n        section: cloneObject(section),\n        assets: assets\n    };\n    result.section.rows = rows;\n    if (sectionHasBackgroundFile(section)) {\n        (_a = result.assets).push.apply(_a, extractAssets(section.style.background));\n    }\n    return result;\n}\nfunction toTemplatizedRows(acc, row) {\n    var _a;\n    var _b = convertRow(row), assets = _b.assets, cards = _b.cards;\n    (_a = acc.assets).push.apply(_a, assets);\n    acc.rows.push({ cards: cards });\n    return acc;\n}\nfunction sectionHasBackgroundFile(clonedSection) {\n    return getProp(clonedSection, \"style.background.fileSrc\");\n}\n//# sourceMappingURL=convert-section.js.map","import { cloneObject } from \"@esri/hub-common\";\nimport { convertSection } from \"./convert-section\";\n/**\n * Convert a layout to a templatized version of itself\n * @param {ILayout} layout the layout to templatize\n */\nexport function convertLayoutToTemplate(layout) {\n    if (!layout) {\n        return null;\n    }\n    // walk the sections, rows, cards... then call to fn's to convert specific cards...\n    var converted = layout.sections.reduce(function (acc, section) {\n        var _result = convertSection(section);\n        acc.assets = acc.assets.concat(_result.assets);\n        acc.sections.push(_result.section);\n        return acc;\n    }, { assets: [], sections: [] });\n    // assemble the response\n    var result = {\n        assets: converted.assets,\n        layout: {\n            sections: converted.sections\n        }\n    };\n    if (layout.header) {\n        result.layout.header = cloneObject(layout.header);\n    }\n    if (layout.footer) {\n        result.layout.footer = cloneObject(layout.footer);\n    }\n    return result;\n}\n//# sourceMappingURL=convert-layout-to-template.js.map","import { failSafe } from \"@esri/hub-common\";\nimport { getItemResources, removeItemResource } from \"@esri/arcgis-rest-portal\";\nimport { _getImageCropIdsFromLayout } from \"./_get-image-crop-ids-from-layout\";\n/**\n * THIS UTIL IS NO LONGER IN USE BUT MAY BE IN THE FUTURE - TATE\n */\n/**\n * Removes any image \"crop\" versions that are no longer\n * used in the site layout.\n * TODO: Move to a module that is shared with Pages and then\n * also wire into the Page update cycle.\n * @param {String} id Id of the site or page item\n * @param {Object} layout Layout\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function removeUnusedResources(id, layout, hubRequestOptions) {\n    var layoutImageCropIds = _getImageCropIdsFromLayout(layout);\n    return getItemResources(id, hubRequestOptions).then(function (response) {\n        var itemResourcesOnAGO = (response.resources || []).map(extractResourceProperty);\n        var imageItemResourcesOnAGO = itemResourcesOnAGO.filter(resourceStartsWithImageSource);\n        // getItemResources mutates the options, adding a params hash\n        delete hubRequestOptions.params;\n        var itemResourcesToRemove = getUnusedItemCrops(layoutImageCropIds, imageItemResourcesOnAGO);\n        return removeUnusedResourcesFromAGO(id, itemResourcesToRemove, hubRequestOptions.authentication);\n    });\n}\nfunction extractResourceProperty(entry) {\n    return entry.resource;\n}\nfunction getUnusedItemCrops(layoutImageCropIds, itemImageResources) {\n    if (!layoutContainsImageCards(layoutImageCropIds)) {\n        // if there aren't any image cards in saved layout, delete all crops\n        return itemImageResources;\n    }\n    // otherwise find crops for image cards that do not contain a current cropId\n    return itemImageResources.filter(isNotACurrentImageCropId(layoutImageCropIds));\n}\nfunction layoutContainsImageCards(layoutImageCropIds) {\n    return layoutImageCropIds.length > 0;\n}\nfunction resourceStartsWithImageSource(agoResource) {\n    return agoResource.indexOf(\"hub-image-card-crop-\") === 0;\n}\nfunction isNotACurrentImageCropId(imageCropIds) {\n    var cropRegex = new RegExp(\"-crop-(\" + imageCropIds.join(\"|\") + \").png$\");\n    return function (resource) { return !resource.match(cropRegex); };\n}\nfunction removeUnusedResourcesFromAGO(id, unusedCrops, authentication) {\n    // failSafe these calls b/c this is not critical\n    var failSaveRemoveItemResources = failSafe(removeItemResource, {\n        success: true\n    });\n    return Promise.all(unusedCrops.map(function (resource) {\n        return failSaveRemoveItemResources({\n            id: id,\n            resource: resource,\n            authentication: authentication\n        });\n    }));\n}\n//# sourceMappingURL=remove-unused-resources.js.map","import { getProp } from \"@esri/hub-common\";\nimport { getLayoutDependencies } from \"./layout\";\n/**\n * Return a list of items this site depends on\n */\nexport function getSiteDependencies(model) {\n    var pages = getProp(model, \"data.values.pages\") || [];\n    var pageIds = pages.map(function (p) { return p.id; });\n    var layout = getProp(model, \"data.values.layout\") || {};\n    var layoutDepIds = getLayoutDependencies(layout);\n    return layoutDepIds.concat(pageIds);\n}\n//# sourceMappingURL=get-site-dependencies.js.map","export var DRAFT_RESOURCE_REGEX = /^draft-(\\d+).json$/;\n//# sourceMappingURL=_draft-resource-regex.js.map","import { normalizeItemType } from \"@esri/hub-common\";\n/**\n * Determines whether an item is a page item or not\n * @param item - the item\n */\nexport function isPage(item) {\n    return normalizeItemType(item) === \"Hub Page\";\n}\n//# sourceMappingURL=is-page.js.map","import { SITE_DRAFT_INCLUDE_LIST } from \"./site-draft-include-list\";\nimport { PAGE_DRAFT_INCLUDE_LIST } from \"./page-draft-include-list\";\nimport { isSite } from \"../is-site\";\nimport { isPage } from \"../pages\";\n/**\n * Returns the right include list for the item type.\n * @param siteOrPageModel - the site or page model\n * @private\n */\nexport function _includeListFromItemType(siteOrPageItem) {\n    var includeList;\n    if (isSite(siteOrPageItem)) {\n        includeList = SITE_DRAFT_INCLUDE_LIST;\n    }\n    else if (isPage(siteOrPageItem)) {\n        includeList = PAGE_DRAFT_INCLUDE_LIST;\n    }\n    else {\n        throw TypeError(\"@esri/hub-sites: drafts only belong to a site or a page item model\");\n    }\n    return includeList;\n}\n//# sourceMappingURL=_include-list-from-item-type.js.map","import { includes } from \"@esri/hub-common\";\nimport { UNPUBLISHED_CHANGES_KW } from \"./unpublished-changes-kw\";\n/**\n * Returns true if site or page model has unpublished changes\n * @param siteOrPageModel\n */\nexport function hasUnpublishedChanges(siteOrPageModel) {\n    return includes(siteOrPageModel.item.typeKeywords, UNPUBLISHED_CHANGES_KW);\n}\n//# sourceMappingURL=has-unpublished-changes.js.map","export var SITE_UI_VERSION = \"2.4\";\n//# sourceMappingURL=site-ui-version.js.map","/**\n * Return the Portal subdomain typekeyword\n * @param {string} subdomain Portal Subdomain\n * @private\n */\nexport function _getPortalDomainTypeKeyword(subdomain) {\n    return (\"hubsubdomain|\" + subdomain).toLowerCase();\n}\n//# sourceMappingURL=_get-portal-domain-type-keyword.js.map","import { _getPortalDomainTypeKeyword } from \"./_get-portal-domain-type-keyword\";\nimport { includes } from \"@esri/hub-common\";\n/**\n * Ensure that an entry for the specified subdomain exists in the\n * typeKeyword array. Will also remove any other domain entries,\n * @param {String} subdomain Subdomain name\n * @param {Array} typeKeywords Array of typekeywords\n * @private\n */\nexport function _ensurePortalDomainKeyword(subdomain, typeKeywords) {\n    if (typeKeywords === void 0) { typeKeywords = []; }\n    // if the current entry is in the keywords array, just return it\n    var expectedKeyword = _getPortalDomainTypeKeyword(subdomain);\n    if (includes(typeKeywords, expectedKeyword)) {\n        return typeKeywords;\n    }\n    else {\n        return typeKeywords.reduce(function (acc, kw) {\n            if (!/^hubsubdomain/.test(kw)) {\n                acc.push(kw);\n            }\n            return acc;\n        }, [expectedKeyword]);\n    }\n}\n//# sourceMappingURL=_ensure-portal-domain-keyword.js.map","import { deepSet, getProp, mergeObjects, serializeModel, getSiteById, } from \"@esri/hub-common\";\nimport { SITE_UI_VERSION } from \"./site-ui-version\";\nimport { _ensurePortalDomainKeyword } from \"./_ensure-portal-domain-keyword\";\nimport { updateItem } from \"@esri/arcgis-rest-portal\";\n/**\n * Update an existing site item\n * This function supports the equivalent of a PATCH REST operation\n * It will fetch the current item from ago, and then apply\n * a subset of property changes to the model if a allowList is included.\n * The allowList can include any property paths on the item.\n * If the list is empty, then the entire site model is overwritten.\n * @param {Object} model Site Model to update\n * @param {IUpdateSiteOptions} updateSiteOptions\n */\nexport function updateSite(model, updateSiteOptions) {\n    var allowList = updateSiteOptions.allowList || [];\n    var _a = updateSiteOptions.updateVersions, updateVersions = _a === void 0 ? true : _a;\n    // apply any on-save site upgrades here...\n    deepSet(model, \"data.values.uiVersion\", SITE_UI_VERSION);\n    deepSet(model, \"data.values.updatedAt\", new Date().toISOString());\n    deepSet(model, \"data.values.updatedBy\", updateSiteOptions.authentication.username);\n    // we only add these in if an allowList was passed in\n    if (allowList.length) {\n        allowList.push(\"data.values.updatedAt\");\n        allowList.push(\"data.values.updatedBy\");\n        if (updateVersions) {\n            allowList.push(\"data.values.uiVersion\");\n            // any save needs to be able to update the schema version\n            // which will have been bumped if a schema migration\n            // occured during the load cycle\n            allowList.push(\"item.properties.schemaVersion\");\n        }\n    }\n    // PORTAL-ENV: no domain service so we encode the subdomain in a typeKeyword\n    if (updateSiteOptions.isPortal) {\n        model.item.typeKeywords = _ensurePortalDomainKeyword(getProp(model, \"data.values.subdomain\"), model.item.typeKeywords);\n        // see above comment why ths is gated...\n        if (allowList.length) {\n            allowList.push(\"item.typeKeywords\");\n        }\n    }\n    // Actually start the update process...\n    var agoModelPromise;\n    // if we have a allowList, refetch the site to check for changes...\n    if (allowList.length) {\n        agoModelPromise = getSiteById(model.item.id, updateSiteOptions);\n    }\n    else {\n        // if we dont have a allowList, just resolve with the model we have\n        agoModelPromise = Promise.resolve(model);\n    }\n    // Kick things off...\n    return agoModelPromise\n        .then(function (agoModel) {\n        if (allowList.length) {\n            // merge the props in the allow list into the model from AGO\n            model = mergeObjects(model, agoModel, allowList);\n        }\n        // send the update to ago\n        return updateItem({\n            item: serializeModel(model),\n            authentication: updateSiteOptions.authentication,\n            params: { clearEmptyFields: true },\n        });\n    })\n        .catch(function (err) {\n        throw Error(\"updateSite: Error updating site: \" + err);\n    });\n}\n//# sourceMappingURL=update-site.js.map","import { getItemResources } from \"@esri/arcgis-rest-portal\";\nimport { DRAFT_RESOURCE_REGEX } from \"./_draft-resource-regex\";\n/**\n * Gets the name of the resource for the current draft.\n * NOTE: There _should_ only be one, but sometimes it gets messed up.\n * @param siteOrPageId\n * @param hubRequestOptions\n * @private\n */\nexport function _getDraftResourceNames(siteOrPageId, hubRequestOptions) {\n    return getItemResources(siteOrPageId, {\n        portal: hubRequestOptions.portal,\n        authentication: hubRequestOptions.authentication\n    }).then(function (response) {\n        // search through the resources to find the draft\n        var draftResourceNames = response.resources\n            .map(function (_a) {\n            var name = _a.resource;\n            return name;\n        })\n            .filter(function (name) { return name.search(DRAFT_RESOURCE_REGEX) !== -1; });\n        return draftResourceNames;\n    });\n}\n//# sourceMappingURL=_get-draft-resource-names.js.map","import { removeItemResource } from \"@esri/arcgis-rest-portal\";\nimport { _getDraftResourceNames } from \"./_get-draft-resource-names\";\n/**\n * Given an item id, removes the current draft resource if exists\n * @param {*} siteOrPageId\n * @param {*} hubRequestOptions\n */\nexport function deleteDraft(siteOrPageModel, hubRequestOptions) {\n    var _a = siteOrPageModel.item, id = _a.id, owner = _a.owner;\n    return _getDraftResourceNames(id, hubRequestOptions).then(function (draftResourceNames) {\n        return Promise.all(draftResourceNames.map(function (resourceName) {\n            return removeItemResource({\n                id: id,\n                owner: owner,\n                resource: resourceName,\n                portal: hubRequestOptions.portal,\n                authentication: hubRequestOptions.authentication\n            });\n        }));\n    });\n}\n//# sourceMappingURL=delete-draft.js.map","import { DRAFT_RESOURCE_REGEX } from \"./_draft-resource-regex\";\n/**\n *\n * @param draftName\n */\nexport function getDraftDate(draftName) {\n    var parsed = DRAFT_RESOURCE_REGEX.exec(draftName);\n    var ret;\n    try {\n        ret = new Date(parseInt(parsed[1], 10));\n    }\n    catch (_a) {\n        ret = null;\n    }\n    return ret;\n}\n//# sourceMappingURL=get-draft-date.js.map","import { getDraftDate } from \"./get-draft-date\";\nimport { _getDraftResourceNames } from \"./_get-draft-resource-names\";\n/**\n * Gets the name of the most recent resource for the current draft.\n * NOTE: There _should_ only be one, but sometimes it gets messed up.\n * @param siteOrPageId\n * @param hubRequestOptions\n * @private\n */\nexport function _getMostRecentDraftName(siteOrPageId, hubRequestOptions) {\n    return _getDraftResourceNames(siteOrPageId, hubRequestOptions).then(function (draftNames) {\n        if (!draftNames.length)\n            return null;\n        var dates = draftNames.map(function (name) { return [name, getDraftDate(name)]; });\n        dates.sort(function (_a, _b) {\n            var _ = _a[0], dateA = _a[1];\n            var __ = _b[0], dateB = _b[1];\n            if (dateB > dateA) {\n                return 1;\n            }\n            else if (dateA > dateB) {\n                return -1;\n            }\n            else {\n                return 0;\n            }\n        });\n        return dates[0][0];\n    });\n}\n//# sourceMappingURL=_get-most-recent-draft-name.js.map","import { deepSet, getProp } from \"@esri/hub-common\";\nimport { SITE_SCHEMA_VERSION, _ensureTelemetry } from \"@esri/hub-common\";\nvar schemaVersionPath = \"item.properties.schemaVersion\";\nvar initialDraftVersion = 1.3;\n/**\n * Applies the schema upgrades\n * @param draft IDraft\n */\nexport function upgradeDraftSchema(draft) {\n    if (getProp(draft, \"item.properties.schemaVersion\") === undefined) {\n        deepSet(draft, schemaVersionPath, initialDraftVersion);\n    }\n    if (getProp(draft, \"item.properties.schemaVersion\") === SITE_SCHEMA_VERSION) {\n        return draft;\n    }\n    else {\n        var migrated = draft;\n        // apply site schema upgrade functions in order...\n        // don't have do do them all since drafts only got released\n        // at version 1.3\n        migrated = _ensureTelemetry(draft);\n        return migrated;\n    }\n}\n//# sourceMappingURL=upgrade-draft-schema.js.map","import { getProp } from \"@esri/hub-common\";\nimport { getItemResource } from \"@esri/arcgis-rest-portal\";\nimport { _getMostRecentDraftName } from \"./_get-most-recent-draft-name\";\nimport { upgradeDraftSchema } from \"./upgrade-draft-schema\";\nfunction isSiteDraft(draft) {\n    // Maybe a better way to do this, but can't use item type\n    // because we have Web Mapping Application sites in the wild\n    // and typeKeywords don't exist on drafts.\n    //\n    // We could always request the site item and check it as part of\n    // this but I'd rather not since that's an extra XHR and this is a\n    // pretty robust schema check.\n    return (getProp(draft, \"data.values.capabilities\") !== undefined &&\n        getProp(draft, \"data.values.theme\") !== undefined);\n}\n/**\n * Fetches the draft for a site or page if exists.\n * @param {*} siteOrPageId\n * @param {*} hubRequestOptions\n */\nexport function fetchDraft(siteOrPageId, hubRequestOptions) {\n    return _getMostRecentDraftName(siteOrPageId, hubRequestOptions)\n        .then(function (draftResourceName) {\n        var ret = null;\n        if (draftResourceName) {\n            ret = getItemResource(siteOrPageId, {\n                fileName: draftResourceName,\n                readAs: \"json\",\n                authentication: hubRequestOptions.authentication,\n                portal: hubRequestOptions.portal\n            });\n        }\n        return ret;\n    })\n        .then(function (draft) {\n        if (draft && isSiteDraft(draft)) {\n            draft = upgradeDraftSchema(draft);\n        }\n        return draft;\n    });\n}\n//# sourceMappingURL=fetch-draft.js.map","import { mergeObjects, cloneObject } from \"@esri/hub-common\";\nimport { _includeListFromItemType } from \"./_include-list-from-item-type\";\n/**\n * Applies a draft resource to an item model\n * @param {*} siteOrPageModel\n * @param {*} draft\n */\nexport function applyDraft(siteOrPageModel, draft) {\n    if (!draft)\n        return siteOrPageModel;\n    var includeList = _includeListFromItemType(siteOrPageModel.item);\n    return mergeObjects(draft, cloneObject(siteOrPageModel), includeList);\n}\n//# sourceMappingURL=apply-draft.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getHubApiUrl } from \"@esri/hub-common\";\nimport { _getDomainServiceUrl } from \"@esri/hub-common\";\n/**\n * Get the domains associated with a Hub Site.\n * @param siteId - Identifier of the Hub Site\n * @param requestOptions - request options that may include authentication\n * @returns A Promise that will resolve with the domains associated with the site.\n */\nexport function getDomains(siteId, requestOptions) {\n    var url = _getDomainServiceUrl(getHubApiUrl(requestOptions));\n    var options = __assign({ params: { siteId: siteId }, httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Get the domain associated with a Hub Site. Since a site may have a\n * custom domain, in addition to a default domain, we will return the\n * custom domain over the default domain.\n *\n * @param siteId - Identifier of the Hub Site\n * @param requestOptions - request options that may include authentication\n * @returns A Promise that will resolve with the domains associated with the site.\n */\nexport function getDomain(siteId, requestOptions) {\n    return getDomains(siteId, requestOptions).then(function (response) {\n        if (response.length > 1) {\n            // ok - in this case, it's likely that we have a default domain and a custom domain...\n            // we want the one that's custom... i.e. does not contain arcgis.com\n            var customEntry = response.reduce(function (acc, entry) {\n                if (!entry.hostname.includes(\"arcgis.com\")) {\n                    acc = entry;\n                }\n                return acc;\n            }, null);\n            if (customEntry) {\n                // return the custom domain\n                return customEntry.hostname;\n            }\n            else {\n                // just pick the first one\n                return response[0].hostname;\n            }\n        }\n        else {\n            // there is only 1, so return it\n            return response[0].hostname;\n        }\n    });\n}\n//# sourceMappingURL=get-domain.js.map","import { maybePush, getProp, _unprotectAndRemoveGroup } from \"@esri/hub-common\";\n/**\n * Remove the well-known team groups\n * Underlying calls are failsafe so this will never throw\n * but the groups may not be deleted\n * @param {Object} siteModel Site Model\n * @param {IRequestOptions} requestOptions\n * @private\n */\nexport function _removeSiteGroups(siteModel, requestOptions) {\n    var teamsToDelete = [\n        \"collaborationGroupId\",\n        \"contentGroupId\",\n        \"followersGroupId\"\n    ].reduce(function (acc, prop) {\n        return maybePush(getProp(siteModel, \"item.properties.\" + prop), acc);\n    }, []);\n    var promises = teamsToDelete.map(function (id) {\n        var opts = Object.assign({ id: id }, requestOptions);\n        return _unprotectAndRemoveGroup(opts);\n    });\n    return Promise.all(promises);\n}\n//# sourceMappingURL=_remove-site-groups.js.map","import { getProp, _unprotectAndRemoveItem } from \"@esri/hub-common\";\n/**\n * Remove the parent initiative item, if it exists\n * Failsafe\n * @param {Object} siteModel Site Model\n * @param {IRequestOptions} requestOptions\n * @private\n */\nexport function _removeParentInitiative(siteModel, requestOptions) {\n    var parentInitiativeId = getProp(siteModel, \"item.properties.parentInitiativeId\");\n    if (parentInitiativeId) {\n        var opts = Object.assign({ id: parentInitiativeId, owner: siteModel.item.owner }, requestOptions);\n        return _unprotectAndRemoveItem(opts);\n    }\n    else {\n        return Promise.resolve();\n    }\n}\n//# sourceMappingURL=_remove-parent-initiative.js.map","import { getHubApiUrl } from \"@esri/hub-common\";\n/**\n * Remove a Site from the Hub Index system\n * @param {Object} siteModel Site Model\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _removeSiteFromIndex(siteModel, hubRequestOptions) {\n    if (hubRequestOptions.isPortal) {\n        return Promise.resolve();\n    }\n    else {\n        var url = getHubApiUrl(hubRequestOptions) + \"/api/v3/\" + siteModel.item.id;\n        var opts = {\n            method: \"DELETE\",\n            mode: \"cors\",\n            headers: {\n                Authorization: hubRequestOptions.authentication.token,\n            },\n        };\n        return fetch(url, opts)\n            .then(function (raw) { return raw.json(); })\n            .then(function (_) {\n            // TODO: Should we do anything here?\n            return { success: true };\n        })\n            .catch(function (err) {\n            throw Error(\"_removeSiteFromIndex: Error removing site from index: \" + err);\n        });\n    }\n}\n//# sourceMappingURL=_remove-site-from-index.js.map","import { removeDomainsBySiteId } from \"@esri/hub-common\";\n/**\n * Remove the domain entries for a site\n * @param {string} siteId Item Id of the site to remove the domain entries for\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _removeSiteDomains(siteId, hubRequestOptions) {\n    if (hubRequestOptions.isPortal) {\n        return Promise.resolve([]);\n    }\n    return removeDomainsBySiteId(siteId, hubRequestOptions).then(function (response) { return response; });\n}\n//# sourceMappingURL=_remove-site-domains.js.map","/**\n * The item type depends if the app is running\n * in ArcGIS Enterprise vs AGO\n * @param {boolean} isPortal Is this running in Enterprise?\n */\nexport function getSiteItemType(isPortal) {\n    var type = \"Hub Site Application\";\n    if (isPortal) {\n        type = \"Site Application\";\n    }\n    return type;\n}\n//# sourceMappingURL=get-site-item-type.js.map","import { cloneObject, includes } from \"@esri/hub-common\";\nimport { getSiteItemType } from \"./get-site-item-type\";\n/**\n * Enture that the site model has the correct type and tags\n * Mutates the Model\n * @param {Object} model Site Model\n * @param {Object} currentUser Current User\n * @param {Boolean} isPortal Is this running in ArcGIS Enterprise\n * @private\n */\nexport function _ensureTypeAndTags(model, isPortal) {\n    model = cloneObject(model);\n    model.item.type = getSiteItemType(isPortal);\n    // ensure typekeywords array\n    if (!Array.isArray(model.item.typeKeywords)) {\n        model.item.typeKeywords = [];\n    }\n    if (!includes(model.item.typeKeywords, \"hubSite\")) {\n        model.item.typeKeywords.push(\"hubSite\");\n    }\n    return model;\n}\n//# sourceMappingURL=_ensure-type-and-tags.js.map","import { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalApiUrl } from \"@esri/hub-common\";\n/**\n * Update the redirect uri's that are valid for an existing app that's registered\n * for oAuth.\n * @param {string} clientId Client Id of the existing app to be updated\n * @param {Array} redirectUris Array of valid redirect uris for the app\n * @param {IRequestOptions} requestOptions\n */\nexport function updateAppRedirectUris(clientId, redirectUris, requestOptions) {\n    var url = getPortalApiUrl(requestOptions) + \"/oauth2/apps/\" + clientId + \"/update\";\n    var options = {\n        method: \"POST\",\n        authentication: requestOptions.authentication,\n        params: {\n            client_id: clientId,\n            redirect_uris: JSON.stringify(redirectUris)\n        }\n    };\n    return request(url, options);\n}\n//# sourceMappingURL=update-app-redirect-uris.js.map","import { mapBy, getWithDefault, failSafe } from \"@esri/hub-common\";\nimport { unlinkSiteAndPage } from \"./unlink-site-and-page\";\n/**\n * Given a site, update all the linked page items and remove their\n * references to the site\n * @param {Object} siteModel Site Model\n * @param {IRequestOptions} requestOptions\n */\nexport function unlinkPagesFromSite(siteModel, requestOptions) {\n    var linkedPages = mapBy(\"id\", getWithDefault(siteModel, \"data.values.pages\", []));\n    // we need to unlink the site from all it's pages. However, these calls *could* fail\n    // if the current user lacks rights to save the site/page item, so we just make sure these\n    // always resolve. In the Ember service code, we used `allSettled` but that's RSVP special sauce\n    var failSafeUnlink = failSafe(unlinkSiteAndPage);\n    return Promise.all(linkedPages.map(function (pageId) {\n        var opts = Object.assign({\n            siteModel: siteModel,\n            pageId: pageId\n        }, requestOptions);\n        return failSafeUnlink(opts);\n    }));\n}\n//# sourceMappingURL=unlink-pages-from-site.js.map","import { cloneObject, getProp, deepSet } from \"@esri/hub-common\";\nimport { _getPortalDomainTypeKeyword } from \"./_get-portal-domain-type-keyword\";\nimport { _ensureTypeAndTags } from \"./_ensure-type-and-tags\";\nimport { SITE_UI_VERSION } from \"./site-ui-version\";\n/**\n * Enture that the site model has all the required properties\n * and force them to be bumped to all the current values.\n * Returns a clone of the model\n * @param {Object} model Site Model\n * @param {Object} currentUser Current User\n * @param {Boolean} isPortal Is this running in ArcGIS Enterprise\n */\nexport function ensureRequiredSiteProperties(model, username, isPortal) {\n    if (isPortal === void 0) { isPortal = false; }\n    model = cloneObject(model);\n    model.item.owner = username;\n    model.item.access = \"private\";\n    // ensure typekeywords array\n    if (!Array.isArray(model.item.typeKeywords)) {\n        model.item.typeKeywords = [];\n    }\n    model.data.values.updatedAt = new Date().toISOString();\n    model.data.values.updatedBy = username;\n    if (isPortal) {\n        model.item.typeKeywords.push(_getPortalDomainTypeKeyword(model.data.values.subdomain));\n    }\n    // Handle item url - if it's set...\n    if (!model.item.url) {\n        var hostname = getProp(model, \"data.values.customHostname\") ||\n            getProp(model, \"data.values.defaultHostname\");\n        // unless a custom hostname was passed in AND the site item's url is falsey\n        // (which currently should be impossible) we want the protocol of the item url\n        // to be https.\n        var protocol = \"https\";\n        if (model.data.values.customHostname) {\n            protocol = \"http\";\n        }\n        model.item.url = protocol + \"://\" + hostname;\n    }\n    // Ensure pages is an array...\n    if (!Array.isArray(getProp(model, \"data.values.pages\"))) {\n        deepSet(model, \"data.values.pages\", []);\n    }\n    deepSet(model, \"data.values.uiVersion\", SITE_UI_VERSION);\n    // ensure the type and tags...\n    model = _ensureTypeAndTags(model, isPortal);\n    // ensure the capabilities...\n    var caps = [\n        \"api_explorer\",\n        \"pages\",\n        \"my_data\",\n        \"social_logins\",\n        \"json_chart_card\",\n        \"document_iframes\",\n        \"items_view\",\n        \"app_page\",\n        \"underlinedLinks\",\n        \"globalNav\",\n    ];\n    if (!isPortal) {\n        caps.push(\"socialSharing\");\n    }\n    deepSet(model, \"data.values.capabilities\", caps);\n    // return the clone\n    return model;\n}\n//# sourceMappingURL=ensure-required-site-properties.js.map","/**\n * Return the correct route for the portal hosted site\n * @param {String} subdomain Subdomain for the site\n * @param {Object} portal Portal Self\n */\nexport function getPortalSiteHostname(subdomain, portal) {\n    var port;\n    if (portal.allSSL) {\n        port = portal.httpsPort !== 443 ? \":\" + portal.httpsPort : \"\";\n    }\n    else {\n        port = portal.httpPort !== 80 ? \":\" + portal.httpPort : \"\";\n    }\n    // portalHostname will include the /<adaptor>\n    // i.e. `dev0016196.esri.com/portal`, but since we may need to inject a port\n    // we split things apart, and then recombine\n    var parts = portal.portalHostname.split(\"/\");\n    var host = parts[0];\n    var adaptor = \"/\"; // if there is no /<adaptor> then / should be valid\n    if (parts[1]) {\n        adaptor = \"/\" + parts[1] + \"/\";\n    }\n    // construct the url\n    return \"\" + host + port + adaptor + \"apps/sites/#/\" + subdomain;\n    // Note: in *most* cases the result would be the same as the line below\n    // but there are some scenarios where we need to do the construction\n    // so we can't simply use portalHostname\n    // return `${portal.portalHostname}/apps/sites/#/${subdomain}`\n}\n//# sourceMappingURL=get-portal-site-hostname.js.map","import { getPortalSiteHostname } from \"./get-portal-site-hostname\";\n/**\n * Construct the site url for a Portal Site item\n * @param {String} subdomain Subdomain for the site\n * @param {Object} portal Portal Self\n */\nexport function getPortalSiteUrl(subdomain, portal) {\n    var protocol = \"http:\";\n    if (portal.allSSL) {\n        protocol = \"https:\";\n    }\n    var siteRoute = getPortalSiteHostname(subdomain, portal);\n    return protocol + \"//\" + siteRoute;\n}\n//# sourceMappingURL=get-portal-site-url.js.map","import { getOrgDefaultTheme } from \"@esri/hub-common\";\n/* istanbul ignore next */\n/**\n * Return the default theme, extended with values from the Org's shared theme\n * @param {Object} portalSelf Org's Portal object\n */\nexport function getTheme(portalSelf) {\n    // eslint-disable-next-line no-console\n    console.warn(\"@esri/hub-sites::getTheme is deprecated. Please use @esri/hub-common::getOrgDefaultTheme instead\");\n    return getOrgDefaultTheme(portalSelf);\n}\n//# sourceMappingURL=get-theme.js.map","import { without, interpolate, getProp } from \"@esri/hub-common\";\nimport { getInitiativeTemplate, addInitiative } from \"@esri/hub-initiatives\";\nimport { shareItemWithGroup } from \"@esri/arcgis-rest-portal\";\n/**\n * Given a Site Template, locate the initiative template\n * then adlib it and create the initiative item\n * @param {object} siteTemplate Site Template\n * @param {object} settings adlib interpolation hash\n * @param {object} transforms adlib transforms hash\n * @param {IHubRequestOptions}} hubRequestOptions\n * @private\n */\nexport function _createSiteInitiative(siteTemplate, settings, transforms, hubRequestOptions) {\n    var cache = {};\n    return getInitiativeTemplate(siteTemplate, hubRequestOptions)\n        .then(function (initiativeTemplate) {\n        // set the url that will be in the site\n        initiativeTemplate.item.url = settings.solution.url;\n        initiativeTemplate.item.title = settings.solution.title;\n        initiativeTemplate.item.owner = hubRequestOptions.authentication.username;\n        initiativeTemplate.item.typeKeywords = without(initiativeTemplate.item.typeKeywords, \"Hub Initiative Template\");\n        initiativeTemplate.item.type = \"Hub Initiative\";\n        // set the teams...\n        Object.assign(initiativeTemplate.item.properties, settings.teams);\n        // adlib to pick up anything else...\n        var initiativeModel = interpolate(initiativeTemplate, settings, transforms);\n        // and save it\n        return addInitiative(initiativeModel, hubRequestOptions);\n    })\n        .then(function (model) {\n        // hold in cache\n        cache.model = model;\n        // default to a success response\n        var sharePrms = Promise.resolve({ success: true });\n        // share it to the collab team if that got created\n        var collabGroupId = getProp(settings, \"teams.collaborationGroupId\");\n        if (collabGroupId) {\n            sharePrms = shareItemWithGroup({\n                id: model.item.id,\n                groupId: collabGroupId,\n                authentication: hubRequestOptions.authentication,\n                confirmItemControl: true\n            });\n        }\n        return sharePrms;\n    })\n        .then(function (_) {\n        return cache.model;\n    })\n        .catch(function (ex) {\n        throw Error(\"site-utils::_createSiteInitiative Error \" + ex);\n    });\n}\n//# sourceMappingURL=_create-site-initiative.js.map","import { getProp } from \"@esri/hub-common\";\nimport { updateGroup } from \"@esri/arcgis-rest-portal\";\n/**\n * Update the tags on the teams after the initiative is created\n * Specifically:\n * - add  `hubInitiativeFollowers|<initiaiveId> to the followers group\n * @param {object} initiativeModel Initiative Model\n * @param {object} teams hash of teams\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _updateTeamTags(initiativeModel, teams, hubRequestOptions) {\n    var prms = Promise.resolve({ success: true });\n    // we have a followers group\n    // TODO: COVER THIS WITH TESTS (spying wasnt working)\n    /* istanbul ignore if */\n    if (getProp(teams, \"props.followersGroupId\")) {\n        // get the followers group out of the teams.groups array\n        var followersGroup = teams.groups.find(function (g) { return g.id === teams.props.followersGroupId; });\n        // now we want to add a tag\n        followersGroup.tags.push(\"hubInitiativeFollowers|\" + initiativeModel.item.id);\n        // now we want to fire off an update\n        prms = updateGroup({\n            group: followersGroup,\n            authentication: hubRequestOptions.authentication\n        });\n    }\n    return prms;\n}\n//# sourceMappingURL=_update-team-tags.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { updateGroup } from '@esri/arcgis-rest-portal';\n * //\n * updateGroup({\n *   group: { id: \"fgr344\", title: \"new\" }\n * })\n *   .then(response)\n * ```\n * Update the properties of a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-group.htm) for more information.\n *\n * @param requestOptions - Options for the request, including the group\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function updateGroup(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.group.id + \"/update\";\n    requestOptions.params = __assign(__assign({}, requestOptions.params), requestOptions.group);\n    return request(url, requestOptions);\n}\n//# sourceMappingURL=update.js.map","import { interpolate, cloneObject } from \"@esri/hub-common\";\n/**\n * Wrapper for @esri/hub-common's `interpolate()`\n *\n * Some properties on siteTemplate are nested adlib templates that\n * need to be interpolated at runtime, not template activation time.\n * As such, this wrapper ensures that adlib does not process those\n * properties.\n *\n * Currently ignored properties include:\n * - `data.values.dcatConfig` (legacy DCAT-US 1.1 config with index value paths)\n * - `data.feeds (Home to all feed configs with v3 api value paths)\n *\n * @param siteTemplate\n * @param settings\n * @param transforms\n */\nexport function interpolateSite(siteTemplate, settings, transforms) {\n    var template = cloneObject(siteTemplate);\n    // Save nested adlib templates\n    var legacyDcatUS11Config = cloneObject(template.data.values.dcatConfig);\n    var feedConfigs = cloneObject(template.data.feeds);\n    // Remove nested adlib templates from the main template so they will not be processed\n    delete template.data.values.dcatConfig;\n    delete template.data.feeds;\n    var siteModel = interpolate(template, settings, transforms);\n    // Attach nested templates onto the interpolated site\n    if (legacyDcatUS11Config) {\n        siteModel.data.values.dcatConfig = legacyDcatUS11Config;\n    }\n    if (feedConfigs) {\n        siteModel.data.feeds = feedConfigs;\n    }\n    return siteModel;\n}\n//# sourceMappingURL=interpolate-site.js.map","import { getHubProduct, getProp, cloneObject, deepSet, slugify, stripProtocol, addSolutionResourceUrlToAssets, getHubApiUrl, } from \"@esri/hub-common\";\nimport { createHubTeams } from \"@esri/hub-teams\";\nimport { getTheme } from \"./get-theme\";\nimport { getPortalSiteHostname } from \"./get-portal-site-hostname\";\nimport { getPortalSiteUrl } from \"./get-portal-site-url\";\nimport { _createSiteInitiative } from \"./_create-site-initiative\";\nimport { _updateTeamTags } from \"./_update-team-tags\";\nimport { ensureUniqueDomainName } from \"@esri/hub-common\";\nimport { interpolateSite } from \"./interpolate-site\";\n/**\n * Convert a Site Template into a Site Model\n * This will create Hub Teams and an Initiative, depending on licensing\n * and privs.\n *\n * The subdomain for the site will be constructed from the `settings.solution.title`\n * unless that contains unicode chars. In that case the initial subdomain will be `site`\n * and `ensureUniqueDomainName` will increment it as necessary (i.e. site-1, site-2 etc)\n *\n * This returns the Model that still needs to be saved!\n * @param {object} template Site Template\n * @param {object} settings Adlib interpolation hash\n * @param {object} transforms hash of transform functions\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function createSiteModelFromTemplate(template, settings, transforms, hubRequestOptions) {\n    // add url to the assets, ref'ing the original location\n    template.assets = addSolutionResourceUrlToAssets(template, hubRequestOptions);\n    // We may have templates which lack .properties so let's ensure that exists\n    if (!template.item.properties) {\n        template.item.properties = {};\n    }\n    // Kill props we don't want to roll forward if they happen to exist in the template\n    [\n        \"customHostname\",\n        \"externalUrl\",\n        \"contentGroupId\",\n        \"followersGroupId\",\n        \"collaborationGroupId\",\n        \"parentInitiativeId\",\n    ].forEach(function (prop) {\n        delete template.data.values[prop];\n    });\n    var product = getHubProduct(hubRequestOptions.portalSelf);\n    var title = getProp(settings, \"solution.title\") || \"New Site\";\n    // handle issue with titles that are just numbers\n    if (typeof title === \"number\") {\n        title = title.toString();\n        deepSet(settings, \"solution.title\", title);\n    }\n    // We need to carry some state through the promise chains\n    // so we initialize an object outside the chain\n    var state = {};\n    // TODO: Eventually we'd like Enums\n    var teamsToCreate = [\"core\", \"content\", \"followers\"];\n    return createHubTeams({\n        title: title,\n        types: teamsToCreate,\n        hubRequestOptions: hubRequestOptions,\n    })\n        .then(function (teams) {\n        // fold teams into the settings hash - used mainly for cards\n        settings.teams = cloneObject(teams.props);\n        state.teams = teams;\n        // directly set the teams into the template item as this ensures\n        // the team props are always set vs relying on adlib vars to exist\n        Object.assign(template.item.properties, teams.props);\n        if (getProp(teams, \"props.contentGroupId\")) {\n            deepSet(template, \"data.catalog.groups\", [teams.props.contentGroupId]);\n        }\n        // sites need unique domains names\n        // We derive this from the title, unless the title has unicode chars\n        // in which case we use `site`, and the `ensureUniqueDomainName` function\n        // will increment that as needed - i.e. `site-23`\n        var domainTitle = title;\n        if (hasUnicodeChars(domainTitle)) {\n            domainTitle = \"site\";\n        }\n        return ensureUniqueDomainName(slugify(domainTitle), hubRequestOptions);\n    })\n        .then(function (uniqueSubdomain) {\n        var portal = hubRequestOptions.portalSelf;\n        // TODO: Revisit this if/when we do more site templates which we want to maintain their theme\n        settings.solution.theme = getTheme(portal);\n        // set site-specific settings properties...\n        settings.solution.subdomain = uniqueSubdomain;\n        // setup the url properties\n        if (hubRequestOptions.isPortal) {\n            settings.solution.defaultHostname = getPortalSiteHostname(uniqueSubdomain, portal);\n            settings.solution.url = getPortalSiteUrl(uniqueSubdomain, portal);\n        }\n        else {\n            var base = stripProtocol(getHubApiUrl(hubRequestOptions));\n            settings.solution.defaultHostname = uniqueSubdomain + \"-\" + portal.urlKey + \".\" + base;\n            settings.solution.url = \"https://\" + uniqueSubdomain + \"-\" + portal.urlKey + \".\" + base;\n        }\n        // create the initiative\n        var handleInitiative = Promise.resolve(null);\n        if (product !== \"portal\") {\n            handleInitiative = _createSiteInitiative(template, settings, transforms, hubRequestOptions);\n        }\n        return handleInitiative;\n    })\n        .then(function (maybeInitiative) {\n        // if we got an initiative back...\n        var teamUpdatePromise = Promise.resolve(null);\n        if (maybeInitiative) {\n            // add to settings hash so it's available to the site\n            // typically all that's used is initiative.item.id\n            settings.initiative = maybeInitiative;\n            // directly set the parentInitiativeId vs relying on adlib\n            template.item.properties.parentInitiativeId = maybeInitiative.item.id;\n            // check if we created a followers team because we need to add the initiativeId into a tag\n            teamUpdatePromise = _updateTeamTags(maybeInitiative, state.teams, hubRequestOptions);\n        }\n        return teamUpdatePromise;\n    })\n        .then(function (_) {\n        var siteModel = interpolateSite(template, settings, transforms);\n        // Special logic for the site title\n        // if the title is a string, containing only numbers, then the interpolation will set it as\n        // a number, which causes some problems... in that case, we stomp it in as a string...\n        if (typeof siteModel.item.title === \"number\") {\n            siteModel.item.title = getProp(settings, \"solution.title\");\n            siteModel.data.values.title = getProp(settings, \"solution.title\");\n        }\n        return siteModel;\n    })\n        .catch(function (ex) {\n        throw Error(\"site-utils::createSiteModelFromTemplate Error \" + ex);\n    });\n}\n/**\n * From Stackoverflow\n * https://stackoverflow.com/questions/147824/how-to-find-whether-a-particular-string-has-unicode-characters-esp-double-byte\n * This is the highest performance solution, combining three approaches\n */\nvar unicodeCharRegex = /[^\\u0000-\\u00ff]/;\nfunction hasUnicodeChars(value) {\n    if (value.charCodeAt(0) > 255)\n        return true;\n    return unicodeCharRegex.test(value);\n}\n//# sourceMappingURL=create-site-model-from-template.js.map","import { getProp } from \"@esri/hub-common\";\n/**\n * Return a hash of settings for the groups, including the itemControl flag\n * Both, one or neither of these groups may exist\n * @param {object} siteModel Site Model\n * @private\n */\nexport function _getSecondPassSharingOptions(siteModel) {\n    return [\n        { prop: \"item.properties.contentGroupId\", itemControl: false },\n        { prop: \"item.properties.collaborationGroupId\", itemControl: true }\n    ].reduce(function (acc, entry) {\n        var groupId = getProp(siteModel, entry.prop);\n        if (groupId) {\n            acc.push({\n                id: groupId,\n                confirmItemControl: entry.itemControl\n            });\n        }\n        return acc;\n    }, []);\n}\n//# sourceMappingURL=_get-second-pass-sharing-options.js.map","import { __spreadArrays } from \"tslib\";\nimport { getSurveyModels } from \"@esri/hub-common\";\nfunction _getIneligibleModelIds(siteModel, models, hubRequestOptions) {\n    var fetchSurveyModels = function (model) {\n        return getSurveyModels(model.item, hubRequestOptions).then(function (_a) {\n            var form = _a.form, featureService = _a.featureService, fieldworker = _a.fieldworker, stakeholder = _a.stakeholder;\n            return [form, featureService, fieldworker, stakeholder].filter(Boolean);\n        });\n    };\n    var inEligibleModelCollectionPromises = models.reduce(function (acc, model) {\n        return model.item.type === \"Form\" ? __spreadArrays(acc, [fetchSurveyModels(model)]) : acc;\n    }, [Promise.resolve([siteModel])]);\n    return Promise.all(inEligibleModelCollectionPromises).then(function (ineligibleModelCollections) {\n        return ineligibleModelCollections.reduce(function (acc, ineligibleModelCollection) { return __spreadArrays(acc, ineligibleModelCollection); }, []);\n    });\n}\nexport function _getSharingEligibleModels(siteModel, models, hubRequestOptions) {\n    return _getIneligibleModelIds(siteModel, models, hubRequestOptions).then(function (ineligibleModels) {\n        return models.reduce(function (acc, model) {\n            return ineligibleModels.find(function (_a) {\n                var id = _a.item.id;\n                return model.item.id === id;\n            })\n                ? acc\n                : __spreadArrays(acc, [model]);\n        }, []);\n    });\n}\n//# sourceMappingURL=_get-sharing-eligible-models.js.map","import { failSafe } from \"@esri/hub-common\";\nimport { shareItemWithGroup } from \"@esri/arcgis-rest-portal\";\nimport { _getSecondPassSharingOptions } from \"./_get-second-pass-sharing-options\";\nimport { _getSharingEligibleModels } from \"./_get-sharing-eligible-models\";\n/**\n * Share all the other models to the Site's content and collaboration groups, if\n * those groups were created for the site (depends on user's privs)\n * **DEPRECATED: Use shareItemsToSiteGroups() instead**\n * @param {object} siteModel Site Model\n * @param {Array} solutionModels Array of all models created by the Solution\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _shareItemsToSiteGroups(siteModel, solutionModels, hubRequestOptions) {\n    /* tslint:disable no-console */\n    console.info(\"DEPRECATED: _shareItemsToSiteGroups will be removed at v10.0.0. Use shareItemsToSiteGroups instead.\");\n    return shareItemsToSiteGroups(siteModel, solutionModels, hubRequestOptions);\n}\n/**\n * Share all the other models to the Site's content and collaboration groups, if\n * those groups were created for the site (depends on user's privs)\n * @param {object} siteModel Site Model\n * @param {Array} solutionModels Array of all models created by the Solution\n * @param {IHubRequestOptions} hubRequestOptions\n * @exported\n */\nexport function shareItemsToSiteGroups(siteModel, solutionModels, hubRequestOptions) {\n    // Create Fail-safe version of share b/c this is not critical\n    var failSafeShare = failSafe(shareItemWithGroup, { success: true });\n    var groupsToShareTo = _getSecondPassSharingOptions(siteModel);\n    // share all items in the solution to the groups, excluding the the site, form\n    // and any form feature services\n    return _getSharingEligibleModels(siteModel, solutionModels, hubRequestOptions).then(function (eligibleModels) {\n        return Promise.all(eligibleModels.reduce(function (acc, m) {\n            var itemSharePromises = groupsToShareTo.map(function (g) {\n                var opts = {\n                    id: m.item.id,\n                    groupId: g.id,\n                    confirmItemControl: g.confirmItemControl,\n                    authentication: hubRequestOptions.authentication,\n                };\n                return failSafeShare(opts);\n            });\n            return acc.concat(itemSharePromises);\n        }, []));\n    });\n}\n//# sourceMappingURL=_share-items-to-site-groups.js.map","import { getProp, interpolate } from \"@esri/hub-common\";\n/**\n * Post process the Page models, interpolating various values which would\n * not have existed when the Page item itself was created\n * @param {object} siteModel Site Model\n * @param {object} pageModel Page Model\n * @private\n */\nexport function _secondPassAdlibPages(siteModel, pageModel) {\n    // construct a hash of teams that were created and attached to the site\n    var teams = [\n        \"collaborationGroupId\",\n        \"followersGroupId\",\n        \"contentGroupId\"\n    ].reduce(function (acc, prop) {\n        var teamId = getProp(siteModel, \"item.properties.\" + prop);\n        if (teamId) {\n            acc[prop] = teamId;\n        }\n        return acc;\n    }, {});\n    var settings = {\n        teams: teams,\n        siteId: getProp(siteModel, \"item.id\"),\n        siteUrl: getProp(siteModel, \"item.url\"),\n        initiative: {\n            item: { id: getProp(siteModel, \"item.properties.parentInitiativeId\") }\n        }\n    };\n    // weld in the site itself so it can be used for some interpolations\n    settings[siteModel.key] = siteModel;\n    return interpolate(pageModel, settings);\n}\n//# sourceMappingURL=_second-pass-adlib-pages.js.map","import { failSafe, serializeModel } from \"@esri/hub-common\";\nimport { updateItem } from \"@esri/arcgis-rest-portal\";\nimport { _secondPassAdlibPages } from \"./_second-pass-adlib-pages\";\n/**\n * Locate any Page items that were created in the Solution, and link them back to the Site\n * @param {object} siteModel Site Model\n * @param {Array} solutionModels Array of all models created by the Solution\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _updatePages(siteModel, solutionModels, hubRequestOptions) {\n    // 2) for any page item, check if it has the site in it's pages array and if not add it\n    var pageModels = solutionModels.filter(function (m) {\n        return m.item.type.indexOf(\"Page\") > -1;\n    });\n    // Create Fail-safe version of update b/c this is not critical\n    var failSafeUpdate = failSafe(updateItem, { success: true });\n    // check each one of these and see if the siteModel.item.id is in it's data.value.sites array\n    // if not, add and update the item\n    var siteEntry = {\n        id: siteModel.item.id,\n        title: siteModel.item.title\n    };\n    // iterate the pages\n    return Promise.all(pageModels.map(function (m) {\n        m.data.values.sites.push(siteEntry);\n        m = _secondPassAdlibPages(siteModel, m);\n        return failSafeUpdate({\n            item: serializeModel(m),\n            authentication: hubRequestOptions.authentication\n        });\n    }));\n}\n//# sourceMappingURL=_update-pages.js.map","import { __assign } from \"tslib\";\nimport { getUser } from \"@esri/arcgis-rest-portal\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl, Logger, batch } from \"@esri/hub-common\";\n// TODO: once the Hub API User Search is complete, integrate\n// it in this function for AGO users, and fallback to the\n// current implementation for enterprise users\n/**\n * Fetches and returns members given a list of usernames\n *\n * NOTE: AGO's user search endpoint is only available to\n * authenticated users; however, since unauthenticated users\n * should still be able to access public profiles, we support\n * fetching members for both unauthenticated/authenticated\n * users in this function\n *\n * @param {string[]} usernames List of usernames to search for\n * @param {object} requestOptions IHubRequestOptions\n */\nexport function getMembers(usernames, requestOptions) {\n    return requestOptions.authentication\n        ? authenticatedGetMembers(usernames, requestOptions)\n        : unauthenticatedGetMembers(usernames, requestOptions);\n}\n/**\n * groups the provided usernames in chunks of 100 and creates query\n * strings to batch fetch those members from AGO's user search\n * (/community/users) endpoint. AGO will only return the subset of\n * members which the current user has access to.\n *\n * @param {Array} usernames List of usernames to search for\n * @param {object} requestOptions IHubRequestOptions\n */\nfunction authenticatedGetMembers(usernames, requestOptions) {\n    var urlPath = getPortalUrl(requestOptions) + \"/sharing/rest/community/users\";\n    var chunkSize = 100;\n    var chunkedUsernames = [];\n    for (var i = 0; i < usernames.length; i += chunkSize) {\n        chunkedUsernames.push(usernames.slice(i, i + chunkSize));\n    }\n    var chunkedOptions = chunkedUsernames.map(function (chunk) {\n        var q = chunk.map(function (username) { return \"username:\" + username; }).join(\" OR \");\n        return {\n            urlPath: urlPath,\n            requestOptions: __assign({ params: { q: q, num: chunk.length } }, requestOptions)\n        };\n    });\n    return batch(chunkedOptions, batchMemberRequest).then(function (batchedMembers) {\n        return batchedMembers.reduce(function (flat, toFlatten) {\n            return flat.concat(toFlatten);\n        }, []);\n    });\n}\n/**\n * fetch members individually from AGO's /community/users/{username}\n * endpoint. This endpoint, unlike the users search endpoint which\n * only returns the subset of members that the current user has acces\n * to, will only limit the information returned for each member\n * (i.e. firstname, lastname and fullname will be empty strings if\n * an unauthenticated user tries to access a non-public profile).\n *\n * @param {Array} usernames List of usernames to search for\n * @param {object} requestOptions IHubRequestOptions\n */\nfunction unauthenticatedGetMembers(usernames, requestOptions) {\n    return Promise.all(usernames.map(function (username) {\n        return getUser(__assign({ username: username }, requestOptions))\n            .then(function (response) {\n            // if the firstname, lastname, and fullname are empty strings, assume that the\n            // user is not accessible (i.e. not a public profile) and should not be returned\n            // to the unauthenticated user\n            if (response.firstName || response.lastName || response.fullName) {\n                return response;\n            }\n        })\n            .catch(function (e) {\n            Logger.error(\"Error fetching user, \" + username + \", from AGO user endpoint, \" + e);\n            return null;\n        });\n    })).then(function (members) { return members.filter(Boolean); });\n}\n/**\n * callback function to batch the requests to the user search endpoint\n * if >100 usernames are supplied. This is necessary because the\n * endpoint sets the maximum number of results to be included in the\n * result set response to 100\n *\n * @param options IBatchMemberRequestOptions\n */\nfunction batchMemberRequest(options) {\n    return request(options.urlPath, options.requestOptions)\n        .then(function (response) { return response.results; })\n        .catch(function (e) {\n        Logger.error(\"Error fetching members from AGO user search endpoint: \" + e);\n        return [];\n    });\n}\n//# sourceMappingURL=get-members.js.map","export var PAGE_TEMPLATE_KEYWORD = \"hubPageTemplate\";\n//# sourceMappingURL=page-template-keyword.js.map","import { addSiteDomains } from \"@esri/hub-common\";\n/* istanbul ignore next */\n/**\n * Given a Site Model, add the required domains.\n * This should only be called as part of the `createSite` flow\n * @param {Object} model site model\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _addSiteDomains(model, hubRequestOptions) {\n    // eslint-disable-next-line no-console\n    console.warn(\"@esri/hub-sites::_addSiteDomains is deprecated. Please use @esri/hub-common::addSiteDomains instead\");\n    return addSiteDomains(model, hubRequestOptions);\n}\n//# sourceMappingURL=_add-site-domains.js.map","import { cloneObject, getProp } from \"@esri/hub-common\";\n/**\n * We have updated aspects of the site templating logic, and now we need to\n * ensure that the groupId properties in the item template have :optional\n * if they are defined. This function simply does that.\n * @param {Object} itemTemplate template for the item part of the site\n * @private\n */\nexport function _ensureOptionalGroupsTemplating(itemTemplate) {\n    var props = [\"collaborationGroupId\", \"contentGroupId\", \"followersGroupId\"];\n    var tmpl = cloneObject(itemTemplate);\n    props.forEach(function (prop) {\n        var val = getProp(tmpl, \"properties.\" + prop);\n        if (val) {\n            if (val.match(/^\\{\\{.*\\}\\}$/)) {\n                if (!val.match(/:optional\\}\\}$/g)) {\n                    // replace it\n                    tmpl.properties[prop] = val.replace(\"}}\", \":optional}}\");\n                }\n            }\n            else {\n                delete tmpl.properties[prop];\n            }\n        }\n    });\n    return tmpl;\n}\n//# sourceMappingURL=_ensure-optional-groups-templating.js.map","import { getItemData } from \"@esri/arcgis-rest-portal\";\n/**\n * Fetch the data for a site item by Id.\n * No schema upgrades are applied.\n * @param {String} id Item Id of the site\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _getSiteDataById(id, hubRequestOptions) {\n    // Note: this was migrated to ensure consistentcy but it should not be used\n    return getItemData(id, hubRequestOptions).then(function (data) {\n        if (data.values.groupId && !data.values.collaborationGroupId) {\n            // some 2.0 sites were created with a groupId instead of a collaborationGroupId and then were migrated\n            data.values.collaborationGroupId = data.values.groupId;\n            delete data.values.groupId;\n        }\n        return data;\n    });\n}\n//# sourceMappingURL=_get-site-data-by-id.js.map","import { cloneObject, propifyString, createId, normalizeSolutionTemplateItem, replaceItemId, getItemAssets, } from \"@esri/hub-common\";\nimport { getPageItemType } from \"./get-page-item-type\";\nimport { convertLayoutToTemplate } from \"../layout\";\nimport { getSiteDependencies } from \"../get-site-dependencies\";\nimport { DRAFT_RESOURCE_REGEX } from \"../drafts/_draft-resource-regex\";\n/**\n * Given a Page Model, return a template object\n * @param {Object} model The Page item model to convert into a template\n * @param {IHubRequestOptions} hubRequestOptions IRequestOptions object, with isPortal, and portalSelf\n */\nexport function convertPageToTemplate(model, hubRequestOptions) {\n    var tmpl = cloneObject(model);\n    // set things we always want...\n    tmpl.type = getPageItemType(hubRequestOptions.isPortal);\n    tmpl.key = propifyString(model.item.title) + \"_\" + createId(\"i\");\n    tmpl.itemId = model.item.id;\n    // now pass the item off to be normalized\n    tmpl.item = normalizeSolutionTemplateItem(tmpl.item);\n    tmpl.data.values.sites = [];\n    [\"source\", \"updatedAt\", \"updatedBy\", \"folderId\", \"slug\"].forEach(function (p) {\n        delete tmpl.data.values[p];\n    });\n    // convert the layout...\n    var layoutConversion = convertLayoutToTemplate(tmpl.data.values.layout);\n    // the conversion can return an array of assets to convert, but for now, we are not using that...\n    tmpl.data.values.layout = layoutConversion.layout;\n    tmpl.dependencies = getSiteDependencies(model);\n    // convert any internal references in /data to the item's id into `{{appId}}`\n    tmpl.data = replaceItemId(tmpl.data, tmpl.itemId);\n    if (!tmpl.item.properties) {\n        tmpl.item.properties = {};\n    }\n    return getItemAssets(model.item, hubRequestOptions).then(function (assets) {\n        // Because we don't want to include the draft resource when clone a page\n        // we are filtering out assets that are not 'draft-{timestamp}.json'\n        tmpl.assets = assets.filter(function (asset) { return asset.name.search(DRAFT_RESOURCE_REGEX) === -1; });\n        return tmpl;\n    });\n}\n//# sourceMappingURL=convert-page-to-template.js.map","import { cloneObject, propifyString, createId, normalizeSolutionTemplateItem, getProp, replaceItemId, getItemAssets, } from \"@esri/hub-common\";\nimport { getSiteItemType } from \"./get-site-item-type\";\nimport { SITE_SCHEMA_VERSION } from \"./site-schema-version\";\nimport { convertLayoutToTemplate } from \"./layout\";\nimport { getSiteDependencies } from \"./get-site-dependencies\";\nimport { DRAFT_RESOURCE_REGEX } from \"./drafts/_draft-resource-regex\";\n/**\n * Convert an existing site into the Solution template format\n * @param {Object} model Site Model\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function convertSiteToTemplate(model, hubRequestOptions) {\n    // clone it...\n    var tmpl = cloneObject(model);\n    // Ensure some properties are set correctly\n    tmpl.type = getSiteItemType(hubRequestOptions.isPortal);\n    tmpl.key = propifyString(model.item.title) + \"_\" + createId(\"i\");\n    tmpl.itemId = model.item.id;\n    // now pass the item off to be normalized\n    tmpl.item = normalizeSolutionTemplateItem(tmpl.item);\n    // remove the url as it will be set when it's created\n    delete tmpl.item.url;\n    // Note: We do not template in the various team groups\n    // When a site is created from a template, those properties\n    // will be injected as needed\n    tmpl.item.properties = {\n        schemaVersion: SITE_SCHEMA_VERSION,\n        children: [],\n    };\n    // inject interpolation propertues where we need them\n    tmpl.item.title = \"{{solution.title}}\";\n    tmpl.data.values.subdomain = \"{{solution.subdomain}}\";\n    tmpl.data.values.defaultHostname = \"{{solution.defaultHostname}}\";\n    tmpl.data.values.title = \"{{solution.title}}\";\n    tmpl.data.values.subdomain = \"{{solution.subdomain}}\";\n    tmpl.data.values.defaultHostname = \"{{solution.defaultHostname}}\";\n    delete tmpl.data.catalog;\n    // teams are set explicitly vs being interpolated\n    delete tmpl.data.values.collaborationGroupId;\n    // some props need to be reset to empty strings\n    [\"updatedAt\", \"updatedBy\", \"clientId\", \"siteId\"].forEach(function (p) {\n        tmpl.data.values[p] = \"\";\n    });\n    // others we should just delete\n    [\n        \"customHostname\",\n        \"externalUrl\",\n        \"contentGroupId\",\n        \"followersGroupId\",\n        \"groups\",\n    ].forEach(function (p) {\n        delete tmpl.data.values[p];\n    });\n    // update the default extent...\n    if (getProp(tmpl, \"data.values.defaultExtent\")) {\n        tmpl.data.values.defaultExtent = \"{{organization.defaultExtent}}\";\n    }\n    if (getProp(tmpl, \"data.values.map.basemaps.primary.extent\")) {\n        tmpl.data.values.map.basemaps.primary.extent =\n            \"{{organization.defaultExtent}}\";\n    }\n    // convert the layout...\n    var layoutConversion = convertLayoutToTemplate(tmpl.data.values.layout);\n    tmpl.data.values.layout = layoutConversion.layout;\n    // convert any internal references in /data to the item's id into `{{appId}}`\n    tmpl.data = replaceItemId(tmpl.data, tmpl.itemId);\n    tmpl.dependencies = getSiteDependencies(model);\n    return getItemAssets(model.item, hubRequestOptions).then(function (assets) {\n        // Because we don't want to include the draft resource when clone a site\n        // we are filtering out assets that are not 'draft-{timestamp}.json'\n        tmpl.assets = assets.filter(function (asset) { return asset.name.search(DRAFT_RESOURCE_REGEX) === -1; });\n        return tmpl;\n    });\n}\n//# sourceMappingURL=convert-site-to-template.js.map","import { serializeModel, uploadResourcesFromUrl, getWithDefault } from \"@esri/hub-common\";\nimport { ensureRequiredPageProperties } from \"./ensure-required-page-properties\";\nimport { linkSiteAndPage } from \"../link-site-and-page\";\nimport { createItem, protectItem, shareItemWithGroup } from \"@esri/arcgis-rest-portal\";\n/**\n * Given a Page model, create the item, protect it, share it, connect it to the site\n * and upload any resources.\n * @param {Object} model Page model to be created as an Item\n * @param {Object} options object containing shareTo, and space for future additions\n * @param {IHubRequestOptions} hubRequestOptions IRequestOptions object, with isPortal\n */\nexport function createPage(model, options, hubRequestOptions) {\n    // ensure we got authentication\n    if (!hubRequestOptions.authentication) {\n        throw new Error(\"createPage must be passed hubRequestOptions.authentication\");\n    }\n    // ensure props\n    var newPage = ensureRequiredPageProperties(model, {\n        username: hubRequestOptions.authentication.username,\n        isPortal: hubRequestOptions.isPortal\n    });\n    // convert to a flat object w. .data --> .text as a json string\n    var serializedModel = serializeModel(newPage);\n    // create the item\n    return createItem({\n        item: serializedModel,\n        owner: newPage.item.owner,\n        authentication: hubRequestOptions.authentication\n    })\n        .then(function (createResponse) {\n        // hold onto the Id so we can return a complete model\n        newPage.item.id = createResponse.id;\n        // protect it\n        return protectItem({\n            id: newPage.item.id,\n            owner: newPage.item.owner,\n            authentication: hubRequestOptions.authentication\n        });\n    })\n        .then(function (protectReponse) {\n        // share to any groups\n        var sharingPromises = [];\n        if (Array.isArray(options.shareTo) && options.shareTo.length) {\n            // map over the array sharing the item to all groups\n            sharingPromises = options.shareTo.map(function (groupInfo) {\n                return shareItemWithGroup({\n                    id: newPage.item.id,\n                    groupId: groupInfo.id,\n                    authentication: hubRequestOptions.authentication,\n                    confirmItemControl: groupInfo.confirmItemControl || false\n                });\n            });\n            newPage.item.access = \"shared\";\n        }\n        return Promise.all(sharingPromises);\n    })\n        .then(function (response) {\n        // link page to sites\n        var sites = getWithDefault(newPage, \"data.values.sites\", []);\n        var requestOptions = {\n            authentication: hubRequestOptions.authentication\n        };\n        return Promise.all(sites.map(function (entry) {\n            var opts = Object.assign({\n                siteId: entry.id,\n                pageModel: newPage\n            }, requestOptions);\n            return linkSiteAndPage(opts);\n        }));\n    })\n        .then(function (siteLinkingResponse) {\n        // upload resources\n        var assets = getWithDefault(options, \"assets\", []);\n        return uploadResourcesFromUrl(newPage, assets, hubRequestOptions);\n    })\n        .then(function () { return newPage; })\n        .catch(function (err) {\n        throw Error(\"createPage: Error creating page: \" + err);\n    });\n}\n//# sourceMappingURL=create-page.js.map","import { addSolutionResourceUrlToAssets, interpolate, getProp, deepSet, slugify } from \"@esri/hub-common\";\n/**\n * Given a template, settings and transformation hashes, construct the new Page model.\n * Altough this is async, it does not persist the page\n * @param {Object} template Json Template of the Page\n * @param {Object} settings Hash of values to use in the interpolation\n * @param {Object} transforms Hash of transrormation functions available during interpolation\n * @param {IHubRequestOptions} requestOptions\n */\nexport function createPageModelFromTemplate(template, settings, transforms, hubRequestOptions) {\n    // add url to the assets, ref'ing the original location\n    template.assets = addSolutionResourceUrlToAssets(template, hubRequestOptions);\n    // request options is not currently used, but it *may* be needed, and this fn is part\n    //  of an interface needed for Solution Generation and SOME item type will need\n    // to make xhrs in this process\n    var pageModel = interpolate(template, settings, transforms);\n    if (!pageModel.item.properties) {\n        pageModel.item.properties = {};\n    }\n    // Debatable if this should be in the template, but since it's\n    // an important part of the relationship system we manually assign it\n    var parentInitiativeId = getProp(settings, \"initiative.id\");\n    if (parentInitiativeId) {\n        deepSet(pageModel, \"item.properties.parentInitiativeId\", parentInitiativeId);\n    }\n    // put the slug into the hash so we can use it in following templates\n    deepSet(pageModel, \"data.values.slug\", slugify(pageModel.item.title));\n    // do any other work here...\n    return Promise.resolve(pageModel);\n}\n//# sourceMappingURL=create-page-model-from-template.js.map","import { serializeModel, cloneObject, interpolateItemId, uploadResourcesFromUrl, getProp, addSiteDomains, registerSiteAsApplication, } from \"@esri/hub-common\";\nimport { ensureRequiredSiteProperties } from \"./ensure-required-site-properties\";\nimport { createItem, protectItem, updateItem, shareItemWithGroup, } from \"@esri/arcgis-rest-portal\";\nimport { updateInitiativeSiteId } from \"@esri/hub-initiatives\";\n/**\n * Create a New Site\n * Creates and protects the site item\n * Uploads any assets/thumbnails passed in via options.assets array\n * If not portal..,\n * - register the site as an application, w/ needed redirect uris\n * - register the domains with the Hub Domain Service\n * @param {Object} model Site Model to create\n * @param {Object} options options hash. Key prop is assets\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function createSite(model, options, hubRequestOptions) {\n    // ensure properties\n    model = ensureRequiredSiteProperties(model, hubRequestOptions.authentication.username, hubRequestOptions.isPortal);\n    // create the item\n    return createItem({\n        item: serializeModel(model),\n        owner: model.item.owner,\n        authentication: hubRequestOptions.authentication,\n    })\n        .then(function (createResponse) {\n        // hold onto the Id so we can return a complete model\n        model.item.id = createResponse.id;\n        // protect it\n        return protectItem({\n            id: model.item.id,\n            owner: model.item.owner,\n            authentication: hubRequestOptions.authentication,\n        });\n    })\n        .then(function (protectResponse) {\n        // do app registration\n        return registerSiteAsApplication(model, hubRequestOptions);\n    })\n        .then(function (appRegistrationResponse) {\n        // store the clientId\n        model.data.values.clientId = appRegistrationResponse.client_id;\n        // If we have a dcat section, hoist it out as it may contain complex adlib\n        // templates that are needed at run-time\n        // If we have data.values.dcatConfig, yank it off b/c that may have adlib template stuff in it\n        var dcatConfig = cloneObject(model.data.values.dcatConfig);\n        delete model.data.values.dcatConfig;\n        // with the id of the actual item\n        model = interpolateItemId(model);\n        // re-attach if we got anything...\n        if (dcatConfig) {\n            model.data.values.dcatConfig = dcatConfig;\n        }\n        return updateItem({\n            item: serializeModel(model),\n            authentication: hubRequestOptions.authentication,\n        });\n    })\n        .then(function (updateResponse) {\n        // Handle domains\n        return addSiteDomains(model, hubRequestOptions);\n    })\n        .then(function (domainResponses) {\n        // upload resources from url\n        return uploadResourcesFromUrl(model, options.assets || [], hubRequestOptions);\n    })\n        .then(function (uploadResponses) {\n        // default to a success response\n        var sharePrms = Promise.resolve({ success: true });\n        // share it to the collab team if that got created\n        var collabGroupId = getProp(model, \"item.properties.collaborationGroupId\");\n        if (collabGroupId) {\n            sharePrms = shareItemWithGroup({\n                id: model.item.id,\n                groupId: collabGroupId,\n                authentication: hubRequestOptions.authentication,\n                confirmItemControl: true,\n            });\n        }\n        return sharePrms;\n    })\n        .then(function (resp) {\n        // if we created an initiative, ensure we inject the site Id into it\n        var initiativeItemId = getProp(model, \"item.properties.parentInitiativeId\");\n        if (initiativeItemId) {\n            // get the item and update it\n            return updateInitiativeSiteId(initiativeItemId, model.item.id, hubRequestOptions);\n        }\n        else {\n            return Promise.resolve(true);\n        }\n    })\n        .then(function (resp) {\n        return model;\n    })\n        .catch(function (err) {\n        throw Error(\"site-utils::createSite - Error creating site \" + JSON.stringify(err));\n    });\n}\n//# sourceMappingURL=create-site.js.map","import { cloneObject, getProp } from \"@esri/hub-common\";\n/**\n * Ensure that the item template has `:optional` on the item.properties.* team\n * properties. Does not mutate the passed in object - returns a clone.\n * @param {Object} itemTemplate Item Template to work with\n */\nexport function ensureOptionalGroupsTemplating(itemTemplate) {\n    var props = [\"collaborationGroupId\", \"contentGroupId\", \"followersGroupId\"];\n    var tmpl = cloneObject(itemTemplate);\n    props.forEach(function (prop) {\n        var val = getProp(tmpl, \"properties.\" + prop);\n        if (val) {\n            if (val.match(/^\\{\\{.*\\}\\}$/)) {\n                if (!val.match(/:optional\\}\\}$/g)) {\n                    // replace it\n                    tmpl.properties[prop] = val.replace(\"}}\", \":optional}}\");\n                }\n            }\n            else {\n                delete tmpl.properties[prop];\n            }\n        }\n    });\n    return tmpl;\n}\n//# sourceMappingURL=ensure-optional-groups-templating.js.map","import { getProp } from \"@esri/hub-common\";\n/**\n * To account for complexities in the Solution generation process\n * we need to ensure that the site is linked to the Page before\n * we throw this all through the unlink/delete process\n * @param {Object} siteModel Site Model\n * @param {Objet} pageModel Page Model\n */\nexport function ensurePageHasSiteEntry(siteModel, pageModel) {\n    var siteId = siteModel.item.id;\n    var parentInitiativeId = getProp(siteModel, \"item.properties.parentInitiativeId\");\n    // swap initiativeId to siteId\n    // for a period of time, this happened during Solution generation\n    if (parentInitiativeId) {\n        var currentSites = getProp(pageModel, \"data.values.sites\");\n        var initiativeEntry = currentSites.find(function (e) {\n            return e.id === parentInitiativeId;\n        });\n        if (initiativeEntry) {\n            initiativeEntry.id = siteId;\n        }\n    }\n    // ensure that we have an entry for the site\n    // during solution generation, we can't inject the\n    // site id into the page because the page is created\n    // before the site item. We need this present so that\n    // the unlinkSiteFromPage functions will be able to update\n    // the upstream site\n    var sites = getProp(pageModel, \"data.values.sites\");\n    var siteEntry = sites.find(function (e) {\n        return e.id === siteId;\n    });\n    if (!siteEntry) {\n        pageModel.data.values.sites.push({\n            id: siteId,\n            title: \"Current Site to ensure clean removal\"\n        });\n    }\n    return pageModel;\n}\n//# sourceMappingURL=ensure-page-has-site-entry.js.map","import { getProp } from \"@esri/hub-common\";\nimport { fetchDraft } from \"./fetch-draft\";\nimport { applyDraft } from \"./apply-draft\";\n/**\n * This function fetches and applies the draft\n * to the site or page if the draft is available.\n *\n * It returns a completely new object with the draft applied\n * if there is one, otherwise it just returns the site or\n * page model argument.\n *\n * @param {*} siteOrPageModel\n * @param {*} hubRequestOptions\n */\nexport function fetchAndApplyDraft(siteOrPageModel, hubRequestOptions) {\n    return fetchDraft(getProp(siteOrPageModel, \"item.id\"), hubRequestOptions).then(function (draft) { return applyDraft(siteOrPageModel, draft); });\n}\n//# sourceMappingURL=fetch-and-apply-draft.js.map","import { upgradeSiteSchema } from \"@esri/hub-common\";\nimport { getItemData } from \"@esri/arcgis-rest-portal\";\n/**\n * Get the data for a site item. Used by the UI to back-fill\n * a site model's `.data`, usually after we already have the item\n * as a result of a search.\n * Schema upgrades are applied.\n * @param {Object} item Site Item object\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function getDataForSiteItem(item, hubRequestOptions) {\n    return getItemData(item.id, hubRequestOptions).then(function (data) {\n        return upgradeSiteSchema({\n            item: item,\n            data: data,\n        });\n    });\n}\n//# sourceMappingURL=get-data-for-site-item.js.map","import { getWithDefault } from \"@esri/hub-common\";\nimport { getLayoutDependencies } from \"../layout/get-layout-dependencies\";\n/**\n * Return a list of items this page depends on\n */\nexport function getPageDependencies(model) {\n    var layout = getWithDefault(model, \"data.values.layout\", {});\n    return getLayoutDependencies(layout);\n}\n//# sourceMappingURL=get-page-dependencies.js.map","/**\n * Get the correct url used to edit the page\n * @param item the page item\n * @param isPortal from appSettings.isPortal\n * @param siteUrl the url of the parent site\n */\nexport function getPageEditUrl(item, isPortal, siteUrl) {\n    var prefix = \"\";\n    if (isPortal) {\n        prefix = siteUrl;\n    }\n    return prefix + \"/edit?pageId=\" + item.id;\n}\n//# sourceMappingURL=get-page-edit-url.js.map","/**\n * Get the correct url used to edit the site\n * @param item the site item\n */\nexport function getSiteEditUrl(item) {\n    return item.url + \"/edit\";\n}\n//# sourceMappingURL=get-site-edit-url.js.map","import { cloneObject } from \"@esri/hub-common\";\nimport { UNPUBLISHED_CHANGES_KW } from \"./unpublished-changes-kw\";\n/**\n * Returns a copy of the model marked as having unpublished changes\n * @param {*} siteOrPageModel\n * @param {*} hubRequestOptions\n */\nexport function markPublished(siteOrPageModel) {\n    var model = cloneObject(siteOrPageModel);\n    model.item.typeKeywords = model.item.typeKeywords.filter(function (kw) { return kw !== UNPUBLISHED_CHANGES_KW; });\n    return model;\n}\n//# sourceMappingURL=mark-published.js.map","import { cloneObject, includes } from \"@esri/hub-common\";\nimport { UNPUBLISHED_CHANGES_KW } from \"./unpublished-changes-kw\";\n/**\n * Returns a copy of the model marked as having unpublished changes\n * @param {*} siteOrPageModel\n * @param {*} hubRequestOptions\n */\nexport function markUnpublished(siteOrPageModel) {\n    var model = cloneObject(siteOrPageModel);\n    if (!includes(model.item.typeKeywords, UNPUBLISHED_CHANGES_KW)) {\n        model.item.typeKeywords.push(UNPUBLISHED_CHANGES_KW);\n    }\n    return model;\n}\n//# sourceMappingURL=mark-unpublished.js.map","import { registerBrowserApp as implementation } from \"@esri/hub-common\";\n/**\n * Register an Item as an application, enabling oAuth flows at custom\n * domains. Only item types with \"Application\" in the name are valid\n * with this API call.\n * @param {string} itemId Item Id of item to create an application for\n * @param {Array} redirectUris Array of valid redirect uris for the app\n * @param {string} appType Defaults to \"browser\"\n * @param {IRequestOptions} requestOptions\n */\n/* istanbul ignore next */\nexport function registerBrowserApp(itemId, redirectUris, requestOptions) {\n    // tslint:disable-next-line\n    console.warn(\"@esri/hub-sites::registerBrowserApp is deprecated. Please use @esri/hub-common::registerBrowserApp instead\");\n    return implementation(itemId, redirectUris, requestOptions);\n}\n//# sourceMappingURL=register-browser-app.js.map","import { registerSiteAsApplication as implementation, } from \"@esri/hub-common\";\n/* istanbul ignore next */\n/**\n * Register the Site item as an application so we can oauth against it\n * @param {string} siteId Item Id of the site\n * @param {Array} uris Arrayf valid uris for the site\n * @param {IHubRequestOptions} hubRequestOptions\n */\n/* istanbul ignore next */\nexport function registerSiteAsApplication(model, hubRequestOptions) {\n    // tslint:disable-next-line\n    console.warn(\"@esri/hub-sites::registerSiteAsApplication is deprecated. Please use @esri/hub-common::registerSiteAsApplication instead\");\n    return implementation(model, hubRequestOptions);\n}\n//# sourceMappingURL=register-site-as-application.js.map","import { getModel, mapBy, getWithDefault, failSafe, unprotectModel, } from \"@esri/hub-common\";\nimport { unlinkSiteAndPage } from \"../unlink-site-and-page\";\nimport { removeItem } from \"@esri/arcgis-rest-portal\";\n/**\n * Remove a Page Item. This deletes the item.\n * @param {Object | String} idOrModel Model object or Item Id\n * @param {IRequestOptions} requestOptions\n */\nexport function removePage(idOrModel, requestOptions) {\n    var modelPromise = Promise.resolve(idOrModel);\n    if (typeof idOrModel === \"string\") {\n        modelPromise = getModel(idOrModel, requestOptions);\n    }\n    var pageModel;\n    // fire it to get the model...\n    return modelPromise\n        .then(function (model) {\n        pageModel = model;\n        // get the id's of the sites this page is linked to...\n        var linkedSites = mapBy(\"id\", getWithDefault(pageModel, \"data.values.sites\", []));\n        // we need to unlink the page from all sites. However, these calls *could* fail\n        // if the current user lacks rights to save the site item, so we just make sure these\n        // always resolve. In the Ember service code, we used `allSettled` but that's RSVP special sauce\n        var failSafeUnlink = failSafe(unlinkSiteAndPage);\n        return Promise.all(linkedSites.map(function (siteId) {\n            var opts = Object.assign({\n                pageModel: pageModel,\n                siteId: siteId,\n            }, requestOptions);\n            return failSafeUnlink(opts);\n        }));\n    })\n        .then(function () {\n        return unprotectModel(pageModel, requestOptions);\n    })\n        .then(function () {\n        var opts = Object.assign({ id: pageModel.item.id }, requestOptions);\n        return removeItem(opts);\n    });\n}\n//# sourceMappingURL=remove-page.js.map","import { getModel, _unprotectAndRemoveItem, failSafe, } from \"@esri/hub-common\";\nimport { unlinkPagesFromSite } from \"./unlink-pages-from-site\";\nimport { _removeSiteGroups } from \"./_remove-site-groups\";\nimport { _removeParentInitiative } from \"./_remove-parent-initiative\";\nimport { _removeSiteDomains } from \"./_remove-site-domains\";\nimport { _removeSiteFromIndex } from \"./_remove-site-from-index\";\n/**\n * Remove a Site Item\n * * Unlinks all pages\n * * removes all groups\n * * deletes any parent initiatve\n * * removes site from hub index,\n * * removes all domains associated with the site\n * * removes the site item\n *\n * @param {string || Object} idOrModel Id of the site or a site model\n * @param {IHubUserRequestOptions} hubRequestOptions\n */\nexport function removeSite(idOrModel, hubRequestOptions) {\n    var modelPromise;\n    if (typeof idOrModel === \"string\") {\n        modelPromise = getModel(idOrModel, hubRequestOptions);\n    }\n    else {\n        modelPromise = Promise.resolve(idOrModel);\n    }\n    var siteModel;\n    return modelPromise\n        .then(function (model) {\n        siteModel = model;\n        return unlinkPagesFromSite(siteModel, hubRequestOptions);\n    })\n        .then(function () {\n        var opts = Object.assign({ id: siteModel.item.id, owner: siteModel.item.owner }, hubRequestOptions);\n        return _unprotectAndRemoveItem(opts);\n    })\n        .then(function () {\n        // remove the groups\n        return _removeSiteGroups(siteModel, hubRequestOptions);\n    })\n        .then(function () {\n        // remove the parent initiative if that's a thing\n        return _removeParentInitiative(siteModel, hubRequestOptions);\n    })\n        .then(function () {\n        // remove the domains associated with the site item\n        return _removeSiteDomains(siteModel.item.id, hubRequestOptions);\n    })\n        .then(function () {\n        // remove the site from the Hub index\n        // failSafe because this is not critical\n        return failSafe(_removeSiteFromIndex, { success: true })(siteModel, hubRequestOptions);\n    })\n        .catch(function (err) {\n        throw Error(\"removeSite: Error removing site: \" + err);\n    });\n}\n//# sourceMappingURL=remove-site.js.map","import { getWithDefault } from \"@esri/hub-common\";\n/**\n * Remove a Site from the Page's list of sites it is connected to\n * @param {String} siteId Id of the site to unlink from the page\n * @param {Object} pageModel Page Model\n */\nexport function removeSiteFromPage(siteId, pageModel) {\n    // look for the site in the page hash...\n    return getWithDefault(pageModel, \"data.values.sites\", []).filter(function (e) {\n        return e.id !== siteId;\n    });\n}\n//# sourceMappingURL=remove-site-from-page.js.map","import { objectToJsonBlob, getProp, buildDraft, } from \"@esri/hub-common\";\nimport { _includeListFromItemType } from \"./_include-list-from-item-type\";\nimport { deleteDraft } from \"./delete-draft\";\nimport { addItemResource } from \"@esri/arcgis-rest-portal\";\n/**\n * Given a site or page model, saves a draft\n *\n * NOTE - replaces current draft if exists\n * @param {*} siteOrPageModel\n * @param {*} hubRequestOptions\n */\nexport function saveDraft(siteOrPageModel, hubRequestOptions) {\n    var includeList = _includeListFromItemType(siteOrPageModel.item);\n    var draft = buildDraft(siteOrPageModel, includeList);\n    var draftBlob = objectToJsonBlob(draft);\n    var draftName = \"draft-\" + Date.now() + \".json\";\n    var itemId = getProp(siteOrPageModel, \"item.id\");\n    return deleteDraft(siteOrPageModel, hubRequestOptions)\n        .then(function (_) {\n        return addItemResource({\n            id: itemId,\n            owner: getProp(siteOrPageModel, \"item.owner\"),\n            resource: draftBlob,\n            name: draftName,\n            private: false,\n            portal: hubRequestOptions.portal,\n            authentication: hubRequestOptions.authentication,\n        });\n    })\n        .then(function (_) { return draft; });\n}\n//# sourceMappingURL=save-draft.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { determineOwner } from \"./helpers\";\nimport { updateItem } from \"./update\";\n/**\n * ```js\n * import { addItemData } from \"@esri/arcgis-rest-portal\";\n * //\n * addItemData({\n *   id: '3ef',\n *   data: file,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Send a file or blob to an item to be stored as the `/data` resource. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with an object reporting\n *        success/failure and echoing the item id.\n */\nexport function addItemData(requestOptions) {\n    var options = __assign({ item: {\n            id: requestOptions.id,\n            data: requestOptions.data\n        } }, requestOptions);\n    delete options.id;\n    delete options.data;\n    return updateItem(options);\n}\n/**\n * ```js\n * import { addItemRelationship } from \"@esri/arcgis-rest-portal\";\n * //\n * addItemRelationship({\n *   originItemId: '3ef',\n *   destinationItemId: 'ae7',\n *   relationshipType: 'Service2Layer',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Add a relationship between two items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-relationship.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function addItemRelationship(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/addRelationship\";\n        var options = appendCustomParams(requestOptions, [\"originItemId\", \"destinationItemId\", \"relationshipType\"], { params: __assign({}, requestOptions.params) });\n        return request(url, options);\n    });\n}\n/**\n * ```js\n * import { addItemResource } from \"@esri/arcgis-rest-portal\";\n * //\n * // Add a file resource\n * addItemResource({\n *   id: '3ef',\n *   resource: file,\n *   name: 'bigkahuna.jpg',\n *   authentication\n * })\n *   .then(response)\n * //\n * // Add a text resource\n * addItemResource({\n *   id: '4fg',\n *   content: \"Text content\",\n *   name: 'bigkahuna.txt',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Add a resource associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-resources.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function addItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/addResources\";\n        requestOptions.params = __assign({ file: requestOptions.resource, fileName: requestOptions.name, resourcesPrefix: requestOptions.prefix, text: requestOptions.content, access: requestOptions.private ? \"private\" : \"inherit\" }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=add.js.map","import { __assign } from \"tslib\";\nimport { updateSite } from \"../update-site\";\nimport { updatePage, isPage } from \"../pages\";\nimport { isSite } from \"../is-site\";\nimport { hasUnpublishedChanges } from \"./has-unpublished-changes\";\n/**\n * Saves the published status of a site or page model\n * leaving everything else on the model alone.\n *\n * @param siteOrPageModel\n * @param requestOptions\n */\nexport function savePublishedStatus(siteOrPageModel, requestOptions) {\n    var allowList = [\"item.typeKeywords\"]; // only want to save typeKeywords\n    var item = siteOrPageModel.item;\n    var prms;\n    if (isSite(item)) {\n        // when saving a draft site, we need to prevent the schemaVersion\n        // from being updated. otherwise, if the user does not publish the draft,\n        // functionality potentially will be broken for all users because the item\n        // reflects the most recent schemaVersion without any of the actual schema\n        // changes\n        var isUnpublished = hasUnpublishedChanges(siteOrPageModel);\n        prms = updateSite(siteOrPageModel, __assign(__assign({}, requestOptions), { allowList: allowList, updateVersions: !isUnpublished }));\n    }\n    else if (isPage(item)) {\n        prms = updatePage(siteOrPageModel, __assign(__assign({}, requestOptions), { allowList: allowList }));\n    }\n    else {\n        throw TypeError(\"@esri/hub-sites: only page or site models have a published state\");\n    }\n    return prms;\n}\n//# sourceMappingURL=save-published-status.js.map","import { _shareItemsToSiteGroups } from \"./_share-items-to-site-groups\";\nimport { _updatePages } from \"./_update-pages\";\n/**\n * Handle the Solution \"Second Pass\" for Site\n * @param {object} siteModel Site Model\n * @param {Array} solutionModels Array of all models created by the Solution\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function siteSecondPass(siteModel, solutionModels, hubRequestOptions) {\n    var secondPassPromises = [];\n    // get all the items that are not the site\n    secondPassPromises = secondPassPromises.concat(_shareItemsToSiteGroups(siteModel, solutionModels, hubRequestOptions));\n    // link the pages\n    secondPassPromises = secondPassPromises.concat(_updatePages(siteModel, solutionModels, hubRequestOptions));\n    return Promise.all(secondPassPromises);\n}\n//# sourceMappingURL=site-second-pass.js.map","import { _getHttpAndHttpsUris, includes, } from \"@esri/hub-common\";\nimport { getDomainsForSite, removeDomain, addDomain, } from \"@esri/hub-common\";\nimport { updateAppRedirectUris } from \"./update-app-redirect-uris\";\n/**\n * Update the list of valid uris associated with the Site item\n * @param {Object} site Site Model\n * @param {Array} uris Array of valid uris for the site\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function updateSiteApplicationUris(site, uris, hubRequestOptions) {\n    if (hubRequestOptions.isPortal)\n        return Promise.resolve({});\n    // get http and https versions of all uris\n    var redirectUris = uris.reduce(function (acc, uri) {\n        return acc.concat(_getHttpAndHttpsUris(uri));\n    }, []);\n    // update the redirect uris for the application\n    return updateAppRedirectUris(site.data.values.clientId, redirectUris, hubRequestOptions)\n        .then(function () {\n        // now we update the domains, removing any that are no longer used\n        return getDomainsForSite(site.item.id, hubRequestOptions);\n    })\n        .then(function (domainInfos) {\n        // get all domains that are no longer associated with the site\n        var domainsToRemove = domainInfos.filter(function (domain) { return !includes(uris, domain.hostname); });\n        // get all new domains that are now associated with the site\n        var hostnames = domainInfos.map(function (domain) { return domain.hostname; });\n        var domainsToAdd = uris.filter(function (uri) { return !includes(hostnames, uri); });\n        // finally, kick all the promises\n        var domainPromises = [];\n        domainsToRemove.forEach(function (domain) {\n            return domainPromises.push(removeDomain(domain.id, hubRequestOptions));\n        });\n        domainsToAdd.forEach(function (uri) {\n            return domainPromises.push(addDomain({\n                orgKey: hubRequestOptions.portalSelf.urlKey,\n                orgId: hubRequestOptions.portalSelf.id,\n                orgTitle: hubRequestOptions.portalSelf.name,\n                hostname: uri,\n                siteId: site.item.id,\n                siteTitle: site.item.title,\n                clientKey: site.data.values.clientId,\n                sslOnly: domainInfos[0] ? !!domainInfos[0].sslOnly : true,\n            }, hubRequestOptions));\n        });\n        return Promise.all(domainPromises);\n    });\n}\n//# sourceMappingURL=update-site-application-uris.js.map"],"names":["PAGE_DRAFT_INCLUDE_LIST","SITE_DRAFT_INCLUDE_LIST","UNPUBLISHED_CHANGES_KW","isSite","item","normalizeItemType","unlinkSiteAndPage","unlinkRequestOptions","pageModel","siteModel","unshareGroups","promises","requestOptions","authentication","Promise","all","getModelFromOptions","then","models","isMissing","pages","getWithDefault","data","values","withoutByProp","id","maybePush","getProp","push","failSafeUpdate","sites","failSafeUnshare","failSafe","unshareItemFromGroups","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__assign","assign","t","s","i","n","arguments","length","prototype","call","apply","this","__spreadArrays","il","r","k","a","j","jl","requiresFormData","params","keys","some","key","value","toParam","constructor","name","processParams","newParams","forEach","param","firstElementType","_b","_a","JSON","stringify","join","valueOf","isArray","encodeQueryString","map","encodeParam","arrayElem","encodeURIComponent","ArcGISRequestError","message","code","response","url","options","originalMessage","warn","console","create","Error","_super","NODEJS_DEFAULT_REFERER_HEADER","DEFAULT_ARCGIS_REQUEST_OPTIONS","httpMethod","f","ArcGISAuthError","__","retry","getSession","retryLimit","retryRequest","resolve","reject","_this","session","newOptions","tries","request","catch","e","headers","missingGlobals","recommendedPackages","fetch","bind","Function","FormData","rawResponse","originalAuthError","fetchOptions","method","credentials","indexOf","getToken","err","token","getDomainCredentials","forceFormData","formData_1","requestHeaders","hideToken","window","urlWithQueryString","maxUrlLength","RegExp","test","body","useFormData","filename","Blob","append","referer","status_1","statusText","ok","status","json","text","blob","truncatedUrl","error","messageCode","errorCode","parse","statusMessage","checkForErrors","toLowerCase","split","federatedServers","expires","Date","now","appendCustomParams","customOptions","baseOptions","reduce","getPortalUrl","portal","trim","slice","serializeItem","clone","file","determineOwner","owner","getUsername","updateItem","folderId","createItem","multipart","baseUrl","CONTROL_CHAR_MATCHER","getItemBaseUrl","portalUrlOrRequestOptions","getItemData","emptyResponseErr","getItemResources","num","getItemResource","itemId","fileName","readMethod","justReturnResponse","readAs","replace","protectItem","getUserMembership","groupId","group","userMembership","memberType","removeItemResource","resource","deleteAll","SearchQueryBuilder","match","terms","_i","termStack","concat","in","field","hasRange","hasTerms","q","commit","startGroup","openGroups","endGroup","and","addModifier","or","not","from","term","rangeStack","to","boost","cleanup","modifier","currentModifer","toUpperCase","needsQuotes","formatTerm","getTime","undefined","defineProperty","get","enumerable","configurable","oldQ","searchItems","search","genericSearch","searchType","path","nextStart","nextPage","start","chunk","array","size","chunks","addGroupUsers","admins","users","_prepareRequests","errors","_consolidateRequestResults","type","usernames","results","notAdded","filter","result","collection","consolidated","removeGroupUsers","usersToRemove","usersChunk","filtered","propName","notRemoved","updateUserMemberships","opts","newMemberType","getUser","username","shareItemWithGroup","sortField","searchResponse","total","itm","isShared","shortcut","notSharedWith","isAdmin_1","isCrossOrgSharing_1","confirmItemControl","itemOwner","currentUser","ownerUser","membership","isSharedEditingGroup","role","roleId","orgId","isAdmin","membershipGuarantees","favGroupId","ensureMembership","membershipAdjustments","revert","promise","sharingResults","shareToGroup","sharingResponse","isCrossOrgSharing","groups","shouldPromote","errorMessage","ownerGroups","find","g","acc","entry","success","membershipResponse","updatePage","model","updateSiteOptions","patchList","allowList","prms","updatedAt","toISOString","updatedBy","getModel","modelFromAGO","mergeObjects","serializeModel","clearEmptyFields","getCardDependencies","card","componentName","getPaths","propertyValue","getRowDependencies","row","cards","deps","cardDeps","getSectionDependencies","section","rows","getLayoutDependencies","layout","sections","getPageItemType","isPortal","PAGE_TYPE_KEYWORD","ensureRequiredPageProperties","cloneObject","access","typeKeywords","linkSiteAndPage","linkRequestOptions","shareGroups","msg","includes","siteEntry","title","deepSet","pageEntry","failSafeShare","slugs","mapBy","slug","pageSlug","ensureUniqueString","slugify","shareItemToGroups","_getImageCropIdsFromLayout","imgAssets","headerLogo","cropId","collectSectionAssets","hasCropId","extractCropId","assets","sectionAssets","collectCards","isImageOrJumbotronCard","extractSettingsProperty","unshift","style","background","component","settings","converters","event-list-card","initiativeIds","follow-initiative-card","initiativeId","items/gallery-card","version","query","siteId","image-card","convertImageCard","jumbotron-card","convertCard","converter","fileSrc","cropSrc","convertRow","convertToTemplatizedCard","extractAssets","convertSection","toTemplatizedRows","convertLayoutToTemplate","converted","_result","header","footer","extractResourceProperty","resourceStartsWithImageSource","agoResource","getSiteDependencies","pageIds","DRAFT_RESOURCE_REGEX","isPage","_includeListFromItemType","siteOrPageItem","includeList","TypeError","hasUnpublishedChanges","siteOrPageModel","SITE_UI_VERSION","_getPortalDomainTypeKeyword","subdomain","_ensurePortalDomainKeyword","expectedKeyword","kw","updateSite","updateVersions","getSiteById","agoModel","_getDraftResourceNames","siteOrPageId","hubRequestOptions","resources","deleteDraft","draftResourceNames","resourceName","getDraftDate","draftName","ret","parsed","exec","parseInt","_getMostRecentDraftName","draftNames","dates","sort","dateA","dateB","schemaVersionPath","initialDraftVersion","upgradeDraftSchema","draft","SITE_SCHEMA_VERSION","_ensureTelemetry","fetchDraft","draftResourceName","applyDraft","getDomains","_getDomainServiceUrl","getHubApiUrl","_removeSiteGroups","prop","_unprotectAndRemoveGroup","_removeParentInitiative","parentInitiativeId","_unprotectAndRemoveItem","_removeSiteFromIndex","mode","Authorization","raw","_","_removeSiteDomains","removeDomainsBySiteId","getSiteItemType","_ensureTypeAndTags","updateAppRedirectUris","clientId","redirectUris","getPortalApiUrl","client_id","redirect_uris","unlinkPagesFromSite","linkedPages","failSafeUnlink","pageId","ensureRequiredSiteProperties","hostname","protocol","customHostname","caps","getPortalSiteHostname","port","allSSL","httpsPort","httpPort","parts","portalHostname","adaptor","getPortalSiteUrl","siteRoute","getTheme","portalSelf","getOrgDefaultTheme","_createSiteInitiative","siteTemplate","transforms","cache","getInitiativeTemplate","initiativeTemplate","solution","without","properties","teams","initiativeModel","interpolate","addInitiative","sharePrms","collabGroupId","ex","_updateTeamTags","followersGroup","props","followersGroupId","tags","interpolateSite","template","legacyDcatUS11Config","dcatConfig","feedConfigs","feeds","unicodeCharRegex","_getSecondPassSharingOptions","itemControl","_getIneligibleModelIds","inEligibleModelCollectionPromises","getSurveyModels","form","featureService","fieldworker","stakeholder","Boolean","ineligibleModelCollections","ineligibleModelCollection","_shareItemsToSiteGroups","solutionModels","info","shareItemsToSiteGroups","groupsToShareTo","ineligibleModels","eligibleModels","m","itemSharePromises","_secondPassAdlibPages","teamId","siteUrl","initiative","_updatePages","pageModels","batchMemberRequest","urlPath","Logger","addSiteDomains","itemTemplate","tmpl","val","collaborationGroupId","layoutConversion","propifyString","createId","normalizeSolutionTemplateItem","dependencies","replaceItemId","getItemAssets","asset","schemaVersion","children","defaultHostname","catalog","defaultExtent","basemaps","primary","extent","newPage","createResponse","protectReponse","sharingPromises","shareTo","groupInfo","siteLinkingResponse","uploadResourcesFromUrl","addSolutionResourceUrlToAssets","protectResponse","registerSiteAsApplication","appRegistrationResponse","interpolateItemId","updateResponse","domainResponses","uploadResponses","resp","initiativeItemId","updateInitiativeSiteId","product","getHubProduct","state","toString","createHubTeams","types","contentGroupId","domainTitle","charCodeAt","ensureUniqueDomainName","uniqueSubdomain","base","handleInitiative","theme","stripProtocol","urlKey","maybeInitiative","teamUpdatePromise","initiativeEntry","upgradeSiteSchema","authenticatedGetMembers","chunkedUsernames","chunkedOptions","batch","batchedMembers","flat","toFlatten","unauthenticatedGetMembers","firstName","lastName","fullName","members","implementation","idOrModel","modelPromise","linkedSites","unprotectModel","layoutImageCropIds","failSaveRemoveItemResources","imageItemResourcesOnAGO","itemResourcesToRemove","itemImageResources","imageCropIds","cropRegex","isNotACurrentImageCropId","unusedCrops","buildDraft","draftBlob","objectToJsonBlob","private","resourcesPrefix","prefix","content","isUnpublished","secondPassPromises","site","uris","uri","_getHttpAndHttpsUris","getDomainsForSite","domainInfos","domainsToRemove","domain","hostnames","domainsToAdd","domainPromises","removeDomain","addDomain","orgKey","orgTitle","siteTitle","clientKey","sslOnly"],"mappings":"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"}