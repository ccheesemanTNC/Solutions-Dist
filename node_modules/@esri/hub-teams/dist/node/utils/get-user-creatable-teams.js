"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getUserCreatableTeams = void 0;
const hub_common_1 = require("@esri/hub-common");
const well_known_teams_1 = require("../well-known-teams");
const can_user_create_team_in_product_1 = require("./can-user-create-team-in-product");
const remove_invalid_privs_1 = require("./remove-invalid-privs");
const apply_priv_prop_values_to_template_1 = require("./apply-priv-prop-values-to-template");
// TODO: Remove portalApiVersion at next breaking change
/**
 * Return array of group templates that the current user has licensing
 * and privs to create in the current environment (AGO vs Portal)
 * @param {object} user
 * @param {string} environment
 * @param {string} portalApiVersion
 * @param {string} subscriptionInfoType
 */
function getUserCreatableTeams(user, environment, portalApiVersion, // Depracated, remove at next breaking change
subscriptionInfoType = "") {
    /* tslint:disable no-console */
    console.warn("Hub.js::getUserCreatableTeams Deprecation warning portalApiVersion will be removed at v9.0.0");
    /* tslint:enable no-console */
    const teams = well_known_teams_1.WELLKNOWNTEAMS;
    // Online is not properly respecting addExternalMembersToGroup for
    // certain subscription types known ones so far: Trial, personal use, developer, and evaluation
    const updatedUser = remove_invalid_privs_1.removeInvalidPrivs(user, subscriptionInfoType);
    // Update templates and remove the ones that aren't applicable.
    return hub_common_1.cloneObject(teams).reduce((acc, teamTmpl) => {
        // Update template based on privPropValue
        const copyTemplate = apply_priv_prop_values_to_template_1.applyPrivPropValuesToTemplate(updatedUser, teamTmpl);
        // If the user can create the team....
        if (can_user_create_team_in_product_1.canUserCreateTeamInProduct(updatedUser, environment, copyTemplate)) {
            // Add the team to the accumulator
            acc.push(copyTemplate);
        }
        return acc;
    }, []);
}
exports.getUserCreatableTeams = getUserCreatableTeams;
//# sourceMappingURL=get-user-creatable-teams.js.map