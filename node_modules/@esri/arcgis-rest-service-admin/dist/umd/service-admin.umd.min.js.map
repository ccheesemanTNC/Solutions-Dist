{"version":3,"file":"service-admin.umd.min.js","sources":["../../src/addTo.ts","../../src/create.ts","../../src/get-service-admin-info.ts","../../src/get-view-sources.ts","../../src/update.ts"],"sourcesContent":["/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, cleanUrl } from \"@esri/arcgis-rest-request\";\nimport { ILayer, ILayerDefinition, ITable } from \"@esri/arcgis-rest-types\";\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\n\nexport interface IAddToServiceDefinitionOptions extends IUserRequestOptions {\n  /**\n   * Layers to add\n   */\n  layers?: ILayer[] | ILayerDefinition[];\n  /**\n   * Tables to add\n   */\n  tables?: ITable[];\n}\n\nexport interface IAddToServiceDefinitionItemSummary {\n  name: string;\n  id: any;\n}\n\nexport interface IAddToServiceDefinitionResult {\n  layers?: IAddToServiceDefinitionItemSummary[];\n  tables?: IAddToServiceDefinitionItemSummary[];\n  success: boolean;\n}\n\n/**\n * ```js\n * import { addToServiceDefinition } from '@esri/arcgis-rest-service-admin';\n * //\n * addToServiceDefinition(serviceurl, {\n *   authentication: userSession,\n *   layers: [],\n *   tables: []\n * });\n * ```\n * Add layer(s) and/or table(s) to a hosted feature service. See the [REST Documentation](https://developers.arcgis.com/rest/services-reference/add-to-definition-feature-service-.htm) for more information.\n *\n * @param url - URL of feature service\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with service layer and/or table details once the definition\n * has been updated\n */\nexport function addToServiceDefinition(\n  url: string,\n  requestOptions: IAddToServiceDefinitionOptions\n): Promise<IAddToServiceDefinitionResult> {\n  const adminUrl = `${cleanUrl(url).replace(\n    `/rest/services`,\n    `/rest/admin/services`\n  )}/addToDefinition`;\n\n  requestOptions.params = {\n    addToDefinition: {},\n    ...requestOptions.params\n  };\n\n  if (requestOptions.layers && requestOptions.layers.length > 0) {\n    requestOptions.params.addToDefinition.layers = requestOptions.layers;\n  }\n\n  if (requestOptions.tables && requestOptions.tables.length > 0) {\n    requestOptions.params.addToDefinition.tables = requestOptions.tables;\n  }\n\n  return request(adminUrl, requestOptions);\n}\n","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { IExtent, ISpatialReference } from \"@esri/arcgis-rest-types\";\n\nimport {\n  moveItem,\n  ICreateUpdateItemOptions,\n  determineOwner,\n  getPortalUrl\n} from \"@esri/arcgis-rest-portal\";\n\n/**\n * A [`createParameters` JSON object for a new\n * service](https://developers.arcgis.com/rest/users-groups-and-items/create-service.htm).\n */\nexport interface ICreateServiceParams {\n  /**\n   * Name of the service to be created. This name must be unique. If the name already exists, the operation will fail. ArcGIS Enterprise does not allow spaces or special characters other than underscores in a service name.\n   */\n  name: string;\n  /**\n   * Description given to the service.\n   */\n  serviceDescription?: string;\n  /**\n   * Indicates whether the data changes.\n   */\n  hasStaticData?: boolean;\n  /**\n   * A double value indicating any constraints enforced on query operations.\n   */\n  maxRecordCount?: number;\n  /**\n   * The formats in which query results are returned.\n   */\n  supportedQueryFormats?: string;\n  /**\n   * Specify feature service editing capabilities for Create, Delete, Query, Update, and Sync.\n   */\n  capabilities?: string;\n  /**\n   * A user-friendly description for the published dataset.\n   */\n  description?: string;\n  /**\n   * Copyright information associated with the dataset.\n   */\n  copyrightText?: string;\n  /**\n   * All layers added to a hosted feature service need to have the same spatial reference defined for\n   * the feature service. When creating a new empty service without specifying its spatial reference,\n   * the spatial reference of the hosted feature service is set to the first layer added to that\n   * feature service.\n   */\n  spatialReference?: ISpatialReference;\n  /**\n   * The initial extent set for the service.\n   */\n  initialExtent?: IExtent;\n  /**\n   * Indicates if updating the geometry of the service is permitted.\n   */\n  allowGeometryUpdates?: boolean;\n  /**\n   * Units used by the feature service\n   */\n  units?: string;\n  /**\n   * A JSON object specifying the properties of cross-site scripting prevention.\n   */\n  xssPreventionInfo?: any;\n  /**\n   * Editor tracking info.\n   */\n  editorTrackingInfo?: {\n    enableEditorTracking?: boolean;\n    enableOwnershipAccessControl?: boolean;\n    allowOthersToUpdate?: boolean;\n    allowOthersToDelete?: boolean;\n    allowOthersToQuery?: boolean;\n    allowAnonymousToUpdate?: boolean;\n    allowAnonymousToDelete?: boolean;\n  };\n}\n\nexport interface ICreateServiceOptions extends ICreateUpdateItemOptions {\n  /**\n   * A JSON object specifying the properties of the newly-created service. See the [REST\n   * Documentation](https://developers.arcgis.com/rest/users-groups-and-items/working-with-users-groups-and-items.htm)\n   * for more information.\n   */\n  item: ICreateServiceParams;\n  /**\n   * Alphanumeric id of folder to house moved item. If null, empty, or \"/\", the destination is the\n   * root folder.\n   */\n  folderId?: string;\n}\n\nexport interface ICreateServiceResult {\n  /**\n   * The encoded URL to the hosted service.\n   */\n  encodedServiceURL: string;\n\n  /**\n   * Indicates if this feature service represents a view.\n   */\n  isView: boolean;\n\n  /**\n   * The unique ID for this item.\n   */\n  itemId: string;\n\n  /**\n   * Name of the service item.\n   */\n  name: string;\n\n  /**\n   * The ID of the new service item.\n   */\n  serviceItemId: string;\n\n  /**\n   * The URL to the hosted service.\n   */\n  serviceurl: string;\n\n  /**\n   * The size of the item.\n   */\n  size: number;\n\n  /**\n   * Indicates if the operation was successful.\n   */\n  success: boolean;\n\n  /**\n   * The type of service created.\n   */\n  type: string;\n}\n\n/**\n * ```js\n * import {\n *   createFeatureService,\n *   addToServiceDefinition\n * } from '@esri/arcgis-rest-service-admin';\n * //\n * createFeatureService({\n *   authentication: userSession,\n *   item: {\n *     \"name\": \"NewEmptyService\",\n *     \"capabilities\": \"Create,Delete,Query,Update,Editing\"\n *   }\n * });\n * ```\n * Create a new [hosted feature service](https://developers.arcgis.com/rest/users-groups-and-items/create-service.htm). After the service has been created, call [`addToServiceDefinition()`](../addToServiceDefinition/) if you'd like to update it's schema.\n * @param requestOptions - Options for the request. NOTE: `rawResponse` is not supported by this operation.\n * @returns A Promise that resolves with service details once the service has been created\n */\nexport function createFeatureService(\n  requestOptions: ICreateServiceOptions\n): Promise<ICreateServiceResult> {\n  return determineOwner(requestOptions).then(owner => {\n    const options: ICreateServiceOptions = {\n      ...requestOptions,\n      rawResponse: false\n    };\n    const baseUrl = `${getPortalUrl(requestOptions)}/content/users/${owner}`;\n    const folder = (!options.folderId || options.folderId === \"/\") ? \"\" : \"/\" + options.folderId;\n    const url = `${baseUrl}${folder}/createService`;\n\n    // Create the service\n    options.params = {\n      createParameters: options.item,\n      outputType: \"featureService\",\n      ...options.params\n    };\n\n    return request(url, options);\n  });\n}\n","/* Copyright (c) 2018-2020 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { UserSession } from \"@esri/arcgis-rest-auth\";\nimport { IServiceInfo } from \"@esri/arcgis-rest-types\";\n\n/**\n * Given a Feature Service url, fetch the service admin information.\n *\n * The response from this call includes all the detailed information\n * for each layer/table in the service as well as some admin properties\n *\n * @export\n * @param {string} serviceUrl\n * @param {UserSession} session\n * @return {*}  {Promise<IServiceInfo>}\n */\nexport function getServiceAdminInfo(\n  serviceUrl: string,\n  session: UserSession\n): Promise<IServiceInfo> {\n  const serviceAdminUrl = serviceUrl.replace(\n    \"/rest/services\",\n    \"/rest/admin/services\"\n  );\n\n  return request(serviceAdminUrl, {\n    authentication: session,\n    params: {\n      f: \"json\",\n    },\n  });\n}\n","/* Copyright (c) 2018-2020 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { UserSession } from \"@esri/arcgis-rest-auth\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { IViewServiceSources } from \"@esri/arcgis-rest-types\";\n\n/**\n * Return the sources response for a view service item\n *\n * @param {string} viewServiceUrl\n * @param {UserSession} session\n * @return {*}  {Promise<Record<string, unknown>>}\n */\nexport function getViewSources(\n  viewServiceUrl: string,\n  session: UserSession\n): Promise<IViewServiceSources> {\n  return request(`${viewServiceUrl}/sources`, { authentication: session });\n}\n","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, cleanUrl } from \"@esri/arcgis-rest-request\";\nimport { IFeatureServiceDefinition } from \"@esri/arcgis-rest-types\";\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\n\nexport interface IUpdateServiceDefinitionOptions extends IUserRequestOptions {\n  updateDefinition?: Partial<IFeatureServiceDefinition>;\n}\n\nexport interface IUpdateServiceDefinitionResult {\n  success: boolean;\n}\n\n/**\n * ```js\n * import { updateServiceDefinition } from '@esri/arcgis-rest-service-admin';\n * //\n * updateServiceDefinition(serviceurl, {\n *   authentication: userSession,\n *   updateDefinition: serviceDefinition\n * });\n * ```\n * Update a definition property in a hosted feature service. See the [REST Documentation](https://developers.arcgis.com/rest/services-reference/update-definition-feature-service-.htm) for more information.\n *\n * @param url - URL of feature service\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with success or error\n */\nexport function updateServiceDefinition(\n  url: string,\n  requestOptions: IUpdateServiceDefinitionOptions\n): Promise<IUpdateServiceDefinitionResult> {\n  const adminUrl = `${cleanUrl(url).replace(\n    `/rest/services`,\n    `/rest/admin/services`\n  )}/updateDefinition`;\n\n  requestOptions.params = {\n    updateDefinition: {},\n    ...requestOptions.params\n  };\n\n  if (requestOptions.updateDefinition) {\n    requestOptions.params.updateDefinition = requestOptions.updateDefinition;\n  }\n\n  return request(adminUrl, requestOptions);\n}\n"],"names":["url","requestOptions","adminUrl","cleanUrl","replace","params","addToDefinition","layers","length","tables","request","determineOwner","then","owner","options","rawResponse","getPortalUrl","folderId","createParameters","item","outputType","serviceUrl","session","serviceAdminUrl","authentication","f","viewServiceUrl","updateDefinition"],"mappings":";;;;;kpBA+CEA,EACAC,GAoBA,OAlBMC,EAAcC,WAASH,GAAKI,QAChC,iBACA,2CAGFH,EAAeI,UACbC,gBAAiB,IACdL,EAAeI,QAGhBJ,EAAeM,QAAyC,EAA/BN,EAAeM,OAAOC,SACjDP,EAAeI,OAAOC,gBAAgBC,OAASN,EAAeM,QAG5DN,EAAeQ,QAAyC,EAA/BR,EAAeQ,OAAOD,SACjDP,EAAeI,OAAOC,gBAAgBG,OAASR,EAAeQ,QAGzDC,UAAQR,EAAUD,oCCoGzBA,GAEA,OAAOU,iBAAeV,GAAgBW,KAAK,SAAAC,GACzC,IAAMC,SACDb,IACHc,aAAa,IAITf,EAFagB,eAAaf,qBAAiCY,GAChDC,EAAQG,UAAiC,MAArBH,EAAQG,SAAyB,IAAMH,EAAQG,SAAnB,qBAUjE,OANAH,EAAQT,UACNa,iBAAkBJ,EAAQK,KAC1BC,WAAY,kBACTN,EAAQT,QAGNK,UAAQV,EAAKc,qCCvKtBO,EACAC,GAOA,OALMC,EAAkBF,EAAWjB,QACjC,iBACA,wBAGKM,UAAQa,EAAiB,CAC9BC,eAAgBF,EAChBjB,OAAQ,CACNoB,EAAG,qCCfPC,EACAJ,GAEA,OAAOZ,UAAWgB,aAA0B,CAAEF,eAAgBF,wCCa9DtB,EACAC,GAgBA,OAdMC,EAAcC,WAASH,GAAKI,QAChC,iBACA,4CAGFH,EAAeI,UACbsB,iBAAkB,IACf1B,EAAeI,QAGhBJ,EAAe0B,mBACjB1B,EAAeI,OAAOsB,iBAAmB1B,EAAe0B,kBAGnDjB,UAAQR,EAAUD"}