{"version":3,"file":"initiatives.umd.min.js","sources":["../../../../node_modules/tslib/tslib.es6.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/process-params.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/encode-query-string.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/ArcGISRequestError.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/warn.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/request.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/encode-form-data.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/append-custom-params.js","../esm/geometry.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/get-portal-url.js","../../../../node_modules/@esri/arcgis-rest-request/dist/esm/utils/clean-url.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/helpers.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/update.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/create.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/get.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/sharing/helpers.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/get.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/SearchQueryBuilder.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/generic-search.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/search.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/array.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/add-users.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/remove-users.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/update-user-membership.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/users/get-user.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/users/get-user-url.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/sharing/share-item-with-group.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/sharing/is-item-shared-with-group.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/util/get-portal.js","../esm/model.js","../esm/add.js","../esm/migrations/upgrade-one-dot-one.js","../esm/migrations/upgrade-two-dot-zero.js","../esm/migrations/upgrade-two-dot-two.js","../esm/migrator.js","../esm/migrations/apply-schema.js","../esm/migrations/upgrade-two-dot-one.js","../esm/get.js","../esm/groups.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/protect.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/remove.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/search.js","../esm/templates.js","../esm/util.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/add.js","../esm/detach-site.js","../esm/convert-initiative-to-template.js","../esm/follow.js","../esm/default-initiative-template.js","../esm/get-default-initiative-template.js","../esm/_fetch-and-convert-initiative-to-template.js","../esm/activate.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/create.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/groups/join.js","../esm/get-initiative-template.js","../esm/remove.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/protect.js","../../../../node_modules/@esri/arcgis-rest-portal/dist/esm/items/remove.js","../esm/search.js","../esm/update.js","../esm/update-initiative-site-id.js"],"sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __createBinding(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (p !== \"default\" && !exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Checks parameters to see if we should use FormData to send the request\n * @param params The object whose keys will be encoded.\n * @return A boolean indicating if FormData will be required.\n */\nexport function requiresFormData(params) {\n    return Object.keys(params).some(function (key) {\n        var value = params[key];\n        if (!value) {\n            return false;\n        }\n        if (value && value.toParam) {\n            value = value.toParam();\n        }\n        var type = value.constructor.name;\n        switch (type) {\n            case \"Array\":\n                return false;\n            case \"Object\":\n                return false;\n            case \"Date\":\n                return false;\n            case \"Function\":\n                return false;\n            case \"Boolean\":\n                return false;\n            case \"String\":\n                return false;\n            case \"Number\":\n                return false;\n            default:\n                return true;\n        }\n    });\n}\n/**\n * Converts parameters to the proper representation to send to the ArcGIS REST API.\n * @param params The object whose keys will be encoded.\n * @return A new object with properly encoded values.\n */\nexport function processParams(params) {\n    var newParams = {};\n    Object.keys(params).forEach(function (key) {\n        var _a, _b;\n        var param = params[key];\n        if (param && param.toParam) {\n            param = param.toParam();\n        }\n        if (!param &&\n            param !== 0 &&\n            typeof param !== \"boolean\" &&\n            typeof param !== \"string\") {\n            return;\n        }\n        var type = param.constructor.name;\n        var value;\n        // properly encodes objects, arrays and dates for arcgis.com and other services.\n        // ported from https://github.com/Esri/esri-leaflet/blob/master/src/Request.js#L22-L30\n        // also see https://github.com/Esri/arcgis-rest-js/issues/18:\n        // null, undefined, function are excluded. If you want to send an empty key you need to send an empty string \"\".\n        switch (type) {\n            case \"Array\":\n                // Based on the first element of the array, classify array as an array of arrays, an array of objects\n                // to be stringified, or an array of non-objects to be comma-separated\n                // eslint-disable-next-line no-case-declarations\n                var firstElementType = (_b = (_a = param[0]) === null || _a === void 0 ? void 0 : _a.constructor) === null || _b === void 0 ? void 0 : _b.name;\n                value =\n                    firstElementType === \"Array\" ? param : // pass thru array of arrays\n                        firstElementType === \"Object\" ? JSON.stringify(param) : // stringify array of objects\n                            param.join(\",\"); // join other types of array elements\n                break;\n            case \"Object\":\n                value = JSON.stringify(param);\n                break;\n            case \"Date\":\n                value = param.valueOf();\n                break;\n            case \"Function\":\n                value = null;\n                break;\n            case \"Boolean\":\n                value = param + \"\";\n                break;\n            default:\n                value = param;\n                break;\n        }\n        if (value || value === 0 || typeof value === \"string\" || Array.isArray(value)) {\n            newParams[key] = value;\n        }\n    });\n    return newParams;\n}\n//# sourceMappingURL=process-params.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { processParams } from \"./process-params\";\n/**\n * Encodes keys and parameters for use in a URL's query string.\n *\n * @param key Parameter's key\n * @param value Parameter's value\n * @returns Query string with key and value pairs separated by \"&\"\n */\nexport function encodeParam(key, value) {\n    // For array of arrays, repeat key=value for each element of containing array\n    if (Array.isArray(value) && value[0] && Array.isArray(value[0])) {\n        return value.map(function (arrayElem) { return encodeParam(key, arrayElem); }).join(\"&\");\n    }\n    return encodeURIComponent(key) + \"=\" + encodeURIComponent(value);\n}\n/**\n * Encodes the passed object as a query string.\n *\n * @param params An object to be encoded.\n * @returns An encoded query string.\n */\nexport function encodeQueryString(params) {\n    var newParams = processParams(params);\n    return Object.keys(newParams)\n        .map(function (key) {\n        return encodeParam(key, newParams[key]);\n    })\n        .join(\"&\");\n}\n//# sourceMappingURL=encode-query-string.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n// TypeScript 2.1 no longer allows you to extend built in types. See https://github.com/Microsoft/TypeScript/issues/12790#issuecomment-265981442\n// and https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n//\n// This code is from MDN https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types.\nvar ArcGISRequestError = /** @class */ (function () {\n    /**\n     * Create a new `ArcGISRequestError`  object.\n     *\n     * @param message - The error message from the API\n     * @param code - The error code from the API\n     * @param response - The original response from the API that caused the error\n     * @param url - The original url of the request\n     * @param options - The original options and parameters of the request\n     */\n    function ArcGISRequestError(message, code, response, url, options) {\n        message = message || \"UNKNOWN_ERROR\";\n        code = code || \"UNKNOWN_ERROR_CODE\";\n        this.name = \"ArcGISRequestError\";\n        this.message =\n            code === \"UNKNOWN_ERROR_CODE\" ? message : code + \": \" + message;\n        this.originalMessage = message;\n        this.code = code;\n        this.response = response;\n        this.url = url;\n        this.options = options;\n    }\n    return ArcGISRequestError;\n}());\nexport { ArcGISRequestError };\nArcGISRequestError.prototype = Object.create(Error.prototype);\nArcGISRequestError.prototype.constructor = ArcGISRequestError;\n//# sourceMappingURL=ArcGISRequestError.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Method used internally to surface messages to developers.\n */\nexport function warn(message) {\n    if (console && console.warn) {\n        console.warn.apply(console, [message]);\n    }\n}\n//# sourceMappingURL=warn.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign, __extends } from \"tslib\";\nimport { encodeFormData } from \"./utils/encode-form-data\";\nimport { encodeQueryString } from \"./utils/encode-query-string\";\nimport { requiresFormData } from \"./utils/process-params\";\nimport { ArcGISRequestError } from \"./utils/ArcGISRequestError\";\nimport { warn } from \"./utils/warn\";\nexport var NODEJS_DEFAULT_REFERER_HEADER = \"@esri/arcgis-rest-js\";\nvar DEFAULT_ARCGIS_REQUEST_OPTIONS = {\n    httpMethod: \"POST\",\n    params: {\n        f: \"json\",\n    },\n};\n/**\n * Sets the default options that will be passed in **all requests across all `@esri/arcgis-rest-js` modules**.\n *\n *\n * ```js\n * import { setDefaultRequestOptions } from \"@esri/arcgis-rest-request\";\n * setDefaultRequestOptions({\n *   authentication: userSession // all requests will use this session by default\n * })\n * ```\n * You should **never** set a default `authentication` when you are in a server side environment where you may be handling requests for many different authenticated users.\n *\n * @param options The default options to pass with every request. Existing default will be overwritten.\n * @param hideWarnings Silence warnings about setting default `authentication` in shared environments.\n */\nexport function setDefaultRequestOptions(options, hideWarnings) {\n    if (options.authentication && !hideWarnings) {\n        warn(\"You should not set `authentication` as a default in a shared environment such as a web server which will process multiple users requests. You can call `setDefaultRequestOptions` with `true` as a second argument to disable this warning.\");\n    }\n    DEFAULT_ARCGIS_REQUEST_OPTIONS = options;\n}\nvar ArcGISAuthError = /** @class */ (function (_super) {\n    __extends(ArcGISAuthError, _super);\n    /**\n     * Create a new `ArcGISAuthError`  object.\n     *\n     * @param message - The error message from the API\n     * @param code - The error code from the API\n     * @param response - The original response from the API that caused the error\n     * @param url - The original url of the request\n     * @param options - The original options of the request\n     */\n    function ArcGISAuthError(message, code, response, url, options) {\n        if (message === void 0) { message = \"AUTHENTICATION_ERROR\"; }\n        if (code === void 0) { code = \"AUTHENTICATION_ERROR_CODE\"; }\n        var _this = _super.call(this, message, code, response, url, options) || this;\n        _this.name = \"ArcGISAuthError\";\n        _this.message =\n            code === \"AUTHENTICATION_ERROR_CODE\" ? message : code + \": \" + message;\n        return _this;\n    }\n    ArcGISAuthError.prototype.retry = function (getSession, retryLimit) {\n        var _this = this;\n        if (retryLimit === void 0) { retryLimit = 3; }\n        var tries = 0;\n        var retryRequest = function (resolve, reject) {\n            getSession(_this.url, _this.options)\n                .then(function (session) {\n                var newOptions = __assign(__assign({}, _this.options), { authentication: session });\n                tries = tries + 1;\n                return request(_this.url, newOptions);\n            })\n                .then(function (response) {\n                resolve(response);\n            })\n                .catch(function (e) {\n                if (e.name === \"ArcGISAuthError\" && tries < retryLimit) {\n                    retryRequest(resolve, reject);\n                }\n                else if (e.name === \"ArcGISAuthError\" && tries >= retryLimit) {\n                    reject(_this);\n                }\n                else {\n                    reject(e);\n                }\n            });\n        };\n        return new Promise(function (resolve, reject) {\n            retryRequest(resolve, reject);\n        });\n    };\n    return ArcGISAuthError;\n}(ArcGISRequestError));\nexport { ArcGISAuthError };\n/**\n * Checks for errors in a JSON response from the ArcGIS REST API. If there are no errors, it will return the `data` passed in. If there is an error, it will throw an `ArcGISRequestError` or `ArcGISAuthError`.\n *\n * @param data The response JSON to check for errors.\n * @param url The url of the original request\n * @param params The parameters of the original request\n * @param options The options of the original request\n * @returns The data that was passed in the `data` parameter\n */\nexport function checkForErrors(response, url, params, options, originalAuthError) {\n    // this is an error message from billing.arcgis.com backend\n    if (response.code >= 400) {\n        var message = response.message, code = response.code;\n        throw new ArcGISRequestError(message, code, response, url, options);\n    }\n    // error from ArcGIS Online or an ArcGIS Portal or server instance.\n    if (response.error) {\n        var _a = response.error, message = _a.message, code = _a.code, messageCode = _a.messageCode;\n        var errorCode = messageCode || code || \"UNKNOWN_ERROR_CODE\";\n        if (code === 498 ||\n            code === 499 ||\n            messageCode === \"GWM_0003\" ||\n            (code === 400 && message === \"Unable to generate token.\")) {\n            if (originalAuthError) {\n                throw originalAuthError;\n            }\n            else {\n                throw new ArcGISAuthError(message, errorCode, response, url, options);\n            }\n        }\n        throw new ArcGISRequestError(message, errorCode, response, url, options);\n    }\n    // error from a status check\n    if (response.status === \"failed\" || response.status === \"failure\") {\n        var message = void 0;\n        var code = \"UNKNOWN_ERROR_CODE\";\n        try {\n            message = JSON.parse(response.statusMessage).message;\n            code = JSON.parse(response.statusMessage).code;\n        }\n        catch (e) {\n            message = response.statusMessage || response.message;\n        }\n        throw new ArcGISRequestError(message, code, response, url, options);\n    }\n    return response;\n}\n/**\n * ```js\n * import { request } from '@esri/arcgis-rest-request';\n * //\n * request('https://www.arcgis.com/sharing/rest')\n *   .then(response) // response.currentVersion === 5.2\n * //\n * request('https://www.arcgis.com/sharing/rest', {\n *   httpMethod: \"GET\"\n * })\n * //\n * request('https://www.arcgis.com/sharing/rest/search', {\n *   params: { q: 'parks' }\n * })\n *   .then(response) // response.total => 78379\n * ```\n * Generic method for making HTTP requests to ArcGIS REST API endpoints.\n *\n * @param url - The URL of the ArcGIS REST API endpoint.\n * @param requestOptions - Options for the request, including parameters relevant to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function request(url, requestOptions) {\n    if (requestOptions === void 0) { requestOptions = { params: { f: \"json\" } }; }\n    var options = __assign(__assign(__assign({ httpMethod: \"POST\" }, DEFAULT_ARCGIS_REQUEST_OPTIONS), requestOptions), {\n        params: __assign(__assign({}, DEFAULT_ARCGIS_REQUEST_OPTIONS.params), requestOptions.params),\n        headers: __assign(__assign({}, DEFAULT_ARCGIS_REQUEST_OPTIONS.headers), requestOptions.headers),\n    });\n    var missingGlobals = [];\n    var recommendedPackages = [];\n    // don't check for a global fetch if a custom implementation was passed through\n    if (!options.fetch && typeof fetch !== \"undefined\") {\n        options.fetch = fetch.bind(Function(\"return this\")());\n    }\n    else {\n        missingGlobals.push(\"`fetch`\");\n        recommendedPackages.push(\"`node-fetch`\");\n    }\n    if (typeof Promise === \"undefined\") {\n        missingGlobals.push(\"`Promise`\");\n        recommendedPackages.push(\"`es6-promise`\");\n    }\n    if (typeof FormData === \"undefined\") {\n        missingGlobals.push(\"`FormData`\");\n        recommendedPackages.push(\"`isomorphic-form-data`\");\n    }\n    if (!options.fetch ||\n        typeof Promise === \"undefined\" ||\n        typeof FormData === \"undefined\") {\n        throw new Error(\"`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing \" + missingGlobals.join(\", \") + \". We recommend installing the \" + recommendedPackages.join(\", \") + \" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.\");\n    }\n    var httpMethod = options.httpMethod, authentication = options.authentication, rawResponse = options.rawResponse;\n    var params = __assign({ f: \"json\" }, options.params);\n    var originalAuthError = null;\n    var fetchOptions = {\n        method: httpMethod,\n        /* ensures behavior mimics XMLHttpRequest.\n        needed to support sending IWA cookies */\n        credentials: options.credentials || \"same-origin\",\n    };\n    // the /oauth2/platformSelf route will add X-Esri-Auth-Client-Id header\n    // and that request needs to send cookies cross domain\n    // so we need to set the credentials to \"include\"\n    if (options.headers &&\n        options.headers[\"X-Esri-Auth-Client-Id\"] &&\n        url.indexOf(\"/oauth2/platformSelf\") > -1) {\n        fetchOptions.credentials = \"include\";\n    }\n    return (authentication\n        ? authentication.getToken(url, { fetch: options.fetch }).catch(function (err) {\n            /**\n             * append original request url and requestOptions\n             * to the error thrown by getToken()\n             * to assist with retrying\n             */\n            err.url = url;\n            err.options = options;\n            /**\n             * if an attempt is made to talk to an unfederated server\n             * first try the request anonymously. if a 'token required'\n             * error is thrown, throw the UNFEDERATED error then.\n             */\n            originalAuthError = err;\n            return Promise.resolve(\"\");\n        })\n        : Promise.resolve(\"\"))\n        .then(function (token) {\n        if (token.length) {\n            params.token = token;\n        }\n        if (authentication && authentication.getDomainCredentials) {\n            fetchOptions.credentials = authentication.getDomainCredentials(url);\n        }\n        // Custom headers to add to request. IRequestOptions.headers with merge over requestHeaders.\n        var requestHeaders = {};\n        if (fetchOptions.method === \"GET\") {\n            // Prevents token from being passed in query params when hideToken option is used.\n            /* istanbul ignore if - window is always defined in a browser. Test case is covered by Jasmine in node test */\n            if (params.token &&\n                options.hideToken &&\n                // Sharing API does not support preflight check required by modern browsers https://developer.mozilla.org/en-US/docs/Glossary/Preflight_request\n                typeof window === \"undefined\") {\n                requestHeaders[\"X-Esri-Authorization\"] = \"Bearer \" + params.token;\n                delete params.token;\n            }\n            // encode the parameters into the query string\n            var queryParams = encodeQueryString(params);\n            // dont append a '?' unless parameters are actually present\n            var urlWithQueryString = queryParams === \"\" ? url : url + \"?\" + encodeQueryString(params);\n            if (\n            // This would exceed the maximum length for URLs specified by the consumer and requires POST\n            (options.maxUrlLength &&\n                urlWithQueryString.length > options.maxUrlLength) ||\n                // Or if the customer requires the token to be hidden and it has not already been hidden in the header (for browsers)\n                (params.token && options.hideToken)) {\n                // the consumer specified a maximum length for URLs\n                // and this would exceed it, so use post instead\n                fetchOptions.method = \"POST\";\n                // If the token was already added as a Auth header, add the token back to body with other params instead of header\n                if (token.length && options.hideToken) {\n                    params.token = token;\n                    // Remove existing header that was added before url query length was checked\n                    delete requestHeaders[\"X-Esri-Authorization\"];\n                }\n            }\n            else {\n                // just use GET\n                url = urlWithQueryString;\n            }\n        }\n        /* updateResources currently requires FormData even when the input parameters dont warrant it.\n    https://developers.arcgis.com/rest/users-groups-and-items/update-resources.htm\n        see https://github.com/Esri/arcgis-rest-js/pull/500 for more info. */\n        var forceFormData = new RegExp(\"/items/.+/updateResources\").test(url);\n        if (fetchOptions.method === \"POST\") {\n            fetchOptions.body = encodeFormData(params, forceFormData);\n        }\n        // Mixin headers from request options\n        fetchOptions.headers = __assign(__assign({}, requestHeaders), options.headers);\n        /* istanbul ignore next - karma reports coverage on browser tests only */\n        if (typeof window === \"undefined\" && !fetchOptions.headers.referer) {\n            fetchOptions.headers.referer = NODEJS_DEFAULT_REFERER_HEADER;\n        }\n        /* istanbul ignore else blob responses are difficult to make cross platform we will just have to trust the isomorphic fetch will do its job */\n        if (!requiresFormData(params) && !forceFormData) {\n            fetchOptions.headers[\"Content-Type\"] =\n                \"application/x-www-form-urlencoded\";\n        }\n        return options.fetch(url, fetchOptions);\n    })\n        .then(function (response) {\n        if (!response.ok) {\n            // server responded w/ an actual error (404, 500, etc)\n            var status_1 = response.status, statusText = response.statusText;\n            throw new ArcGISRequestError(statusText, \"HTTP \" + status_1, response, url, options);\n        }\n        if (rawResponse) {\n            return response;\n        }\n        switch (params.f) {\n            case \"json\":\n                return response.json();\n            case \"geojson\":\n                return response.json();\n            case \"html\":\n                return response.text();\n            case \"text\":\n                return response.text();\n            /* istanbul ignore next blob responses are difficult to make cross platform we will just have to trust that isomorphic fetch will do its job */\n            default:\n                return response.blob();\n        }\n    })\n        .then(function (data) {\n        if ((params.f === \"json\" || params.f === \"geojson\") && !rawResponse) {\n            var response = checkForErrors(data, url, params, options, originalAuthError);\n            if (originalAuthError) {\n                /* If the request was made to an unfederated service that\n                didn't require authentication, add the base url and a dummy token\n                to the list of trusted servers to avoid another federation check\n                in the event of a repeat request */\n                var truncatedUrl = url\n                    .toLowerCase()\n                    .split(/\\/rest(\\/admin)?\\/services\\//)[0];\n                options.authentication.federatedServers[truncatedUrl] = {\n                    token: [],\n                    // default to 24 hours\n                    expires: new Date(Date.now() + 86400 * 1000),\n                };\n                originalAuthError = null;\n            }\n            return response;\n        }\n        else {\n            return data;\n        }\n    });\n}\n//# sourceMappingURL=request.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { processParams, requiresFormData } from \"./process-params\";\nimport { encodeQueryString } from \"./encode-query-string\";\n/**\n * Encodes parameters in a [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) object in browsers or in a [FormData](https://github.com/form-data/form-data) in Node.js\n *\n * @param params An object to be encoded.\n * @returns The complete [FormData](https://developer.mozilla.org/en-US/docs/Web/API/FormData) object.\n */\nexport function encodeFormData(params, forceFormData) {\n    // see https://github.com/Esri/arcgis-rest-js/issues/499 for more info.\n    var useFormData = requiresFormData(params) || forceFormData;\n    var newParams = processParams(params);\n    if (useFormData) {\n        var formData_1 = new FormData();\n        Object.keys(newParams).forEach(function (key) {\n            if (typeof Blob !== \"undefined\" && newParams[key] instanceof Blob) {\n                /* To name the Blob:\n                 1. look to an alternate request parameter called 'fileName'\n                 2. see if 'name' has been tacked onto the Blob manually\n                 3. if all else fails, use the request parameter\n                */\n                var filename = newParams[\"fileName\"] || newParams[key].name || key;\n                formData_1.append(key, newParams[key], filename);\n            }\n            else {\n                formData_1.append(key, newParams[key]);\n            }\n        });\n        return formData_1;\n    }\n    else {\n        return encodeQueryString(params);\n    }\n}\n//# sourceMappingURL=encode-form-data.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\n/**\n * Helper for methods with lots of first order request options to pass through as request parameters.\n */\nexport function appendCustomParams(customOptions, keys, baseOptions) {\n    var requestOptionsKeys = [\n        \"params\",\n        \"httpMethod\",\n        \"rawResponse\",\n        \"authentication\",\n        \"portal\",\n        \"fetch\",\n        \"maxUrlLength\",\n        \"headers\"\n    ];\n    var options = __assign(__assign({ params: {} }, baseOptions), customOptions);\n    // merge all keys in customOptions into options.params\n    options.params = keys.reduce(function (value, key) {\n        if (customOptions[key] || typeof customOptions[key] === \"boolean\") {\n            value[key] = customOptions[key];\n        }\n        return value;\n    }, options.params);\n    // now remove all properties in options that don't exist in IRequestOptions\n    return requestOptionsKeys.reduce(function (value, key) {\n        if (options[key]) {\n            value[key] = options[key];\n        }\n        return value;\n    }, {});\n}\n//# sourceMappingURL=append-custom-params.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getProp } from \"@esri/hub-common\";\n/**\n * Wrapper for geometry service functions\n */\nvar geometryService = {\n    // default geometry service url\n    AGO_GEOMETRY_SERVICE: \"https://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer\",\n    /**\n     * Get the geometry service url.\n     * If a portal object is passed, it will extract the portal's geometry server\n     * otherwise, it will return the public AGO geometry service\n     *\n     * @param portal\n     */\n    getUrl: function (portal) {\n        var url = this.AGO_GEOMETRY_SERVICE;\n        if (portal) {\n            var portalService = getProp(portal, \"helperServices.geometry.url\");\n            if (portalService) {\n                url = portalService;\n            }\n        }\n        return url;\n    },\n    /**\n     * Should we add a token to the call - basically we never want to send\n     * tokens to the public arcgisonline service.\n     *\n     * @param {string} url\n     * @returns {boolean}\n     */\n    shouldAddTokenToCall: function (url) {\n        var result = true;\n        if (url.indexOf(\"arcgisonline\") > -1) {\n            result = false;\n        }\n        return result;\n    },\n    /**\n     * Project a geometry using a specific geometry server\n     *\n     * @param {string} serviceUrl\n     * @param {*} inSR input spatial reference - wkid or object\n     * @param {*} outSR output spatial reference - wkid or object\n     * @param {string} geometryType the type of the input geometries\n     * @param {[any]} geometries array of geometryes\n     * @param {IRequestOptions} requestOptions\n     * @returns {Promise<any>}\n     */\n    project: function (serviceUrl, inSR, outSR, geometryType, geometries, requestOptions) {\n        var url = serviceUrl + \"/project\";\n        // we may be mutating this, so make a copy...\n        var opts = __assign({}, requestOptions);\n        opts.params = {\n            geometries: {\n                geometryType: geometryType,\n                geometries: geometries\n            },\n            transformForward: false,\n            transformation: \"\",\n            inSR: inSR,\n            outSR: outSR,\n            f: \"json\"\n        };\n        if (!this.shouldAddTokenToCall(url) && opts.authentication) {\n            // remove the authentication...\n            // if the same rO is used thru multiple calls...\n            delete opts.authentication;\n        }\n        return request(url, opts);\n    }\n};\nexport default geometryService;\n//# sourceMappingURL=geometry.js.map","/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { cleanUrl } from \"@esri/arcgis-rest-request\";\n/**\n * Helper that returns the appropriate portal url for a given request. `requestOptions.portal` is given\n * precedence over `authentication.portal`. If neither `portal` nor `authentication` is present,\n * `www.arcgis.com/sharing/rest` is returned.\n *\n * @param requestOptions - Request options that may have authentication manager\n * @returns Portal url to be used in API requests\n */\nexport function getPortalUrl(requestOptions) {\n    if (requestOptions === void 0) { requestOptions = {}; }\n    // use portal in options if specified\n    if (requestOptions.portal) {\n        return cleanUrl(requestOptions.portal);\n    }\n    // if auth was passed, use that portal\n    if (requestOptions.authentication) {\n        // the portal url is already scrubbed in the auth package\n        return requestOptions.authentication.portal;\n    }\n    // default to arcgis.com\n    return \"https://www.arcgis.com/sharing/rest\";\n}\n//# sourceMappingURL=get-portal-url.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Helper method to ensure that user supplied urls don't include whitespace or a trailing slash.\n */\nexport function cleanUrl(url) {\n    // Guard so we don't try to trim something that's not a string\n    if (typeof url !== \"string\") {\n        return url;\n    }\n    // trim leading and trailing spaces, but not spaces inside the url\n    url = url.trim();\n    // remove the trailing slash to the url if one was included\n    if (url[url.length - 1] === \"/\") {\n        url = url.slice(0, -1);\n    }\n    return url;\n}\n//# sourceMappingURL=clean-url.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n/**\n * Serialize an item and its data into a json format accepted by the Portal API for create and update operations\n *\n * @param item Item to be serialized\n * @returns a formatted json object to be sent to Portal\n */\nexport function serializeItem(item) {\n    // create a clone so we're not messing with the original\n    var clone = JSON.parse(JSON.stringify(item));\n    // binary data needs POSTed as a `file`\n    // JSON object literals should be passed as `text`.\n    if (clone.data) {\n        (typeof Blob !== \"undefined\" && item.data instanceof Blob) ||\n            // Node.js doesn't implement Blob\n            item.data.constructor.name === \"ReadStream\"\n            ? (clone.file = item.data)\n            : (clone.text = item.data);\n        delete clone.data;\n    }\n    return clone;\n}\n/**\n * `requestOptions.owner` is given priority, `requestOptions.item.owner` will be checked next. If neither are present, `authentication.getUserName()` will be used instead.\n */\nexport function determineOwner(requestOptions) {\n    if (requestOptions.owner) {\n        return Promise.resolve(requestOptions.owner);\n    }\n    else if (requestOptions.item && requestOptions.item.owner) {\n        return Promise.resolve(requestOptions.item.owner);\n    }\n    else if (requestOptions.authentication &&\n        requestOptions.authentication.getUsername) {\n        return requestOptions.authentication.getUsername();\n    }\n    else {\n        return Promise.reject(new Error(\"Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option.\"));\n    }\n}\n//# sourceMappingURL=helpers.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { serializeItem, determineOwner } from \"./helpers\";\n/**\n * ```js\n * import { updateItem } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItem({\n *   item: {\n *     id: \"3ef\",\n *     description: \"A three hour tour\"\n *   },\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update an Item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm) for more information.\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that updates an item.\n */\nexport function updateItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = requestOptions.folderId\n            ? getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/\" + requestOptions.folderId + \"/items/\" + requestOptions.item.id + \"/update\"\n            : getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.item.id + \"/update\";\n        // serialize the item into something Portal will accept\n        requestOptions.params = __assign(__assign({}, requestOptions.params), serializeItem(requestOptions.item));\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { updateItemInfo } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItemInfo({\n *   id: '3ef',\n *   file: file,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update an info file associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-info.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that updates an item info file.\n */\nexport function updateItemInfo(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/updateinfo\";\n        // mix in user supplied params\n        requestOptions.params = __assign({ folderName: requestOptions.folderName, file: requestOptions.file }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { updateItemResource } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItemResource({\n *   id: '3ef',\n *   resource: file,\n *   name: 'bigkahuna.jpg',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update a resource associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-resources.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that updates an item resource.\n */\nexport function updateItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/updateResources\";\n        // mix in user supplied params\n        requestOptions.params = __assign({ file: requestOptions.resource, fileName: requestOptions.name, resourcesPrefix: requestOptions.prefix, text: requestOptions.content }, requestOptions.params);\n        // only override the access specified previously if 'private' is passed explicitly\n        if (typeof requestOptions.private !== \"undefined\") {\n            requestOptions.params.access = requestOptions.private\n                ? \"private\"\n                : \"inherit\";\n        }\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { moveItem } from \"@esri/arcgis-rest-portal\";\n * //\n * moveItem({\n *   itemId: \"3ef\",\n *   folderId: \"7c5\",\n *   authentication: userSession\n * })\n * ```\n * Move an item to a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/move-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with owner and folder details once the move has been completed\n */\nexport function moveItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.itemId + \"/move\";\n        var folderId = requestOptions.folderId;\n        if (!folderId) {\n            folderId = \"/\";\n        }\n        requestOptions.params = __assign({ folder: folderId }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=update.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { serializeItem, determineOwner } from \"./helpers\";\n/**\n * ```js\n * import { createFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * createFolder({\n *   title: 'Map Collection',\n *   authentication: userSession\n * })\n *   .then(response)\n * ```\n * Create a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/create-folder.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with folder details once the folder has been created\n */\nexport function createFolder(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var baseUrl = getPortalUrl(requestOptions) + \"/content/users/\" + owner;\n        var url = baseUrl + \"/createFolder\";\n        requestOptions.params = __assign({ title: requestOptions.title }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { createItemInFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * createItemInFolder({\n *   item: {\n *     title: \"The Amazing Voyage\",\n *     type: \"Web Map\"\n *   },\n *   folderId: 'fe8',\n *   authentication\n * })\n * ```\n * Create an item in a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-item.htm) for more information.\n *\n * @param requestOptions = Options for the request\n */\nexport function createItemInFolder(requestOptions) {\n    if (requestOptions.multipart && !requestOptions.filename) {\n        return Promise.reject(new Error(\"The filename is required for a multipart request.\"));\n    }\n    return determineOwner(requestOptions).then(function (owner) {\n        var baseUrl = getPortalUrl(requestOptions) + \"/content/users/\" + owner;\n        var url = baseUrl + \"/addItem\";\n        if (requestOptions.folderId) {\n            url = baseUrl + \"/\" + requestOptions.folderId + \"/addItem\";\n        }\n        requestOptions.params = __assign(__assign({}, requestOptions.params), serializeItem(requestOptions.item));\n        // serialize the item into something Portal will accept\n        var options = appendCustomParams(requestOptions, [\n            \"owner\",\n            \"folderId\",\n            \"file\",\n            \"dataUrl\",\n            \"text\",\n            \"async\",\n            \"multipart\",\n            \"filename\",\n            \"overwrite\"\n        ], {\n            params: __assign({}, requestOptions.params)\n        });\n        return request(url, options);\n    });\n}\n/**\n * ```js\n * import { createItem } from \"@esri/arcgis-rest-portal\";\n * //\n * createItem({\n *   item: {\n *     title: \"The Amazing Voyage\",\n *     type: \"Web Map\"\n *   },\n *   authentication\n * })\n * ```\n * Create an Item in the user's root folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that creates an item.\n */\nexport function createItem(requestOptions) {\n    // delegate to createItemInFolder placing in the root of the filestore\n    var options = __assign({ folderId: null }, requestOptions);\n    return createItemInFolder(options);\n}\n//# sourceMappingURL=create.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { scrubControlChars } from '../util/scrub-control-chars';\nimport { determineOwner } from \"./helpers\";\n/**\n * ```\n * import { getItem } from \"@esri/arcgis-rest-portal\";\n * //\n * getItem(\"ae7\")\n *   .then(response);\n * // or\n * getItem(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get an item by id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item.htm) for more information.\n *\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function getItem(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions);\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Get the fully qualified base URL to the REST end point for an item.\n * @param id Item Id\n * @param portalUrlOrRequestOptions a portal URL or request options\n * @returns URL to the item's REST end point, defaults to `https://www.arcgis.com/sharing/rest/content/items/{id}`\n */\nexport var getItemBaseUrl = function (id, portalUrlOrRequestOptions) {\n    var portalUrl = typeof portalUrlOrRequestOptions === \"string\"\n        ? portalUrlOrRequestOptions\n        : getPortalUrl(portalUrlOrRequestOptions);\n    return portalUrl + \"/content/items/\" + id;\n};\n/**\n * ```\n * import { getItemData } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemData(\"ae7\")\n *   .then(response)\n * // or\n * getItemData(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get the /data for an item. If no data exists, returns `undefined`. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-data.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the json data for the item.\n */\nexport function getItemData(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions) + \"/data\";\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\", params: {} }, requestOptions);\n    if (options.file) {\n        options.params.f = null;\n    }\n    return request(url, options).catch(function (err) {\n        /* if the item doesn't include data, the response will be empty\n           and the internal call to response.json() will fail */\n        var emptyResponseErr = RegExp(/The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i);\n        /* istanbul ignore else */\n        if (emptyResponseErr.test(err.message)) {\n            return;\n        }\n        else\n            throw err;\n    });\n}\n/**\n * ```\n * import { getRelatedItems } from \"@esri/arcgis-rest-portal\";\n * //\n * getRelatedItems({\n *   id: \"ae7\",\n *   relationshipType: \"Service2Layer\" // or several [\"Service2Layer\", \"Map2Area\"]\n * })\n *   .then(response)\n * ```\n * Get the related items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/related-items.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getRelatedItems(requestOptions) {\n    var url = getItemBaseUrl(requestOptions.id, requestOptions) + \"/relatedItems\";\n    var options = __assign({ httpMethod: \"GET\", params: {\n            direction: requestOptions.direction\n        } }, requestOptions);\n    if (typeof requestOptions.relationshipType === \"string\") {\n        options.params.relationshipType = requestOptions.relationshipType;\n    }\n    else {\n        options.params.relationshipTypes = requestOptions.relationshipType;\n    }\n    delete options.direction;\n    delete options.relationshipType;\n    return request(url, options);\n}\n/**\n * Get the resources associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getItemResources(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions) + \"/resources\";\n    // Mix in num:1000 with any user supplied params\n    // Key thing - we don't want to mutate the passed in requestOptions\n    // as that may be used in other (subsequent) calls in the course\n    // of a long promise chains\n    var options = __assign({}, requestOptions);\n    options.params = __assign({ num: 1000 }, options.params);\n    return request(url, options);\n}\n/**\n * ```js\n * import { getItemResource } from \"@esri/arcgis-rest-portal\";\n *\n * // Parses contents as blob by default\n * getItemResource(\"3ef\", { fileName: \"resource.jpg\", ...})\n *  .then(resourceContents => {});\n *\n * // Can override parse method\n * getItemResource(\"3ef\", { fileName: \"resource.json\", readAs: 'json', ...})\n *  .then(resourceContents => {});\n *\n * // Get the response object instead\n * getItemResource(\"3ef\",{ rawResponse: true, fileName: \"resource.json\" })\n *  .then(response => {})\n * ```\n * Fetches an item resource and optionally parses it to the correct format.\n *\n * Note: provides JSON parse error protection by sanitizing out any unescaped control\n * characters before parsing that would otherwise cause an error to be thrown\n *\n * @param {string} itemId\n * @param {IGetItemResourceOptions} requestOptions\n */\nexport function getItemResource(itemId, requestOptions) {\n    var readAs = requestOptions.readAs || 'blob';\n    return getItemFile(itemId, \"/resources/\" + requestOptions.fileName, readAs, requestOptions);\n}\n/**\n * ```js\n * import { getItemGroups } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemGroups(\"30e5fe3149c34df1ba922e6f5bbf808f\")\n *   .then(response)\n * ```\n * Lists the groups of which the item is a part, only showing the groups that the calling user can access. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/groups.htm) for more information.\n *\n * @param id - The Id of the item to query group association for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item groups.\n */\nexport function getItemGroups(id, requestOptions) {\n    var url = getItemBaseUrl(id, requestOptions) + \"/groups\";\n    return request(url, requestOptions);\n}\n/**\n * ```js\n * import { getItemStatus } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemStatus({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Inquire about status when publishing an item, adding an item in async mode, or adding with a multipart upload. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/status.htm) for more information.\n *\n * @param id - The Id of the item to get status for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item status.\n */\nexport function getItemStatus(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/status\";\n        var options = appendCustomParams(requestOptions, [\"jobId\", \"jobType\"], { params: __assign({}, requestOptions.params) });\n        return request(url, options);\n    });\n}\n/**\n * ```js\n * import { getItemParts } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemParts({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Lists the part numbers of the file parts that have already been uploaded in a multipart file upload. This method can be used to verify the parts that have been received as well as those parts that were not received by the server. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/parts.htm) for more information.\n *\n * @param id - The Id of the item to get part list.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item part list.\n */\nexport function getItemParts(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/parts\";\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```\n * import { getItemInfo } from \"@esri/arcgis-rest-portal\";\n * // get the \"Info Card\" for the item\n * getItemInfo(\"ae7\")\n *   .then(itemInfoXml) // XML document as a string\n * // or get the contents of a specific file\n * getItemInfo(\"ae7\", { fileName: \"form.json\", readAs: \"json\", authentication })\n *   .then(formJson) // JSON document as JSON\n * ```\n * Get an info file for an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-info-file.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request, including the file name which defaults to `iteminfo.xml`.\n * If the file is not a text file (XML, HTML, etc) you will need to specify the `readAs` parameter\n * @returns A Promise that will resolve with the contents of the info file for the item.\n */\nexport function getItemInfo(id, requestOptions) {\n    var _a = requestOptions || {}, _b = _a.fileName, fileName = _b === void 0 ? \"iteminfo.xml\" : _b, _c = _a.readAs, readAs = _c === void 0 ? \"text\" : _c;\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return getItemFile(id, \"/info/\" + fileName, readAs, options);\n}\n/**\n * ```\n * import { getItemMetadata } from \"@esri/arcgis-rest-portal\";\n * // get the metadata for the item\n * getItemMetadata(\"ae7\")\n *   .then(itemMetadataXml) // XML document as a string\n * // or with additional request options\n * getItemMetadata(\"ae7\", { authentication })\n *   .then(itemMetadataXml) // XML document as a string\n * ```\n * Get the standard formal metadata XML file for an item (`/info/metadata/metadata.xml`)\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the contents of the metadata file for the item as a string.\n */\nexport function getItemMetadata(id, requestOptions) {\n    var options = __assign(__assign({}, requestOptions), { fileName: \"metadata/metadata.xml\" });\n    return getItemInfo(id, options);\n}\n// overrides request()'s default behavior for reading the response\n// which is based on `params.f` and defaults to JSON\n// Also adds JSON parse error protection by sanitizing out any unescaped control characters before parsing\nfunction getItemFile(id, \n// NOTE: fileName should include any folder/subfolders\nfileName, readMethod, requestOptions) {\n    var url = \"\" + getItemBaseUrl(id, requestOptions) + fileName;\n    // preserve escape hatch to let the consumer read the response\n    // and ensure the f param is not appended to the query string\n    var options = __assign({ params: {} }, requestOptions);\n    var justReturnResponse = options.rawResponse;\n    options.rawResponse = true;\n    options.params.f = null;\n    return request(url, options).then(function (response) {\n        if (justReturnResponse) {\n            return response;\n        }\n        return readMethod !== 'json'\n            ? response[readMethod]()\n            : response.text().then(function (text) { return JSON.parse(scrubControlChars(text)); });\n    });\n}\n//# sourceMappingURL=get.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { getGroup } from \"../groups/get\";\nexport function getSharingUrl(requestOptions) {\n    var username = requestOptions.authentication.username;\n    var owner = requestOptions.owner || username;\n    return getPortalUrl(requestOptions) + \"/content/users/\" + encodeURIComponent(owner) + \"/items/\" + requestOptions.id + \"/share\";\n}\nexport function isItemOwner(requestOptions) {\n    var username = requestOptions.authentication.username;\n    var owner = requestOptions.owner || username;\n    return owner === username;\n}\n/**\n * Check it the user is a full org_admin\n * @param requestOptions\n * @returns Promise resolving in a boolean indicating if the user is an ArcGIS Organization administrator\n */\nexport function isOrgAdmin(requestOptions) {\n    var session = requestOptions.authentication;\n    return session.getUser(requestOptions).then(function (user) {\n        return user && user.role === \"org_admin\" && !user.roleId;\n    });\n}\n/**\n * Get the User Membership for a particular group. Use this if all you have is the groupId.\n * If you have the group object, check the `userMembership.memberType` property instead of calling this method.\n *\n * @param requestOptions\n * @returns A Promise that resolves with \"owner\" | \"admin\" | \"member\" | \"nonmember\"\n */\nexport function getUserMembership(requestOptions) {\n    // fetch the group...\n    return getGroup(requestOptions.groupId, requestOptions)\n        .then(function (group) {\n        return group.userMembership.memberType;\n    })\n        .catch(function () {\n        return \"none\";\n    });\n}\n//# sourceMappingURL=helpers.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { getGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * getGroup(\"fxb988\") // id\n *   .then(response)\n * ```\n * Fetch a group using its id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group.htm) for more information.\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns  A Promise that will resolve with the data from the response.\n */\nexport function getGroup(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id;\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Gets the category schema set on a group\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns A promise that will resolve with JSON of group's category schema\n * @see https://developers.arcgis.com/rest/users-groups-and-items/group-category-schema.htm\n */\nexport function getGroupCategorySchema(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/categorySchema\";\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * Returns the content of a Group. Since the group may contain 1000s of items\n * the requestParams allow for paging.\n * @param id - Group Id\n * @param requestOptions  - Options for the request, including paging parameters.\n * @returns  A Promise that will resolve with the content of the group.\n */\nexport function getGroupContent(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/content/groups/\" + id;\n    // default to a GET request\n    var options = __assign(__assign({ httpMethod: \"GET\" }, { params: { start: 1, num: 100 } }), requestOptions);\n    // is this the most concise way to mixin with the defaults above?\n    if (requestOptions && requestOptions.paging) {\n        options.params = __assign({}, requestOptions.paging);\n    }\n    return request(url, options);\n}\n/**\n * Get the usernames of the admins and members. Does not return actual 'User' objects. Those must be\n * retrieved via separate calls to the User's API.\n * @param id - Group Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with arrays of the group admin usernames and the member usernames\n */\nexport function getGroupUsers(id, requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/users\";\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    return request(url, options);\n}\n/**\n * ```js\n * import { searchGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * searchGroupUsers('abc123')\n *   .then(response)\n * ```\n * Search the users in a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-users-list.htm) for more information.\n *\n * @param id - The group id\n * @param searchOptions - Options for the request, including paging parameters.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroupUsers(id, searchOptions) {\n    var url = getPortalUrl(searchOptions) + \"/community/groups/\" + id + \"/userlist\";\n    var options = appendCustomParams(searchOptions || {}, [\"name\", \"num\", \"start\", \"sortField\", \"sortOrder\", \"joined\", \"memberType\"], {\n        httpMethod: \"GET\"\n    });\n    return request(url, options);\n}\n//# sourceMappingURL=get.js.map","/* Copyright (c) 2018-2021 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { warn } from \"@esri/arcgis-rest-request\";\n/**\n * `SearchQueryBuilder` can be used to construct the `q` param for\n * [`searchItems`](/arcgis-rest-js/api/portal/searchItems#searchItems-search) or\n * [`searchGroups`](/arcgis-rest-js/api/portal/searchGroups#searchGroups-search).\n * By chaining methods, it helps build complex search queries.\n *\n * ```js\n * const startDate = new Date(\"2020-01-01\");\n * const endDate = new Date(\"2020-09-01\");\n * const query = new SearchQueryBuilder()\n *  .match(\"Patrick\")\n *  .in(\"owner\")\n *  .and()\n *  .from(startDate)\n *  .to(endDate)\n *  .in(\"created\")\n *  .and()\n *  .startGroup()\n *    .match(\"Web Mapping Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Mobile Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Application\")\n *    .in(\"type\")\n *  .endGroup()\n *  .and()\n *  .match(\"Demo App\");\n *\n * searchItems(query).then((res) => {\n *   console.log(res.results);\n * });\n * ```\n *\n * Will search for items matching\n * ```\n * \"owner: Patrick AND created:[1577836800000 TO 1598918400000] AND (type:\"Web Mapping Application\" OR type:\"Mobile Application\" OR type:Application) AND Demo App\"\n * ```\n */\nvar SearchQueryBuilder = /** @class */ (function () {\n    /**\n     * @param q An existing query string to start building from.\n     */\n    function SearchQueryBuilder(q) {\n        if (q === void 0) { q = \"\"; }\n        this.termStack = [];\n        this.rangeStack = [];\n        this.openGroups = 0;\n        this.q = q;\n    }\n    /**\n     * Defines strings to search for.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"My Layer\")\n     * ```\n     *\n     * @param terms strings to search for.\n     */\n    SearchQueryBuilder.prototype.match = function () {\n        var terms = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            terms[_i] = arguments[_i];\n        }\n        this.termStack = this.termStack.concat(terms);\n        return this;\n    };\n    /**\n     * Defines fields to search in. You can pass `\"*\"` or call this method without arguments to search a default set of fields\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"My Layer\")\n     *   .in(\"title\")\n     * ```\n     *\n     * @param field The field to search for the previous match in.\n     */\n    SearchQueryBuilder.prototype.in = function (field) {\n        var fn = \"`in(\" + (field ? \"\\\"\" + field + \"\\\"\" : \"\") + \")`\";\n        if (!this.hasRange && !this.hasTerms) {\n            warn(\n            // apparently-p-rettier-ignore causes some\n            fn + \" was called with no call to `match(...)` or `from(...)`/`to(...)`. Your query was not modified.\");\n            return this;\n        }\n        if (field && field !== \"*\") {\n            this.q += field + \":\";\n        }\n        return this.commit();\n    };\n    /**\n     * Starts a new search group.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .startGroup()\n     *     .match(\"Lakes\")\n     *     .in(\"title\")\n     *   .endGroup()\n     *   .or()\n     *   .startGroup()\n     *     .match(\"Rivers\")\n     *     .in(\"title\")\n     *   .endGroup()\n     * ```\n     */\n    SearchQueryBuilder.prototype.startGroup = function () {\n        this.commit();\n        if (this.openGroups > 0) {\n            this.q += \" \";\n        }\n        this.openGroups++;\n        this.q += \"(\";\n        return this;\n    };\n    /**\n     * Ends a search group.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .startGroup()\n     *     .match(\"Lakes\")\n     *     .in(\"title\")\n     *   .endGroup()\n     *   .or()\n     *   .startGroup()\n     *     .match(\"Rivers\")\n     *     .in(\"title\")\n     *   .endGroup()\n     * ```\n     */\n    SearchQueryBuilder.prototype.endGroup = function () {\n        if (this.openGroups <= 0) {\n            warn(\"`endGroup(...)` was called without calling `startGroup(...)` first. Your query was not modified.\");\n            return this;\n        }\n        this.commit();\n        this.openGroups--;\n        this.q += \")\";\n        return this;\n    };\n    /**\n     * Joins two sets of queries with an `AND` clause.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .and()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.and = function () {\n        return this.addModifier(\"and\");\n    };\n    /**\n     * Joins two sets of queries with an `OR` clause.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .or()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.or = function () {\n        return this.addModifier(\"or\");\n    };\n    /**\n     * Joins two sets of queries with a `NOT` clause. Another option for filtering results is the [prohibit operator '-'](https://developers.arcgis.com/rest/users-groups-and-items/search-reference.htm#ESRI_SECTION1_5C6C35DB9E4A4F4492C5B937BDA2BF67).\n     *\n     * ```js\n     * // omit results with \"Rivers\" in their title\n     * const query = new SearchQueryBuilder()\n     *   .not()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     *\n     * // equivalent\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Rivers\")\n     *   .in(\"-title\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.not = function () {\n        return this.addModifier(\"not\");\n    };\n    /**\n     * Begins a new range query.\n     *\n     * ```js\n     *\n     * const NEWYEARS = new Date(\"2020-01-01\")\n     * const TODAY = new Date()\n     *\n     * const query = new SearchQueryBuilder()\n     *   .from(NEWYEARS)\n     *   .to(TODAY)\n     *   .in(\"created\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.from = function (term) {\n        if (this.hasTerms) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"`from(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date(\\\"2020-01-01\\\").  Your query was not modified.\");\n            return this;\n        }\n        this.rangeStack[0] = term;\n        return this;\n    };\n    /**\n     * Ends a range query.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .from(yesterdaysDate)\n     *   .to(todaysDate)\n     *   .in(\"created\")\n     * ```\n     */\n    SearchQueryBuilder.prototype.to = function (term) {\n        if (this.hasTerms) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"`to(...)` is not allowed after `match(...)` try using `.from(...).to(...).in(...)`. Optionally, you may see this because dates are incorrectly formatted. Dates should be a primative Date value, aka a number in milliseconds or Date object, ie new Date(\\\"2020-01-01\\\"). Your query was not modified.\");\n            return this;\n        }\n        this.rangeStack[1] = term;\n        return this;\n    };\n    /**\n     * Boosts the previous term to increase its rank in the results.\n     *\n     * ```js\n     * const query = new SearchQueryBuilder()\n     *   .match(\"Lakes\")\n     *   .in(\"title\")\n     *   .or()\n     *   .match(\"Rivers\")\n     *   .in(\"title\")\n     *   .boost(3)\n     * ```\n     */\n    SearchQueryBuilder.prototype.boost = function (num) {\n        this.commit();\n        this.q += \"^\" + num;\n        return this;\n    };\n    /**\n     * Returns the current query string. Called internally when the request is made.\n     */\n    SearchQueryBuilder.prototype.toParam = function () {\n        this.commit();\n        this.cleanup();\n        return this.q;\n    };\n    /**\n     * Returns a new instance of `SearchQueryBuilder` based on the current instance.\n     */\n    SearchQueryBuilder.prototype.clone = function () {\n        this.commit();\n        this.cleanup();\n        return new SearchQueryBuilder(this.q + \"\");\n    };\n    SearchQueryBuilder.prototype.addModifier = function (modifier) {\n        if (this.currentModifer) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"You have called `\" + this.currentModifer + \"()` after `\" + modifier + \"()`. Your current query was not modified.\");\n            return this;\n        }\n        this.commit();\n        if (this.q === \"\" && modifier !== \"not\") {\n            warn(\"You have called `\" + modifier + \"()` without calling another method to modify your query first. Try calling `match()` first.\");\n            return this;\n        }\n        this.currentModifer = modifier;\n        this.q += this.q === \"\" ? \"\" : \" \";\n        this.q += modifier.toUpperCase() + \" \";\n        return this;\n    };\n    SearchQueryBuilder.prototype.needsQuotes = function (s) {\n        return /\\s|:/g.test(s);\n    };\n    SearchQueryBuilder.prototype.formatTerm = function (term) {\n        if (term instanceof Date) {\n            return term.getTime();\n        }\n        if (typeof term === \"string\" && this.needsQuotes(term)) {\n            return \"\\\"\" + term + \"\\\"\";\n        }\n        return term;\n    };\n    SearchQueryBuilder.prototype.commit = function () {\n        var _this = this;\n        this.currentModifer = undefined;\n        if (this.hasRange) {\n            this.q += \"[\" + this.formatTerm(this.rangeStack[0]) + \" TO \" + this.formatTerm(this.rangeStack[1]) + \"]\";\n            this.rangeStack = [undefined, undefined];\n        }\n        if (this.hasTerms) {\n            this.q += this.termStack\n                .map(function (term) {\n                return _this.formatTerm(term);\n            })\n                .join(\" \");\n            this.termStack = [];\n        }\n        return this;\n    };\n    Object.defineProperty(SearchQueryBuilder.prototype, \"hasTerms\", {\n        get: function () {\n            return this.termStack.length > 0;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(SearchQueryBuilder.prototype, \"hasRange\", {\n        get: function () {\n            return this.rangeStack.length && this.rangeStack[0] && this.rangeStack[1];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    SearchQueryBuilder.prototype.cleanup = function () {\n        // end a group if we have started one\n        if (this.openGroups > 0) {\n            warn(\n            // apparently-p*rettier-ignore causes prettier to strip *all* comments O_o\n            \"Automatically closing \" + this.openGroups + \" group(s). You can use `endGroup(...)` to remove this warning.\");\n            while (this.openGroups > 0) {\n                this.q += \")\";\n                this.openGroups--;\n            }\n        }\n        var oldQ = this.q;\n        this.q = oldQ.replace(/( AND ?| NOT ?| OR ?)*$/, \"\");\n        if (oldQ !== this.q) {\n            warn(\"`startGroup(...)` was called without calling `endGroup(...)` first. Your query was not modified.\");\n        }\n        // clear empty groups\n        this.q = this.q.replace(/(\\(\\))*/, \"\");\n    };\n    return SearchQueryBuilder;\n}());\nexport { SearchQueryBuilder };\n//# sourceMappingURL=SearchQueryBuilder.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, appendCustomParams, } from \"@esri/arcgis-rest-request\";\nimport { SearchQueryBuilder } from \"./SearchQueryBuilder\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nexport function genericSearch(search, searchType) {\n    var options;\n    if (typeof search === \"string\" || search instanceof SearchQueryBuilder) {\n        options = {\n            httpMethod: \"GET\",\n            params: {\n                q: search,\n            },\n        };\n    }\n    else {\n        // searchUserAccess has one (knonw) valid value: \"groupMember\"\n        options = appendCustomParams(search, [\n            \"q\",\n            \"num\",\n            \"start\",\n            \"sortField\",\n            \"sortOrder\",\n            \"searchUserAccess\",\n            \"searchUserName\",\n            \"filter\",\n            \"countFields\",\n            \"countSize\",\n            \"categories\",\n            \"categoryFilters\",\n        ], {\n            httpMethod: \"GET\",\n        });\n    }\n    var path;\n    switch (searchType) {\n        case \"item\":\n            path = \"/search\";\n            break;\n        case \"group\":\n            path = \"/community/groups\";\n            break;\n        case \"groupContent\":\n            // Need to have groupId property to do group contents search,\n            // cso filter out all but ISearchGroupContentOptions\n            if (typeof search !== \"string\" &&\n                !(search instanceof SearchQueryBuilder) &&\n                search.groupId) {\n                path = \"/content/groups/\" + search.groupId + \"/search\";\n            }\n            else {\n                return Promise.reject(new Error(\"you must pass a `groupId` option to `searchGroupContent`\"));\n            }\n            break;\n        default:\n            // \"users\"\n            path = \"/portals/self/users/search\";\n            break;\n    }\n    var url = getPortalUrl(options) + path;\n    // send the request\n    return request(url, options).then(function (r) {\n        if (r.nextStart && r.nextStart !== -1) {\n            r.nextPage = function () {\n                var newOptions;\n                if (typeof search === \"string\" ||\n                    search instanceof SearchQueryBuilder) {\n                    newOptions = {\n                        q: search,\n                        start: r.nextStart,\n                    };\n                }\n                else {\n                    newOptions = search;\n                    newOptions.start = r.nextStart;\n                }\n                return genericSearch(newOptions, searchType);\n            };\n        }\n        return r;\n    });\n}\n//# sourceMappingURL=generic-search.js.map","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { genericSearch } from \"../util/generic-search\";\n/**\n * ```js\n * import { searchItems } from \"@esri/arcgis-rest-portal\";\n * //\n * searchItems('water')\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/search.htm) for more information.\n *\n * @param search - A string or RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchItems(search) {\n    return genericSearch(search, \"item\");\n}\n//# sourceMappingURL=search.js.map","/* Copyright (c) 2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nexport function chunk(array, size) {\n    if (array.length === 0) {\n        return [];\n    }\n    var chunks = [];\n    for (var i = 0; i < array.length; i += size) {\n        chunks.push(array.slice(i, i + size));\n    }\n    return chunks;\n}\n//# sourceMappingURL=array.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign, __spreadArrays } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n/**\n * ```js\n * import { addGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * addGroupUsers({\n *   id: groupId,\n *   users: [\"username1\", \"username2\"],\n *   admins: [\"username3\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Add users to a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-users-to-group.htm) for more information.\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function addGroupUsers(requestOptions) {\n    var id = requestOptions.id;\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/addUsers\";\n    var baseOptions = Object.assign({}, requestOptions, {\n        admins: undefined,\n        users: undefined\n    });\n    var batchRequestOptions = __spreadArrays(_prepareRequests(\"users\", requestOptions.users, baseOptions), _prepareRequests(\"admins\", requestOptions.admins, baseOptions));\n    var promises = batchRequestOptions.map(function (options) {\n        return _sendSafeRequest(url, options);\n    });\n    return Promise.all(promises).then(_consolidateRequestResults);\n}\nfunction _prepareRequests(type, usernames, baseOptions) {\n    if (!usernames || usernames.length < 1) {\n        return [];\n    }\n    // the ArcGIS REST API only allows to add no more than 25 users per request,\n    // see https://developers.arcgis.com/rest/users-groups-and-items/add-users-to-group.htm\n    var userChunks = chunk(usernames, 25);\n    return userChunks.map(function (users) {\n        return _generateRequestOptions(type, users, baseOptions);\n    });\n}\nfunction _generateRequestOptions(type, usernames, baseOptions) {\n    var _a, _b;\n    return Object.assign({}, baseOptions, (_a = {},\n        _a[type] = usernames,\n        _a.params = __assign(__assign({}, baseOptions.params), (_b = {}, _b[type] = usernames, _b)),\n        _a));\n}\n// this request is safe since the request error will be handled\nfunction _sendSafeRequest(url, requestOptions) {\n    return request(url, requestOptions).catch(function (error) {\n        return {\n            errors: [error]\n        };\n    });\n}\nfunction _consolidateRequestResults(results) {\n    var notAdded = results\n        .filter(function (result) { return result.notAdded; })\n        .reduce(function (collection, result) { return collection.concat(result.notAdded); }, []);\n    var errors = results\n        .filter(function (result) { return result.errors; })\n        .reduce(function (collection, result) { return collection.concat(result.errors); }, []);\n    var consolidated = { notAdded: notAdded };\n    if (errors.length > 0) {\n        consolidated.errors = errors;\n    }\n    return consolidated;\n}\n//# sourceMappingURL=add-users.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n/**\n * ```js\n * import { removeGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * removeGroupUsers({\n *   id: groupId,\n *   users: [\"username1\", \"username2\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Add users to a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/remove-users-from-group.htm) for more information.\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function removeGroupUsers(requestOptions) {\n    var id = requestOptions.id, usersToRemove = requestOptions.users;\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + id + \"/removeUsers\";\n    var safeSend = function (users) {\n        var options = __assign(__assign({}, requestOptions), { users: users, params: { users: users } });\n        return request(url, options)\n            .catch(function (error) { return ({ errors: [error] }); });\n    };\n    // the ArcGIS REST API only allows to add no more than 25 users per request,\n    // see https://developers.arcgis.com/rest/users-groups-and-items/remove-users-from-group.htm\n    var promises = chunk(usersToRemove, 25).map(function (usersChunk) { return safeSend(usersChunk); });\n    return Promise.all(promises)\n        .then(function (results) {\n        var filtered = function (propName) { return results\n            .filter(function (result) { return result[propName]; })\n            .reduce(function (collection, result) { return collection.concat(result[propName]); }, []); };\n        var errors = filtered('errors');\n        var consolidated = { notRemoved: filtered('notRemoved') };\n        return errors.length ? __assign(__assign({}, consolidated), { errors: errors }) : consolidated;\n    });\n}\n//# sourceMappingURL=remove-users.js.map","import { getPortalUrl } from \"../util/get-portal-url\";\nimport { request } from \"@esri/arcgis-rest-request\";\n/**\n * ```js\n * import { updateUserMemberships } from \"@esri/arcgis-rest-portal\";\n * //\n * updateUserMemberships({\n *   id: groupId,\n *   admins: [\"username3\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Change the user membership levels of existing users in a group\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function updateUserMemberships(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.id + \"/updateUsers\";\n    var opts = {\n        authentication: requestOptions.authentication,\n        params: {}\n    };\n    // add the correct params depending on the type of membership we are changing to\n    if (requestOptions.newMemberType === \"admin\") {\n        opts.params.admins = requestOptions.users;\n    }\n    else {\n        opts.params.users = requestOptions.users;\n    }\n    // make the request\n    return request(url, opts);\n}\n//# sourceMappingURL=update-user-membership.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { getUser } from '@esri/arcgis-rest-portal';\n * //\n * getUser(\"jsmith\")\n *   .then(response)\n * // => { firstName: \"John\", lastName: \"Smith\",tags: [\"GIS Analyst\", \"City of Redlands\"] }\n * ```\n * Get information about a user. This method has proven so generically useful that you can also call [`UserSession.getUser()`](/arcgis-rest-js/api/auth/UserSession#getUser-summary).\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with metadata about the user\n */\nexport function getUser(requestOptions) {\n    var url;\n    var options = { httpMethod: \"GET\" };\n    // if a username is passed, assume ArcGIS Online\n    if (typeof requestOptions === \"string\") {\n        url = \"https://www.arcgis.com/sharing/rest/community/users/\" + requestOptions;\n    }\n    else {\n        // if an authenticated session is passed, default to that user/portal unless another username is provided manually\n        var username = requestOptions.username || requestOptions.authentication.username;\n        url = getPortalUrl(requestOptions) + \"/community/users/\" + encodeURIComponent(username);\n        options = __assign(__assign({}, requestOptions), options);\n    }\n    // send the request\n    return request(url, options);\n}\n//# sourceMappingURL=get-user.js.map","/* Copyright (c) 2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * Helper that returns the [user](https://developers.arcgis.com/rest/users-groups-and-items/user.htm) for a given portal.\n *\n * @param session\n * @returns User url to be used in API requests.\n */\nexport function getUserUrl(session) {\n    return getPortalUrl(session) + \"/community/users/\" + encodeURIComponent(session.username);\n}\n//# sourceMappingURL=get-user-url.js.map","import { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { getUserMembership, } from \"./helpers\";\nimport { getUser } from \"../users/get-user\";\nimport { addGroupUsers } from \"../groups/add-users\";\nimport { removeGroupUsers } from \"../groups/remove-users\";\nimport { updateUserMemberships, } from \"../groups/update-user-membership\";\nimport { isItemSharedWithGroup } from \"../sharing/is-item-shared-with-group\";\n/**\n * ```js\n * import { shareItemWithGroup } from '@esri/arcgis-rest-portal';\n * //\n * shareItemWithGroup({\n *   id: \"abc123\",\n *   groupId: \"xyz987\",\n *   owner: \"some-owner\",\n *   authentication\n * })\n * ```\n * Share an item with a group, either as an\n * [item owner](https://developers.arcgis.com/rest/users-groups-and-items/share-item-as-item-owner-.htm),\n * [group admin](https://developers.arcgis.com/rest/users-groups-and-items/share-item-as-group-admin-.htm) or\n * organization admin.\n *\n * Note: Sharing the item as an Admin will use the `/content/users/:ownername/items/:itemid/share` end-point\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function shareItemWithGroup(requestOptions) {\n    return isItemSharedWithGroup(requestOptions)\n        .then(function (isShared) {\n        if (isShared) {\n            // already shared, exit early with success response\n            return {\n                itemId: requestOptions.id,\n                shortcut: true,\n                notSharedWith: [],\n            };\n        }\n        var username = requestOptions.authentication.username, owner = requestOptions.owner, confirmItemControl = requestOptions.confirmItemControl;\n        var itemOwner = owner || username;\n        // non-item owner\n        if (itemOwner !== username) {\n            // need to track if the user is an admin\n            var isAdmin_1 = false;\n            // track if the admin & owner are in the same org\n            var isCrossOrgSharing_1 = false;\n            // next perform any necessary membership adjustments for\n            // current user and/or item owner\n            return Promise.all([\n                getUser({\n                    username: username,\n                    authentication: requestOptions.authentication,\n                }),\n                getUser({\n                    username: itemOwner,\n                    authentication: requestOptions.authentication,\n                }),\n                getUserMembership(requestOptions),\n            ])\n                .then(function (_a) {\n                var currentUser = _a[0], ownerUser = _a[1], membership = _a[2];\n                var isSharedEditingGroup = !!confirmItemControl;\n                isAdmin_1 = currentUser.role === \"org_admin\" && !currentUser.roleId;\n                isCrossOrgSharing_1 = currentUser.orgId !== ownerUser.orgId;\n                return getMembershipAdjustments(currentUser, isSharedEditingGroup, membership, isAdmin_1, ownerUser, requestOptions);\n            })\n                .then(function (membershipAdjustments) {\n                var _a = membershipAdjustments[0], revert = (_a === void 0 ? {\n                    promise: Promise.resolve({ notAdded: [] }),\n                    revert: function (sharingResults) {\n                        return Promise.resolve(sharingResults);\n                    },\n                } : _a).revert;\n                // perform all membership adjustments\n                return Promise.all(membershipAdjustments.map(function (_a) {\n                    var promise = _a.promise;\n                    return promise;\n                }))\n                    .then(function () {\n                    // then attempt the share\n                    return shareToGroup(requestOptions, isAdmin_1, isCrossOrgSharing_1);\n                })\n                    .then(function (sharingResults) {\n                    // lastly, if the admin user was added to the group,\n                    // remove them from the group. this is a no-op that\n                    // immediately resolves the sharingResults when no\n                    // membership adjustment was needed\n                    return revert(sharingResults);\n                });\n            });\n        }\n        // item owner, let it call through\n        return shareToGroup(requestOptions);\n    })\n        .then(function (sharingResponse) {\n        if (sharingResponse.notSharedWith.length) {\n            throw Error(\"Item \" + requestOptions.id + \" could not be shared to group \" + requestOptions.groupId + \".\");\n        }\n        else {\n            // all is well\n            return sharingResponse;\n        }\n    });\n}\nfunction getMembershipAdjustments(currentUser, isSharedEditingGroup, membership, isAdmin, ownerUser, requestOptions) {\n    var membershipGuarantees = [];\n    if (requestOptions.groupId !== currentUser.favGroupId) {\n        if (isSharedEditingGroup) {\n            if (!isAdmin) {\n                // abort and reject promise\n                throw Error(\"This item can not be shared to shared editing group \" + requestOptions.groupId + \" by \" + currentUser.username + \" as they not the item owner or org admin.\");\n            }\n            membershipGuarantees.push(\n            // admin user must be a group member to share, should be reverted afterwards\n            ensureMembership(currentUser, currentUser, false, \"Error adding \" + currentUser.username + \" as member to edit group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\", requestOptions), \n            // item owner must be a group admin\n            ensureMembership(currentUser, ownerUser, true, membership === \"none\"\n                ? \"Error adding user \" + ownerUser.username + \" to edit group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\"\n                : \"Error promoting user \" + ownerUser.username + \" to admin in edit group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\", requestOptions));\n        }\n        else if (isAdmin) {\n            // admin user must be a group member to share, should be reverted afterwards\n            membershipGuarantees.push(ensureMembership(currentUser, currentUser, false, \"Error adding \" + currentUser.username + \" as member to view group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" was not shared to the group.\", requestOptions));\n        }\n        else if (membership === \"none\") {\n            // all other non-item owners must be a group member\n            throw new Error(\"This item can not be shared by \" + currentUser.username + \" as they are not a member of the specified group \" + requestOptions.groupId + \".\");\n        }\n    }\n    return membershipGuarantees;\n}\nfunction shareToGroup(requestOptions, isAdmin, isCrossOrgSharing) {\n    if (isAdmin === void 0) { isAdmin = false; }\n    if (isCrossOrgSharing === void 0) { isCrossOrgSharing = false; }\n    var username = requestOptions.authentication.username;\n    var itemOwner = requestOptions.owner || username;\n    // decide what url to use\n    // default to the non-owner url...\n    var url = getPortalUrl(requestOptions) + \"/content/items/\" + requestOptions.id + \"/share\";\n    // but if they are the owner, or org_admin, use this route\n    // Note: When using this end-point as an admin, apparently the admin does not need to be a member of the group (the itemOwner does)\n    // Note: Admin's can only use this route when the item is in the same org they are admin for\n    if (itemOwner === username || (isAdmin && !isCrossOrgSharing)) {\n        url = getPortalUrl(requestOptions) + \"/content/users/\" + itemOwner + \"/items/\" + requestOptions.id + \"/share\";\n    }\n    // now its finally time to do the sharing\n    requestOptions.params = {\n        groups: requestOptions.groupId,\n        confirmItemControl: requestOptions.confirmItemControl,\n    };\n    return request(url, requestOptions);\n}\nexport function ensureMembership(currentUser, ownerUser, shouldPromote, errorMessage, requestOptions) {\n    var _a;\n    var ownerGroups = ownerUser.groups || [];\n    var group = ownerGroups.find(function (g) {\n        return g.id === requestOptions.groupId;\n    });\n    // if they are in different orgs, eject\n    if (currentUser.orgId !== ownerUser.orgId) {\n        throw Error(\"User \" + ownerUser.username + \" is not a member of the same org as \" + currentUser.username + \". Consequently they can not be added added to group \" + requestOptions.groupId + \" nor can item \" + requestOptions.id + \" be shared to the group.\");\n    }\n    // if owner is not a member, and has 512 groups\n    if (!group && ownerGroups.length > 511) {\n        throw Error(\"User \" + ownerUser.username + \" already has 512 groups, and can not be added to group \" + requestOptions.groupId + \". Consequently item \" + requestOptions.id + \" can not be shared to the group.\");\n    }\n    var promise;\n    var revert;\n    // decide if we need to add them or upgrade them\n    if (group) {\n        // they are in the group...\n        // check member type\n        if (shouldPromote && group.userMembership.memberType === \"member\") {\n            // promote them\n            promise = updateUserMemberships({\n                id: requestOptions.groupId,\n                users: [ownerUser.username],\n                newMemberType: \"admin\",\n                authentication: requestOptions.authentication,\n            })\n                .then(function (results) {\n                // convert the result into the right type\n                var notAdded = results.results.reduce(function (acc, entry) {\n                    if (!entry.success) {\n                        acc.push(entry.username);\n                    }\n                    return acc;\n                }, []);\n                // and return it\n                return Promise.resolve({ notAdded: notAdded });\n            })\n                .catch(function () { return ({ notAdded: [ownerUser.username] }); });\n            revert = function (sharingResults) {\n                return updateUserMemberships({\n                    id: requestOptions.groupId,\n                    users: [ownerUser.username],\n                    newMemberType: \"member\",\n                    authentication: requestOptions.authentication,\n                })\n                    .then(function () { return sharingResults; })\n                    .catch(function () { return sharingResults; });\n            };\n        }\n        else {\n            // they are already an admin in the group\n            // return the same response the API would if we added them\n            promise = Promise.resolve({ notAdded: [] });\n            revert = function (sharingResults) { return Promise.resolve(sharingResults); };\n        }\n    }\n    else {\n        // attempt to add user to group\n        var userType = shouldPromote ? \"admins\" : \"users\";\n        // can't currently determine if the group is within the admin's\n        // org without performing a search, so attempt to add and handle\n        // the api error\n        promise = addGroupUsers((_a = {\n                id: requestOptions.groupId\n            },\n            _a[userType] = [ownerUser.username],\n            _a.authentication = requestOptions.authentication,\n            _a))\n            .then(function (results) {\n            // results.errors includes an ArcGISAuthError when the group\n            // is in a different org, but notAdded is empty, throw here\n            // to normalize the results in below catch\n            if (results.errors && results.errors.length) {\n                throw results.errors[0];\n            }\n            return results;\n        })\n            .catch(function () { return ({ notAdded: [ownerUser.username] }); });\n        revert = function (sharingResults) {\n            return removeGroupUsers({\n                id: requestOptions.groupId,\n                users: [ownerUser.username],\n                authentication: requestOptions.authentication,\n            }).then(function () {\n                // always resolves, suppress any resolved errors\n                return sharingResults;\n            });\n        };\n    }\n    return {\n        promise: promise.then(function (membershipResponse) {\n            if (membershipResponse.notAdded.length) {\n                throw new Error(errorMessage);\n            }\n            return membershipResponse;\n        }),\n        revert: revert,\n    };\n}\n//# sourceMappingURL=share-item-with-group.js.map","import { searchItems } from \"../items/search\";\n/**\n * ```js\n * import { isItemSharedWithGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * isItemSharedWithGroup({\n *   groupId: 'bc3,\n *   itemId: 'f56,\n *   authentication\n * })\n * .then(isShared => {})\n * ```\n * Find out whether or not an item is already shared with a group.\n *\n * @param requestOptions - Options for the request. NOTE: `rawResponse` is not supported by this operation.\n * @returns Promise that will resolve with true/false\n */\nexport function isItemSharedWithGroup(requestOptions) {\n    var searchOpts = {\n        q: \"id: \" + requestOptions.id + \" AND group: \" + requestOptions.groupId,\n        start: 1,\n        num: 10,\n        sortField: \"title\",\n        authentication: requestOptions.authentication,\n        httpMethod: \"POST\"\n    };\n    return searchItems(searchOpts).then(function (searchResponse) {\n        var result = false;\n        if (searchResponse.total > 0) {\n            result = searchResponse.results.some(function (itm) {\n                return itm.id === requestOptions.id;\n            });\n            return result;\n        }\n    });\n}\n//# sourceMappingURL=is-item-shared-with-group.js.map","/* Copyright (c) 2017-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"./get-portal-url\";\n/**\n * Get the portal\n * @param requestOptions\n */\nexport function getSelf(requestOptions) {\n    // just delegate to getPortal w/o an id\n    return getPortal(null, requestOptions);\n}\n/**\n * ```js\n * import { getPortal } from \"@esri/arcgis-rest-request\";\n * //\n * getPortal()\n * getPortal(\"fe8\")\n * getPortal(null, { portal: \"https://custom.maps.arcgis.com/sharing/rest/\" })\n * ```\n * Fetch information about the specified portal by id. If no id is passed, portals/self will be called.\n * Note that if you intend to request a portal by id and it is different from the portal specified by options.authentication, you must also pass options.portal.\n * @param id\n * @param requestOptions\n */\nexport function getPortal(id, requestOptions) {\n    // construct the search url\n    var idOrSelf = id ? id : \"self\";\n    var url = getPortalUrl(requestOptions) + \"/portals/\" + idOrSelf;\n    // default to a GET request\n    var options = __assign({ httpMethod: \"GET\" }, requestOptions);\n    // send the request\n    return request(url, options);\n}\n//# sourceMappingURL=get-portal.js.map","import { __assign } from \"tslib\";\nimport { cloneObject } from \"@esri/hub-common\";\nimport geometryService from \"./geometry\";\nimport { createItem, updateItem } from \"@esri/arcgis-rest-portal\";\n/**\n * Save an IModel. Generic function that will be used across all\n * type-specific save functions\n *\n * @export\n * @param {IModel} \"model\" object (i.e. `{item:{...}, data:{...}}`)\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<IModel>}\n */\nexport function saveModel(model, requestOptions) {\n    var clone = cloneObject(model);\n    var opts = createRequestOptions(clone, requestOptions);\n    return createItem(opts).then(function (response) {\n        clone.item.id = response.id;\n        return clone;\n    });\n}\n/**\n * Update an IModel. Generic function that will be used across all\n * type-specific update functions\n *\n * @export\n * @param {IModel} \"model\" object (i.e. `{item:{...}, data:{...}}`)\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<IModel>}\n */\nexport function updateModel(model, requestOptions) {\n    var clone = cloneObject(model);\n    var opts = createRequestOptions(clone, requestOptions);\n    return updateItem(opts).then(function () {\n        // return a new ref to the model that was passed in...\n        return clone;\n    });\n}\n/**\n * Centralize the serialization of an IModel into an object\n * that we can send to the Item methods\n *\n * @param {IModel} model\n * @param {IRequestOptions} requestOptions\n * @returns {*}\n */\nfunction createRequestOptions(model, requestOptions) {\n    // construct an object to send to the API\n    var item = cloneObject(model.item);\n    item.data = cloneObject(model.data);\n    // create the options...\n    var opts = __assign({ item: item }, requestOptions);\n    return opts;\n}\n/**\n * Given an extent, project it and return a BBOX lat/long string, which is the format\n * required when creating an item.\n * @param orgExtent Extent to project\n * @param portal\n * @returns {Promise<any>} Promise that will resolve with a bbox string (W,S,E,N)\n */\nexport function getProjectedExtentAsBBOXString(options, requestOptions) {\n    var url = geometryService.getUrl(options.portal);\n    return geometryService\n        .project(url, options.extent.spatialReference.wkid, 4326, \"esriGeometryEnvelope\", [options.extent], requestOptions)\n        .then(function (response) {\n        var ext4326 = response.geometries[0];\n        return (ext4326.xmin +\n            \",\" +\n            ext4326.ymin +\n            \",\" +\n            ext4326.xmax +\n            \",\" +\n            ext4326.ymax);\n    });\n}\n//# sourceMappingURL=model.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { saveModel } from \"./model\";\nimport { getHubApiUrl } from \"@esri/hub-common\";\nexport var INITIATIVE_TYPE_NAME = \"Hub Initiative\";\n/**\n * Save an Initiative model. If the model does not have an item.id\n * we will create a new item. Otherwise we update the existing item.\n * Returns the same model instance, with the item.id assigned;\n *\n * @export\n * @param {IInitiativeModel} model\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<IInitiativeModel>}\n */\nexport function addInitiative(model, requestOptions) {\n    // delegate to model to do the save...\n    return saveModel(model, requestOptions);\n}\n/**\n * Generate the default url for an Initiative - which is the route to the\n * initiative in the admin app\n *\n * @export\n * @param {string} itemId\n * @param {IRequestOptions} requestOptions\n * @returns {string} Url to the initiative in the admin app\n */\nexport function getInitiativeUrl(itemId, requestOptions) {\n    return getHubApiUrl(requestOptions) + \"/admin/initiatives/\" + itemId;\n}\n//# sourceMappingURL=add.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getProp, cloneObject } from \"@esri/hub-common\";\n/**\n * Apply the 1.0 --> 1.1 Migration to an Initiative Model\n *\n * @param model\n * @param portalUrl\n * @protected\n */\nexport function upgradeToOneDotOne(model, portalUrl) {\n    var curVersion = getProp(model, \"item.properties.schemaVersion\");\n    if (curVersion < 1.1) {\n        var clone = cloneObject(model);\n        // store the schemaVersion\n        clone.item.properties.schemaVersion = 1.1;\n        // add the assets...\n        addDefaultResources(clone, portalUrl);\n        if (!clone.data.values.bannerImage) {\n            clone.data.values.bannerImage = {\n                source: \"bannerImage\",\n                display: {\n                    position: { x: \"50%\", y: \"10%\" }\n                }\n            };\n        }\n        return clone;\n    }\n    else {\n        // console.debug(`Not upgrading CurVersion: ${curVersion}`);\n        return model;\n    }\n}\n/**\n * As part of the 1.1 migration, we add a set of default image\n * resources into the hash.\n *\n * @protected\n * @param {IInitiativeModel} model\n * @param {string} [portalUrl]\n * @returns {IInitiativeModel}\n */\nexport function addDefaultResources(model, portalUrl) {\n    if (!model.data.assets) {\n        model.data.assets = [\n            {\n                id: \"bannerImage\",\n                url: getResourceUrl(model.item.id, \"detail-image.jpg\", portalUrl),\n                properties: {\n                    type: \"resource\",\n                    fileName: \"detail-image.jpg\",\n                    mimeType: \"image/jepg\"\n                },\n                license: {\n                    type: \"none\"\n                }\n            },\n            {\n                id: \"iconDark\",\n                url: getResourceUrl(model.item.id, \"icon-dark.png\", portalUrl),\n                properties: {\n                    type: \"resource\",\n                    fileName: \"icon-dark.png\",\n                    mimeType: \"image/png\"\n                },\n                license: {\n                    type: \"none\"\n                }\n            },\n            {\n                id: \"iconLight\",\n                url: getResourceUrl(model.item.id, \"icon-light.png\", portalUrl),\n                properties: {\n                    type: \"resource\",\n                    fileName: \"icon-light.png\",\n                    mimeType: \"image/png\"\n                },\n                license: {\n                    type: \"none\"\n                }\n            }\n        ];\n    }\n    return model;\n}\n/**\n * Construct the url for a resource. This is specific to the migration otherwise\n * if would be hoised into a more generic module\n *\n * @protected\n * @param {string} itemId\n * @param {string} resourceName\n * @param {string} [portal]\n * @param {string} [folder]\n * @returns {string}\n */\nexport function getResourceUrl(itemId, resourceName, portal, folder) {\n    // default to www.arcgis.com\n    var portalUrl = portal || \"https://www.arcgis.com/sharing/rest\";\n    var url = portalUrl + \"/content/items/\" + itemId + \"/resources\";\n    if (folder) {\n        url = url + \"/\" + folder + \"/\" + resourceName;\n    }\n    else {\n        url = url + \"/\" + resourceName;\n    }\n    return url;\n}\n//# sourceMappingURL=upgrade-one-dot-one.js.map","import { __spreadArrays } from \"tslib\";\n/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getProp, cloneObject } from \"@esri/hub-common\";\n/**\n * Given an object, conduct checks to see if it is an indicator\n * @protected\n */\nexport var isIndicator = function (obj) {\n    var result = false;\n    if (Array.isArray(obj.fields) && obj.fields.length > 0) {\n        result = true;\n    }\n    return result;\n};\n/**\n * Convert the CAS formatted \"field\" into the new schema\n * @protected\n */\nexport var convertIndicatorField = function (field) {\n    return {\n        id: field.fieldName,\n        name: field.label,\n        optional: field.optional || false,\n        description: field.tooltip,\n        supportedTypes: __spreadArrays(field.supportedTypes)\n    };\n};\n/**\n * Convert a CAS formatted indicator to the .definition in the new schama\n * @protected\n */\nexport var convertIndicatorToDefinition = function (ind) {\n    var def = {\n        id: ind.fieldName,\n        type: \"Data\",\n        name: ind.label || ind.fieldName,\n        optional: ind.optional || false,\n        definition: {\n            description: ind.label || ind.fieldName,\n            supportedTypes: __spreadArrays(ind.layerOptions.supportedTypes),\n            geometryTypes: __spreadArrays(ind.layerOptions.geometryTypes),\n            fields: ind.fields.map(convertIndicatorField)\n        }\n    };\n    return def;\n};\n/**\n * Given the Indicators entry from a CAS configurationSettings array,\n * convert to an indicators object in the new schema\n * @protected\n */\nexport function convertIndicatorsToDefinitions(indicatorsHash) {\n    // the incoming structure should have a .fields property, and what we want will be in there...\n    if (!indicatorsHash.fields || !Array.isArray(indicatorsHash.fields)) {\n        indicatorsHash.fields = [];\n    }\n    var defs = indicatorsHash.fields.map(convertIndicatorToDefinition);\n    // now we need to create an object which has props for each def\n    return defs;\n}\n/**\n * Given the values hash, locate the properties that are Indicators\n * and return an array of cloned objects\n * @protected\n */\nexport var extractIndicators = function (values) {\n    return Object.keys(values).reduce(function (acc, prop) {\n        var obj = values[prop];\n        if (isIndicator(obj)) {\n            var clone = cloneObject(obj);\n            // we want to keep the prop name as the id\n            clone.id = prop;\n            acc.push(clone);\n        }\n        return acc;\n    }, []);\n};\n/**\n * CAS format had the field properties nested but\n * the new format is flattened\n * @protected\n */\nexport var flattenField = function (field) {\n    return {\n        id: field.id,\n        name: field.field.name,\n        alias: field.field.alias,\n        type: field.field.type\n    };\n};\n/**\n * Given the indicator value object (from the Initiative), extract\n * the properties to create the .source hash\n * @protected\n */\nexport var convertIndicatorValueToSource = function (indicator) {\n    return {\n        type: \"Feature Layer\",\n        url: indicator.url,\n        itemId: indicator.itemId,\n        layerId: indicator.layerId,\n        name: indicator.name || indicator.id,\n        mappings: indicator.fields.map(flattenField)\n    };\n};\n/**\n * Convert the \"source\" information\n * @protected\n */\nexport var convertIndicator = function (indicator) {\n    var result = {\n        id: indicator.id,\n        type: \"Data\",\n        name: indicator.name || indicator.id,\n        definition: {\n            description: indicator.name || indicator.id\n        },\n        source: convertIndicatorValueToSource(indicator)\n    };\n    return result;\n};\n/**\n * Given the values hash that contains indicators, extract them\n * convert them, and return the indicators hash\n * @protected\n */\nexport var convertInitiativeIndicators = function (values) {\n    return extractIndicators(values).map(convertIndicator);\n};\n/**\n * Given a Step object, return a new object with the\n * updated schema\n * @protected\n */\nexport var convertStep = function (step) {\n    // can't use object spread b/c there are props we don't want to carry forward\n    var templates = step.templates || [];\n    var items = step.items || [];\n    return {\n        title: step.title,\n        description: step.description,\n        id: step.id,\n        templateIds: templates.map(byId),\n        itemIds: items.map(byId)\n    };\n};\n/**\n * given the array of steps (prop names), construct an array\n * of the actual step objects while also falttening templates\n * and items arrays to just ids\n * @protected\n */\nexport var convertSteps = function (steps, values) {\n    if (steps && Array.isArray(steps)) {\n        return steps.map(function (stepName) {\n            return convertStep(values[stepName]);\n        });\n    }\n    else {\n        return [];\n    }\n};\n/**\n * Extract the id property from an entry\n *\n * @protected\n * @param {*} entry\n * @returns\n */\nexport function byId(entry) {\n    return entry.id;\n}\n/**\n * Apply the 1.1 --> 2.0 Migration to an Initiative Model\n *\n * @protected\n * @param {IInitiativeModel} model\n * @param {string} [portalUrl]\n * @returns {IInitiativeModel}\n */\nexport function upgradeToTwoDotZero(model, portalUrl) {\n    var curVersion = getProp(model, \"item.properties.schemaVersion\");\n    if (curVersion < 2) {\n        var clone_1 = cloneObject(model);\n        // store the schemaVersion\n        clone_1.item.properties.schemaVersion = 2.0;\n        // convert the values and values.steps into data.steps\n        clone_1.data.steps = convertSteps(clone_1.data.values.steps, clone_1.data.values);\n        if (clone_1.data.values.steps) {\n            // remove the data.values.steps properties\n            clone_1.data.values.steps.forEach(function (propName) {\n                delete clone_1.data.values[propName];\n            });\n            delete clone_1.data.values.steps;\n        }\n        // convert the indicators\n        clone_1.data.indicators = convertInitiativeIndicators(clone_1.data.values);\n        return clone_1;\n    }\n    else {\n        return model;\n    }\n}\n//# sourceMappingURL=upgrade-two-dot-zero.js.map","/* Copyright (c) 2020 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getProp, cloneObject } from \"@esri/hub-common\";\n/**\n * Apply the 2.1 --> 2.2 Migration to an Initiative Model\n * Note: we need this migration to run every time for now, so we\n * will always run it\n *\n * @param model\n * @protected\n */\nexport function upgradeToTwoDotTwo(model) {\n    // const currVersion = getProp(model, \"item.properties.schemaVersion\");\n    // if (currVersion < 2.2) {\n    var clone = cloneObject(model);\n    // store the schemaVersion\n    // clone.item.properties.schemaVersion = 2.2;\n    var steps = getProp(clone, \"data.steps\");\n    var templateIdsFromSteps = getTemplateIdsFromSteps(steps);\n    var recommendedTemplates = getProp(clone, \"data.recommendedTemplates\") || [];\n    var allTemplateIds = templateIdsFromSteps.concat(recommendedTemplates);\n    // strip out duplicates\n    clone.data.recommendedTemplates = allTemplateIds.reduce(function (acc, id) {\n        if (acc.indexOf(id) < 0) {\n            acc.push(id);\n        }\n        return acc;\n    }, []);\n    return clone;\n    // } else {\n    //   return model;\n    // }\n}\n/**\n * Reduce the solution template ids out of the steps array\n * @param steps is the steps array from an initiative item model.data\n */\nfunction getTemplateIdsFromSteps(steps) {\n    var templateIds = [];\n    if (Array.isArray(steps)) {\n        templateIds = steps.reduce(function (acc, step) {\n            if (getProp(step, \"templateIds.length\")) {\n                return acc.concat(step.templateIds);\n            }\n            return acc;\n        }, []);\n    }\n    return templateIds;\n}\n//# sourceMappingURL=upgrade-two-dot-two.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getProp } from \"@esri/hub-common\";\nimport { applyInitialSchema } from \"./migrations/apply-schema\";\nimport { upgradeToOneDotOne } from \"./migrations/upgrade-one-dot-one\";\nimport { upgradeToTwoDotZero } from \"./migrations/upgrade-two-dot-zero\";\nimport { upgradeToTwoDotOne } from \"./migrations/upgrade-two-dot-one\";\nimport { upgradeToTwoDotTwo } from \"./migrations/upgrade-two-dot-two\";\n/**\n * Current Schema Version\n * @protected\n */\nexport var CURRENT_SCHEMA_VERSION = 2.2;\n/**\n * Handle Initiative Schema Migrations.\n * If the model is on the current schema, the model object is returned.\n * If a schema migration is applied, a new object will be returned.\n *\n * @export\n * @param {IInitiativeModelFoo} model\n * @param {string} portalUrl\n * @returns {IInitiativeModel}\n */\nexport function migrateSchema(model, portalUrl) {\n    // if the model is not on the current schema, we apply all of them\n    // the individual migrations will early-exit if the item version\n    // is at or above the migration\n    if (getProp(model, \"item.properties.schemaVersion\") === CURRENT_SCHEMA_VERSION) {\n        return model;\n    }\n    else {\n        // apply upgrade functions in order...\n        model = applyInitialSchema(model, portalUrl);\n        model = upgradeToOneDotOne(model, portalUrl);\n        model = upgradeToTwoDotZero(model, portalUrl);\n        model = upgradeToTwoDotOne(model);\n        model = upgradeToTwoDotTwo(model);\n        // etc\n        return model;\n    }\n}\n//# sourceMappingURL=migrator.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getProp, cloneObject } from \"@esri/hub-common\";\n/**\n * Applies the initial version of the Initiaive schema to the model.\n * If `model.item.properties.schemaVersion >= 1` the original object\n * will be returned. Otherwise a new object with the updated schema\n * is returned.\n *\n * @protected\n * @param {IInitiativeModel} model Initiative Model\n * @param {string} [portalUrl] Url to the Portal. Defauls to `www.arcgis.com`\n * @returns {IInitiativeModel}\n */\nexport function applyInitialSchema(model, portalUrl) {\n    var curVersion = getProp(model, \"item.properties.schemaVersion\");\n    // if no current version or it's below 1\n    if (!curVersion || curVersion < 1) {\n        // clone the model because we play by immutable rules\n        var clone_1 = cloneObject(model);\n        // console.debug(`------- CLONE ---------`);\n        // console.debug(JSON.stringify(clone, null, 2));\n        // console.debug(`------- CLONE ---------`);\n        // ensure some properties exist...\n        if (!clone_1.data.values) {\n            clone_1.data.values = {};\n        }\n        if (!clone_1.item.properties) {\n            clone_1.item.properties = {};\n        }\n        // set the schema version...\n        clone_1.item.properties.schemaVersion = 1.0;\n        var isTemplate_1 = false;\n        if (clone_1.item.typeKeywords) {\n            isTemplate_1 =\n                clone_1.item.typeKeywords.indexOf(\"hubInitiativeTemplate\") >= 0;\n        }\n        // ensure source is in item.properties if it has a parent...\n        var hasParent = !!clone_1.data.source;\n        if (hasParent && clone_1.item.properties.source !== clone_1.data.source) {\n            clone_1.item.properties.source = clone_1.data.source;\n        }\n        // convert configuratinSettings to steps array...\n        // NOTE: this is only for 'templates', or Custom Initiatives\n        if (clone_1.data.configurationSettings) {\n            var config = cloneObject(clone_1.data.configurationSettings);\n            delete clone_1.data.configurationSettings;\n            // get the steps entry...\n            var stepCategory = config.find(function (el) {\n                return el.category === \"Steps\";\n            });\n            // hoist step names into an array\n            clone_1.data.values.steps = stepCategory.fields.map(function (entry) {\n                return entry.fieldName;\n            });\n            // move the label and tooltip to title and description, in the values.<fieldName> prop\n            stepCategory.fields.forEach(function (entry) {\n                // ensure values prop exists...\n                if (!clone_1.data.values[entry.fieldName]) {\n                    clone_1.data.values[entry.fieldName] = {};\n                }\n                // assign in values\n                clone_1.data.values[entry.fieldName].title = entry.label;\n                clone_1.data.values[entry.fieldName].description = entry.tooltip;\n                clone_1.data.values[entry.fieldName].id = entry.fieldName;\n                // if a .items array exists, rename that to .templates\n                if (clone_1.data.values[entry.fieldName].items) {\n                    // if this is a template, then move items to templates...\n                    if (isTemplate_1) {\n                        clone_1.data.values[entry.fieldName].templates =\n                            clone_1.data.values[entry.fieldName].items;\n                        delete clone_1.data.values[entry.fieldName].items;\n                    }\n                }\n                else {\n                    // ensure empty arrays\n                    clone_1.data.values[entry.fieldName].items = [];\n                    clone_1.data.values[entry.fieldName].templates = [];\n                }\n            });\n        }\n        return clone_1;\n    }\n    else {\n        return model;\n    }\n}\n//# sourceMappingURL=apply-schema.js.map","/* Copyright (c) 2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getProp, cloneObject } from \"@esri/hub-common\";\n/**\n * Apply the 2.0 --> 2.1 Migration to an Initiative Model\n *\n * @param model\n * @protected\n */\nexport function upgradeToTwoDotOne(model) {\n    var currVersion = getProp(model, \"item.properties.schemaVersion\");\n    if (currVersion < 2.1) {\n        var clone = cloneObject(model);\n        // store the schemaVersion\n        clone.item.properties.schemaVersion = 2.1;\n        var collaborationGroupId = getProp(model, \"item.properties.groupId\");\n        if (collaborationGroupId) {\n            clone.item.properties.collaborationGroupId = collaborationGroupId;\n            delete clone.item.properties.groupId;\n        }\n        return clone;\n    }\n    else {\n        return model;\n    }\n}\n//# sourceMappingURL=upgrade-two-dot-one.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { getItem, getItemData } from \"@esri/arcgis-rest-portal\";\nimport { getPortalApiUrl } from \"@esri/hub-common\";\nimport { migrateSchema } from \"./migrator\";\nimport { convertIndicatorsToDefinitions } from \"./migrations/upgrade-two-dot-zero\";\n// re-export this one helper function that's needed for solutions\nexport { convertIndicatorsToDefinitions };\n/**\n * ```js\n * getInitiative('3ef...')\n *  .then(initiativeModel => {\n *    // work with the initiative model\n *  })\n * ```\n * Get the initiative item + data in one call. This will also apply schema upgrades\n *\n *\n * @param id - Initiative Item Id\n * @param requestOptions - Initiative request options that may have authentication manager\n * @returns A Promise that will resolve with the Initiative item and data\n * @export\n */\nexport function getInitiative(id, requestOptions) {\n    // if we have specifically requested the data...\n    return Promise.all([\n        getItem(id, requestOptions),\n        getItemData(id, requestOptions)\n    ])\n        .then(function (result) {\n        // shape this into a model\n        return {\n            item: result[0],\n            data: result[1]\n        };\n    })\n        .then(function (model) {\n        return migrateSchema(model, getPortalApiUrl(requestOptions));\n    });\n}\n//# sourceMappingURL=get.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { createGroup, protectGroup, searchGroups, removeGroup, unprotectGroup } from \"@esri/arcgis-rest-portal\";\n/**\n * Create an initiative collaboration or open data group\n * Note: This does not ensure a group with the proposed name does not exist. Please use\n * `checkGroupExists\n *\n * @export\n * @param {string} name\n * @param {string} description\n * @param {*} options {isOpenData: boolean, isSharedEditing: boolean}\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<IInitiativeModel>}\n */\nexport function createInitiativeGroup(name, description, options, requestOptions) {\n    var group = {\n        title: name,\n        description: description,\n        access: \"org\",\n        sortField: \"title\",\n        sortOrder: \"asc\"\n    };\n    if (options.isOpenData) {\n        group.isOpenData = true;\n        group.tags = [\"Hub Initiative Group\", \"Open Data\"];\n        group.access = \"public\";\n    }\n    if (options.isSharedEditing) {\n        group.capabilities = \"updateitemcontrol\";\n        group._edit_privacy = \"on\";\n        group._edit_contributors = \"on\";\n        group.tags = [\"Hub Initiative Group\", \"initiativeCollaborationGroup\"];\n    }\n    var createOpts = __assign({ group: group }, requestOptions);\n    // The protect call does not return the groupId, but we need to return it\n    // from this function, so we create a var in this scope to hold it...\n    var groupId;\n    // create the group\n    return createGroup(createOpts)\n        .then(function (result) {\n        groupId = result.group.id;\n        // protect it\n        var protectOpts = __assign({ id: groupId }, requestOptions);\n        return protectGroup(protectOpts);\n    })\n        .then(function () {\n        return groupId;\n    });\n}\n/**\n * Remove an Initiative group.\n * This assumes the group is protected\n *\n * @export\n * @param {string} id\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<any>}\n */\nexport function removeInitiativeGroup(id, requestOptions) {\n    var opts = __assign({ id: id }, requestOptions);\n    return unprotectGroup(opts).then(function () {\n        return removeGroup(opts);\n    }, function (ex) {\n        // check if the failure is b/c the group does not exist...\n        if (ex.messageCode === \"COM_0003\" && ex.code === 400) {\n            return Promise.resolve({ success: true });\n        }\n        else {\n            throw ex;\n        }\n    });\n}\n/**\n * Check if a group with a specific title exists in an org\n * If it does exist, and has the correct properties, we return the\n * @export\n * @param {string} title\n * @param {string} orgId\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<boolean>}\n */\nexport function checkGroupExists(title, orgId, requestOptions) {\n    var options = __assign({ q: \"(\\\"\" + title + \"\\\") AND orgid: \" + orgId }, requestOptions);\n    return searchGroups(options).then(function (response) {\n        var result = {\n            exists: false\n        };\n        if (response.total > 0) {\n            result.exists = true;\n            result.group = response.results[0];\n        }\n        return result;\n    });\n}\n/**\n * Group names must be unique within an organization\n *\n * @export\n * @param {string} title\n * @param {string} orgId\n * @param {number} [step=0]\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<string>}\n */\nexport function getUniqueGroupName(title, orgId, step, requestOptions) {\n    var proposedName = title;\n    if (step) {\n        proposedName = title + \" - \" + step;\n    }\n    return checkGroupExists(proposedName, orgId, requestOptions).then(function (result) {\n        if (result.exists) {\n            // increment the step...\n            step = step + 1;\n            return getUniqueGroupName(title, orgId, step, requestOptions);\n        }\n        else {\n            return proposedName;\n        }\n    });\n}\nexport function isSharedEditingGroup(group) {\n    return !!(group.capabilities.indexOf(\"updateitemcontrol\") > -1);\n}\n//# sourceMappingURL=groups.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { protectGroup } from '@esri/arcgis-rest-portal';\n * //\n * protectGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Protect a group to avoid accidental deletion. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/protect-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function protectGroup(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.id + \"/protect\";\n    return request(url, requestOptions);\n}\n/**\n * ```js\n * import { unprotectGroup } from '@esri/arcgis-rest-portal';\n * //\n * unprotectGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Unprotect a Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/unprotect-group.htm) for more information.\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function unprotectGroup(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.id + \"/unprotect\";\n    return request(url, requestOptions);\n}\n//# sourceMappingURL=protect.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { removeGroup } from '@esri/arcgis-rest-portal';\n * //\n * removeGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Delete a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function removeGroup(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.id + \"/delete\";\n    var options = __assign({}, requestOptions);\n    return request(url, options);\n}\n//# sourceMappingURL=remove.js.map","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { genericSearch } from \"../util/generic-search\";\n/**\n * ```js\n * import { searchGroups } from \"@esri/arcgis-rest-portal\";\n * //\n * searchGroups('water')\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for groups. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-search.htm) for more information.\n *\n * @param search - A string or RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroups(search) {\n    return genericSearch(search, \"group\");\n}\n/**\n * ```js\n * import { searchGroupContent } from \"@esri/arcgis-rest-portal\";\n * //\n * searchGroupContent('water')\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for items in a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-content-search.htm) for more information.\n *\n * @param options - RequestOptions object amended with search parameters.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroupContent(options) {\n    return genericSearch(options, \"groupContent\");\n}\n//# sourceMappingURL=search.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { cloneObject, without, getProp } from \"@esri/hub-common\";\nimport { CURRENT_SCHEMA_VERSION } from \"./migrator\";\nimport { INITIATIVE_TYPE_NAME } from \"./add\";\n/**\n * Given an Initiative Template model, create a new Initiative model\n * Note: this does not save the model. It just sets up the new model.\n *\n * @export\n * @param {IInitiativeModel} template\n * @param {*} options\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<IInitiativeModel>}\n */\nexport function createInitiativeModelFromTemplate(template, options) {\n    // start by making deep clone of the template...\n    var model = {\n        item: cloneObject(template.item),\n        data: {}\n    };\n    model.item.title = options.title;\n    model.item.tags = [\"Hub Initiative\"];\n    // ensure we use the current type\n    model.item.type = INITIATIVE_TYPE_NAME;\n    // Assign the typeKeywords: remove hubInitiativeTemplate and add hubInitiative\n    model.item.typeKeywords = without(model.item.typeKeywords, \"hubInitiativeTemplate\");\n    model.item.typeKeywords.push(\"hubInitiative\");\n    // remove things that are irrelevant or are set server-side\n    [\"id\", \"owner\", \"created_at\", \"modified_at\"].forEach(function (prop) { return delete model.item[prop]; });\n    // we store a bunch of Ids in here so we can avoid fetching /data for common interactions\n    model.item.properties = {\n        source: template.item.id,\n        schemaVersion: CURRENT_SCHEMA_VERSION,\n        initialParent: template.item.id\n    };\n    Object.assign(model.item.properties, options.groupIds); // add the groupIds\n    // we create a new .data node so we're cleaning rogue properties as we go\n    model.data = {\n        assets: cloneObject(template.data.assets),\n        steps: cloneObject(template.data.steps),\n        indicators: [],\n        source: template.item.id,\n        values: {\n            initiativeKey: options.initiativeKey,\n            bannerImage: cloneObject(template.data.values.bannerImage)\n        }\n    };\n    // if recommended exists, copy it over\n    if (getProp(template, \"data.recommendedTemplates\")) {\n        model.data.recommendedTemplates = template.data.recommendedTemplates;\n    }\n    Object.assign(model.data.values, options.groupIds); // add the groupIds, TODO stop storing groupIds in data.values\n    // just in case the template does not have a banner image defined...\n    if (!model.data.values.bannerImage) {\n        model.data.values.bannerImage = {\n            source: \"bannerImage\",\n            display: {\n                position: { x: \"50%\", y: \"10%\" }\n            }\n        };\n    }\n    return model;\n}\n//# sourceMappingURL=templates.js.map","import { addItemResource } from \"@esri/arcgis-rest-portal\";\nimport { getPortalApiUrl } from \"@esri/hub-common\";\n/**\n *  Copy an set of image resources from one item to another\n *\n * @export\n * @param {string} sourceItemId\n * @param {string} targetItemId\n * @param {string} owner\n * @param {[string]} assets\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<boolean>}\n */\nexport function copyImageResources(sourceItemId, targetItemId, owner, assets, requestOptions) {\n    var itemResourceUrl = getPortalApiUrl(requestOptions) + \"/content/items/\" + sourceItemId + \"/resources\";\n    /* istanbul ignore next blob responses are difficult to make cross platform we will just have to trust the isomorphic fetch will do its job */\n    return requestOptions.authentication\n        .getToken(itemResourceUrl)\n        .then(function (token) {\n        var assetPromises = assets.map(function (assetName) {\n            var sourceUrl = itemResourceUrl + \"/\" + assetName + \"?token=\" + token;\n            return addImageAsResource(targetItemId, owner, assetName, sourceUrl, requestOptions);\n        });\n        // This is really more of a fire-and-forget thing, as the Portal API\n        // adds these requests into a queue for processing\n        return Promise.all(assetPromises);\n    })\n        .then(function () {\n        return true;\n    });\n}\n/**\n *  Copy an set of embedded resources to an item\n *\n * @export\n * @param {string} targetItemId destination item id\n * @param {string} owner destination item owner\n * @param {any[]} assets list of assets to copy\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<boolean>}\n */\nexport function copyEmbeddedImageResources(targetItemId, owner, assets, requestOptions) {\n    // need to move resources from embedded template into AGO\n    var promises = assets.map(function (asset) {\n        return addImageAsResource(targetItemId, owner, asset.name, asset.url, requestOptions)\n            .then(function () {\n            return true;\n        })\n            .catch(function () {\n            return true; // swallow the error\n        });\n    });\n    return Promise.all(promises).then(function () {\n        return true;\n    });\n}\n/**\n * Load an image from a url, and store it as a resource on an existing item\n *\n * @export\n * @param {string} itemId\n * @param {string} owner\n * @param {string} filename\n * @param {string} url\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<boolean>}\n */\nexport function addImageAsResource(id, owner, name, url, requestOptions) {\n    // We must use fetch directly here because AGSjs request determines how to parse\n    // the response based on the `?f=<type>` param. But sending f=<anything-other-than-json>\n    // to a resource end-point, throws an error. Rock, meet Hard-Place.\n    var fetchOptions = {\n        method: \"GET\",\n        // ensures behavior mimics XMLHttpRequest. needed to support sending IWA cookies\n        credentials: \"same-origin\"\n    };\n    return (\n    // -------------------------------------------------\n    // request(url, opts)\n    // -------------------------------------------------\n    fetch(url, fetchOptions)\n        .then(function (x) {\n        return x.blob();\n    })\n        .then(function (blob) {\n        return addItemResource({\n            id: id,\n            owner: owner,\n            name: name,\n            resource: blob,\n            authentication: requestOptions.authentication\n        }).then(function (response) {\n            return response.success;\n        });\n    }));\n}\n//# sourceMappingURL=util.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { determineOwner } from \"./helpers\";\nimport { updateItem } from \"./update\";\n/**\n * ```js\n * import { addItemData } from \"@esri/arcgis-rest-portal\";\n * //\n * addItemData({\n *   id: '3ef',\n *   data: file,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Send a file or blob to an item to be stored as the `/data` resource. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with an object reporting\n *        success/failure and echoing the item id.\n */\nexport function addItemData(requestOptions) {\n    var options = __assign({ item: {\n            id: requestOptions.id,\n            data: requestOptions.data\n        } }, requestOptions);\n    delete options.id;\n    delete options.data;\n    return updateItem(options);\n}\n/**\n * ```js\n * import { addItemRelationship } from \"@esri/arcgis-rest-portal\";\n * //\n * addItemRelationship({\n *   originItemId: '3ef',\n *   destinationItemId: 'ae7',\n *   relationshipType: 'Service2Layer',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Add a relationship between two items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-relationship.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function addItemRelationship(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/addRelationship\";\n        var options = appendCustomParams(requestOptions, [\"originItemId\", \"destinationItemId\", \"relationshipType\"], { params: __assign({}, requestOptions.params) });\n        return request(url, options);\n    });\n}\n/**\n * ```js\n * import { addItemResource } from \"@esri/arcgis-rest-portal\";\n * //\n * // Add a file resource\n * addItemResource({\n *   id: '3ef',\n *   resource: file,\n *   name: 'bigkahuna.jpg',\n *   authentication\n * })\n *   .then(response)\n * //\n * // Add a text resource\n * addItemResource({\n *   id: '4fg',\n *   content: \"Text content\",\n *   name: 'bigkahuna.txt',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Add a resource associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-resources.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function addItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/addResources\";\n        requestOptions.params = __assign({ file: requestOptions.resource, fileName: requestOptions.name, resourcesPrefix: requestOptions.prefix, text: requestOptions.content, access: requestOptions.private ? \"private\" : \"inherit\" }, requestOptions.params);\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=add.js.map","import { __assign } from \"tslib\";\nimport { getItem, updateItem, shareItemWithGroup } from \"@esri/arcgis-rest-portal\";\n/**\n * Remove the linkage between a site and an Initiative\n * Share the site to the Org's default Collaboration Group\n *\n * @export\n * @param {string} siteId\n * @param {*} collaborationGroupId\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<any>}\n */\nexport function detachSiteFromInitiative(siteId, collaborationGroupId, requestOptions) {\n    // get the site item\n    return getItem(siteId, requestOptions)\n        .then(function (site) {\n        // remove the properties.parentInitiativeId property\n        delete site.properties.parentInitiativeId;\n        if (collaborationGroupId) {\n            // reset the collaborationGroupId to the org's Open Data Group\n            site.properties.collaborationGroupId = collaborationGroupId;\n        }\n        // update the site item\n        var opts = __assign({ item: site }, requestOptions);\n        return updateItem(opts);\n    })\n        .then(function () {\n        // share it with the group if we got a group...\n        if (collaborationGroupId) {\n            var opts = __assign({ id: siteId, groupId: collaborationGroupId }, requestOptions);\n            return shareItemWithGroup(opts);\n        }\n        else {\n            return Promise.resolve({ success: true });\n        }\n    });\n}\n//# sourceMappingURL=detach-site.js.map","import { cloneObject, createId, without, normalizeSolutionTemplateItem, propifyString, getProp } from \"@esri/hub-common\";\nimport { getItemResources } from \"@esri/arcgis-rest-portal\";\n/**\n * Convert an Initiative Model into a template\n * Includes a hash of resources\n * @param {object} model Initiative model\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function convertInitiativeToTemplate(model, hubRequestOptions) {\n    // clone this so we don't mess things up...\n    var templateItem = model.item;\n    var template = cloneObject(model);\n    template.item = normalizeSolutionTemplateItem(templateItem);\n    // clear url\n    delete template.item.url;\n    // clear the extent\n    delete template.item.extent;\n    // clear out item properties...\n    delete template.item.properties.source;\n    delete template.item.properties.collaborationGroupId;\n    delete template.item.properties.contentGroupId;\n    delete template.item.properties.followersGroupId;\n    delete template.item.properties.groupId; // artifact of 2.0 initiatives\n    // on the data side of things...\n    delete template.data.values.collaborationGroupId;\n    delete template.data.values.contentGroupId;\n    delete template.data.values.followersGroupId;\n    delete template.data.values.followerGroups;\n    delete template.data.values.openDataGroupId;\n    // Ensure some properties are set correctly\n    template.type = \"Hub Initiative Template\";\n    template.key = propifyString(model.item.title) + \"_\" + createId(\"i\");\n    template.itemId = model.item.id;\n    // remove the initiative keyword\n    template.item.typeKeywords = without(template.item.typeKeywords, \"hubInitiative\");\n    // add the typeKeyword\n    template.item.typeKeywords.push(\"hubInitiativeTemplate\");\n    // if we have steps, and not recommended, convert them\n    // this may happen if the model is fetched via something other\n    // than the getInitiative fn, which applies schema upgrades\n    if (getProp(template, \"data.steps\") &&\n        !getProp(template, \"data.recommendedTemplates\")) {\n        // collect up the ids from all the steps into `recommendedTemplates`\n        template.data.recommendedTemplates = template.data.steps.reduce(function (acc, step) {\n            var stepTmpl = step.templateIds || [];\n            return acc.concat(stepTmpl);\n        }, []);\n    }\n    // get the resources...\n    return getItemResources(template.itemId, hubRequestOptions).then(function (response) {\n        // TODO: compute url to resource\n        template.resources = response.resources.map(function (e) { return e.resource; });\n        return template;\n    });\n}\n//# sourceMappingURL=convert-initiative-to-template.js.map","import { __spreadArrays } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getUserUrl, joinGroup, leaveGroup } from \"@esri/arcgis-rest-portal\";\nimport { getProp, unique } from \"@esri/hub-common\";\nimport { getInitiative } from \"./get\";\nvar getUserTag = function (initiativeId) { return \"hubInitiativeId|\" + initiativeId; };\nvar initiativeIdFromUserTag = function (tag) {\n    return tag.replace(/^hubInitiativeId\\|/, \"\");\n};\nvar initiativeIdFromGroupTag = function (tag) {\n    return tag.replace(/^hubInitiativeFollowers\\|/, \"\");\n};\nvar getUpdateUrl = function (session) { return getUserUrl(session) + \"/update\"; };\nvar currentlyFollowedInitiativesByUserTag = function (user) {\n    return user.tags.map(initiativeIdFromUserTag);\n};\nvar currentlyFollowedInitiativesByGroupMembership = function (user) {\n    return user.groups\n        .map(function (group) { return group.tags; })\n        .reduce(function (acc, item) { return acc.concat(item); }, [])\n        .filter(function (tags) { return tags.indexOf(\"hubInitiativeFollowers|\") === 0; })\n        .map(initiativeIdFromGroupTag);\n};\nexport var currentlyFollowedInitiatives = function (user) {\n    var byUserTags = currentlyFollowedInitiativesByUserTag(user);\n    var byGroupMembership = currentlyFollowedInitiativesByGroupMembership(user);\n    return __spreadArrays(byUserTags, byGroupMembership).filter(unique);\n};\nexport var isUserFollowing = function (user, initiativeId) {\n    return currentlyFollowedInitiatives(user).indexOf(initiativeId) > -1;\n};\n/**\n * ```js\n * import { followInitiative } from \"@esri/hub-initiatives\";\n * //\n * followInitiative({\n *   initiativeId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Follow an initiative.\n */\nexport function followInitiative(requestOptions) {\n    // we dont call getUser() because the tags are cached and will be mutating\n    return request(getUserUrl(requestOptions.authentication), {\n        authentication: requestOptions.authentication\n    })\n        .then(function (user) {\n        // don't update if already following\n        if (isUserFollowing(user, requestOptions.initiativeId)) {\n            return Promise.reject(\"user is already following this initiative.\");\n        }\n        // if not already following, pass the user on\n        return user;\n    })\n        .then(function (user) {\n        return getInitiative(requestOptions.initiativeId, requestOptions).then(function (initiative) { return ({\n            user: user,\n            initiative: initiative,\n            hasFollowersGroup: false\n        }); });\n    })\n        .then(function (obj) {\n        // if the initiative has a followersGroupId\n        var groupId = getProp(obj, \"initiative.item.properties.followersGroupId\");\n        if (groupId) {\n            // attempt to join it\n            return joinGroup({\n                id: groupId,\n                authentication: requestOptions.authentication\n            }).then(function (groupJoinResponse) {\n                obj.hasFollowersGroup = groupJoinResponse.success;\n                return obj;\n            });\n        }\n        return obj;\n    })\n        .then(function (obj) {\n        if (!obj.hasFollowersGroup) {\n            // else add the tag to the user\n            var tag = getUserTag(requestOptions.initiativeId);\n            var tags = JSON.parse(JSON.stringify(obj.user.tags));\n            tags.push(tag);\n            return request(getUpdateUrl(requestOptions.authentication), {\n                params: { tags: tags },\n                authentication: requestOptions.authentication\n            });\n        }\n        // the initiative has a followers group and we successfully joined it\n        return { success: true, username: obj.user.username };\n    });\n}\n/**\n * ```js\n * import { unfollowInitiative } from \"@esri/hub-initiatives\";\n * //\n * unfollowInitiative({\n *   initiativeId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Un-follow an initiative.\n */\nexport function unfollowInitiative(requestOptions) {\n    // we dont call getUser() because the tags are cached and will be mutating\n    return request(getUserUrl(requestOptions.authentication), {\n        authentication: requestOptions.authentication\n    })\n        .then(function (user) {\n        // don't update if not already following\n        if (!isUserFollowing(user, requestOptions.initiativeId)) {\n            return Promise.reject(\"user is not following this initiative.\");\n        }\n        // if already following, pass the user on\n        return user;\n    })\n        .then(function (user) {\n        var tag = getUserTag(requestOptions.initiativeId);\n        var tags = JSON.parse(JSON.stringify(user.tags));\n        if (tags.indexOf(tag) > -1) {\n            // https://stackoverflow.com/questions/9792927/javascript-array-search-and-remove-string\n            var index = tags.indexOf(tag);\n            tags.splice(index, 1);\n            // clear the last tag by passing \",\".\n            if (tags.length === 0) {\n                tags.push(\",\");\n            }\n            return request(getUpdateUrl(requestOptions.authentication), {\n                params: { tags: tags },\n                authentication: requestOptions.authentication\n            }).then(function (_) { return user; });\n        }\n        return user;\n    })\n        .then(function (user) {\n        return getInitiative(requestOptions.initiativeId, requestOptions).then(function (initiative) { return ({ user: user, initiative: initiative }); });\n    })\n        .then(function (obj) {\n        // if there is an initiative followers group and the user is a member, attempt to leave it\n        var groupId = getProp(obj, \"initiative.item.properties.followersGroupId\");\n        if (groupId &&\n            currentlyFollowedInitiativesByGroupMembership(obj.user).indexOf(requestOptions.initiativeId) > -1) {\n            return leaveGroup({\n                id: groupId,\n                authentication: requestOptions.authentication\n            }).then(function (groupLeaveResponse) {\n                return { success: true, username: obj.user.username };\n            });\n        }\n        return { success: true, username: obj.user.username };\n    });\n}\n//# sourceMappingURL=follow.js.map","export var DEFAULT_INITIATIVE_TEMPLATE = {\n    item: {\n        title: \"{{solution.title}}\",\n        snippet: \"{{solution.snippet}}\",\n        description: \"{{solution.snippet}}\",\n        type: \"Hub Initiative\",\n        typeKeywords: [\"Hub\", \"hubInitiative\"],\n        tags: [],\n        extent: \"{{organization.defaultExtentBBox}}\",\n        culture: \"{{user.culture}}\",\n        properties: {},\n        url: \"\",\n    },\n    data: {\n        assets: [],\n        indicators: [],\n        recommendedTemplates: [],\n    },\n};\n//# sourceMappingURL=default-initiative-template.js.map","import { getCulture, convertToWellKnownLocale, fetchHubTranslation, cloneObject, getProp } from \"@esri/hub-common\";\nimport { DEFAULT_INITIATIVE_TEMPLATE } from \"./default-initiative-template\";\n/**\n * Get the translated default initiative template\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function getDefaultInitiativeTemplate(hubRequestOptions) {\n    var culture = getCulture(hubRequestOptions);\n    var locale = convertToWellKnownLocale(culture);\n    return fetchHubTranslation(locale, hubRequestOptions.portalSelf).then(function (translation) {\n        // now we can get the embedded initiative template\n        var tmpl = cloneObject(DEFAULT_INITIATIVE_TEMPLATE);\n        // pluck values off the translation, and inject into the tmpl\n        tmpl.item.description = getProp(translation, \"addons.services.templates.customInitiative.item.description\");\n        tmpl.item.snippet = getProp(translation, \"addons.services.templates.customInitiative.item.snippet\");\n        tmpl.item.culture = locale;\n        // TODO: HANDLE RESOURCES!\n        return tmpl;\n    });\n}\n//# sourceMappingURL=get-default-initiative-template.js.map","import { getInitiative } from \"./get\";\nimport { convertInitiativeToTemplate } from \"./convert-initiative-to-template\";\nimport { getDefaultInitiativeTemplate } from \"./get-default-initiative-template\";\n/**\n * Given the id of an initiative, fetch it, and convert to a template\n * If the fetch fails, it will return the default initiative template\n * @param {string} id Initiative Item Id\n * @param {IHubRequestOptions} hubRequestOptions\n * @private\n */\nexport function _fetchAndConvertInitiativeToTemplate(id, hubRequestOptions) {\n    return getInitiative(id, hubRequestOptions)\n        .then(function (model) {\n        return convertInitiativeToTemplate(model, hubRequestOptions);\n    })\n        .catch(function (_) {\n        return getDefaultInitiativeTemplate(hubRequestOptions);\n    });\n}\n//# sourceMappingURL=_fetch-and-convert-initiative-to-template.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign, __awaiter, __generator } from \"tslib\";\nimport { camelize } from \"@esri/hub-common\";\nimport { getInitiative } from \"./get\";\nimport { createInitiativeModelFromTemplate } from \"./templates\";\nimport { addInitiative } from \"./add\";\nimport { copyImageResources, copyEmbeddedImageResources } from \"./util\";\nimport { shareItemWithGroup } from \"@esri/arcgis-rest-portal\";\nimport { getProp } from \"@esri/hub-common\";\n/**\n * Activate an Initiative\n * Creates an instance of an Initiative, based on an Initiative Template.\n *\n * @export\n * @param {string | any} template Initiative Template item or Id\n * @param {string} title\n * @param {any} groupIds hash of group props and ids\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<IInitiativeModel>}\n * @private\n */\nexport function activateInitiative(template, title, groupIds, requestOptions) {\n    var _this = this;\n    // make a copy of the request options so we can mutate things if needed...\n    var ro = __assign({}, requestOptions);\n    // create a state container to hold things we accumulate through the various promises\n    var state = {\n        initiativeKey: camelize(title)\n    };\n    var promise;\n    if (typeof template === \"string\") {\n        promise = getInitiative(template, ro);\n    }\n    else {\n        promise = Promise.resolve(template);\n    }\n    return promise\n        .then(function (templateItemModel) { return __awaiter(_this, void 0, void 0, function () {\n        var options;\n        return __generator(this, function (_a) {\n            state.template = templateItemModel;\n            options = {\n                title: title,\n                description: title,\n                initiativeKey: state.initiativeKey,\n                groupIds: groupIds\n            };\n            // cook the template...\n            state.initiativeModel = createInitiativeModelFromTemplate(state.template, options);\n            // now save it...\n            return [2 /*return*/, addInitiative(state.initiativeModel, ro)];\n        });\n    }); })\n        .then(function (newModel) {\n        state.initiativeModel = newModel;\n        var assets = getProp(state, \"template.assets\");\n        if (assets) {\n            return copyEmbeddedImageResources(newModel.item.id, newModel.item.owner, assets, ro);\n        }\n        else {\n            var _a = newModel.item, id = _a.id, owner = _a.owner;\n            var wellKnownAssets = [\n                \"detail-image.jpg\",\n                \"icon-dark.png\",\n                \"icon-light.png\"\n            ];\n            // now copy assets from the parent initiative...\n            return copyImageResources(state.template.item.id, id, owner, wellKnownAssets, ro);\n        }\n    })\n        .then(function () {\n        var collaborationGroupId = getProp(state, \"initiativeModel.item.properties.collaborationGroupId\");\n        if (collaborationGroupId) {\n            // create sharing options and share to the core team\n            var shareOptions = __assign({ id: state.initiativeModel.item.id, groupId: collaborationGroupId, confirmItemControl: true }, requestOptions);\n            return shareItemWithGroup(shareOptions);\n        }\n        else {\n            return Promise.resolve({ success: true });\n        }\n    })\n        .then(function () {\n        return state.initiativeModel;\n    });\n}\n//# sourceMappingURL=activate.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { createGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * createGroup({\n *   group: {\n *     title: \"No Homers\",\n *     access: \"public\"\n *   },\n *   authentication\n * })\n *   .then(response)\n * ```\n * Create a new Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/create-group.htm) for more information.\n *\n * Note: The group name must be unique within the user's organization.\n * @param requestOptions  - Options for the request, including a group object\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function createGroup(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/createGroup\";\n    requestOptions.params = __assign(__assign({}, requestOptions.params), requestOptions.group);\n    return request(url, requestOptions);\n}\n//# sourceMappingURL=create.js.map","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n/**\n * ```js\n * import { joinGroup } from '@esri/arcgis-rest-portal';\n * //\n * joinGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Make a request as the authenticated user to join a Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/join-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request and the groupId.\n */\nexport function joinGroup(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.id + \"/join\";\n    return request(url, requestOptions);\n}\n/**\n * ```js\n * import { leaveGroup } from '@esri/arcgis-rest-portal';\n * //\n * leaveGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Make a request as the authenticated user to leave a Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/leave-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request and the groupId.\n */\nexport function leaveGroup(requestOptions) {\n    var url = getPortalUrl(requestOptions) + \"/community/groups/\" + requestOptions.id + \"/leave\";\n    return request(url, requestOptions);\n}\n//# sourceMappingURL=join.js.map","import { getProp } from \"@esri/hub-common\";\nimport { getDefaultInitiativeTemplate } from \"./get-default-initiative-template\";\n// TODO: the initiative will be in the site hash OR we pass it in\n/**\n * Given a Site Template, do what we can to return an initiative template\n * In Hub, we expect the system to populate tmpl.properties.initiativeTemplate\n * In other apps, this may not be present, so we use the default template\n * (fetched from the Hub app)\n * @param {object} siteTemplate Site Template\n * @param {IHubRequestOptions} hubRequestOptions\n */\nexport function getInitiativeTemplate(siteTemplate, hubRequestOptions) {\n    var tmplPromise;\n    var template = getProp(siteTemplate, \"properties.initiativeTemplate\");\n    if (template) {\n        tmplPromise = Promise.resolve(template);\n    }\n    else {\n        // return the default template\n        tmplPromise = getDefaultInitiativeTemplate(hubRequestOptions);\n    }\n    return tmplPromise;\n}\n//# sourceMappingURL=get-initiative-template.js.map","import { __assign, __awaiter, __generator } from \"tslib\";\nimport { removeInitiativeGroup } from \"./groups\";\nimport { getInitiative } from \"./get\";\nimport { detachSiteFromInitiative } from \"./detach-site\";\nimport { getItem, removeItem, unprotectItem, getSelf } from \"@esri/arcgis-rest-portal\";\nimport { getProp, createId } from \"@esri/hub-common\";\n/**\n * Remove an Initiative, and its associated groups.\n * If the initiative has a site, it will be shared to\n * the organization's main collaboration group\n * @export\n * @param {string} id\n * @param {IRequestOptions} requestOptions\n * @returns {Promise<any>}\n */\nexport function removeInitiative(id, requestOptions) {\n    var _this = this;\n    var state = {\n        id: id\n    };\n    var processId = createId(\"remove-\");\n    var startTS = new Date().getTime();\n    // first get the item, because we need to also remove the\n    // collaboration and open data groups...\n    // and the Portal because w need the org's default\n    // collaboration group id\n    return Promise.all([\n        getInitiative(id, requestOptions),\n        getSelf(requestOptions)\n    ])\n        .then(function (results) { return __awaiter(_this, void 0, void 0, function () {\n        var model, portal, siteId, e_1, prms, opts;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    model = results[0];\n                    portal = results[1];\n                    siteId = model.item.properties.siteId;\n                    if (!siteId) return [3 /*break*/, 5];\n                    _a.label = 1;\n                case 1:\n                    _a.trys.push([1, 3, , 4]);\n                    return [4 /*yield*/, getItem(siteId, requestOptions)];\n                case 2:\n                    _a.sent();\n                    state.hasSite = true;\n                    state.siteId = siteId;\n                    return [3 /*break*/, 4];\n                case 3:\n                    e_1 = _a.sent();\n                    state.hasSite = false;\n                    return [3 /*break*/, 4];\n                case 4: return [3 /*break*/, 6];\n                case 5:\n                    state.hasSite = false;\n                    _a.label = 6;\n                case 6:\n                    state.initiativeOwner = model.item.owner;\n                    state.collaborationGroupId = getProp(portal, \"properties.openData.settings.groupId\");\n                    prms = [];\n                    [\"collaborationGroupId\", \"contentGroupId\", \"followersGroupId\"].forEach(function (prop) {\n                        if (model.item.properties[prop]) {\n                            prms.push(removeInitiativeGroup(model.item.properties[prop], requestOptions).catch(function () { return Promise.resolve(true); }) // swallow group delete failures\n                            );\n                        }\n                    });\n                    // if the item is protected, un-protect it...\n                    if (model.item.protected) {\n                        opts = __assign({ id: id }, requestOptions);\n                        prms.push(unprotectItem(opts));\n                    }\n                    return [2 /*return*/, Promise.all(prms)];\n            }\n        });\n    }); })\n        .then(function () {\n        var prms = [];\n        var opts = __assign({ id: id, owner: state.initiativeOwner }, requestOptions);\n        prms.push(removeItem(opts));\n        // if we have a site, let's detach it from the initiative\n        if (state.hasSite) {\n            prms.push(detachSiteFromInitiative(state.siteId, state.collaborationGroupId, requestOptions));\n        }\n        return Promise.all(prms);\n    })\n        .then(function () {\n        return { success: true };\n    });\n}\n//# sourceMappingURL=remove.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { determineOwner } from \"./helpers\";\n/**\n * Protect an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/protect.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to protect an item.\n */\nexport function protectItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/protect\";\n        return request(url, requestOptions);\n    });\n}\n/**\n * Unprotect an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/unprotect.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to unprotect an item.\n */\nexport function unprotectItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/unprotect\";\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=protect.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { determineOwner } from \"./helpers\";\n/**\n * ```js\n * import { removeItem } from \"@esri/arcgis-rest-portal\";\n * //\n * removeItem({\n *   id: \"3ef\",\n *   authentication\n * })\n * ```\n * Delete an item from the portal. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item.\n */\nexport function removeItem(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/delete\";\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { removeItemRelationship } from \"@esri/arcgis-rest-portal\";\n * //\n * removeItemRelationship({\n *   originItemId: '3ef',\n *   destinationItemId: 'ae7',\n *   relationshipType: 'Service2Layer',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Remove a relationship between two items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-relationship.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function removeItemRelationship(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/deleteRelationship\";\n        var options = appendCustomParams(requestOptions, [\"originItemId\", \"destinationItemId\", \"relationshipType\"], { params: __assign({}, requestOptions.params) });\n        return request(url, options);\n    });\n}\n/**\n * Remove a resource associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item resource.\n */\nexport function removeItemResource(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + owner + \"/items/\" + requestOptions.id + \"/removeResources\";\n        // mix in user supplied params\n        requestOptions.params = __assign(__assign({}, requestOptions.params), { resource: requestOptions.resource });\n        // only override the deleteAll param specified previously if it is passed explicitly\n        if (typeof requestOptions.deleteAll !== \"undefined\") {\n            requestOptions.params.deleteAll = requestOptions.deleteAll;\n        }\n        return request(url, requestOptions);\n    });\n}\n/**\n * ```js\n * import { removeFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * removeFolder({\n *   folderId: \"fe4\",\n *   owner: \"c@sey\",\n *   authentication\n * })\n *   .then(response)\n *\n * ```\n * Delete a non-root folder and all the items it contains. See the [REST\n * Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-folder.htm) for\n * more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes a folder\n */\nexport function removeFolder(requestOptions) {\n    return determineOwner(requestOptions).then(function (owner) {\n        var url = getPortalUrl(requestOptions) + \"/content/users/\" + encodeURIComponent(owner) + \"/\" + requestOptions.folderId + \"/delete\";\n        return request(url, requestOptions);\n    });\n}\n//# sourceMappingURL=remove.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { __assign } from \"tslib\";\nimport { searchItems } from \"@esri/arcgis-rest-portal\";\n/**\n * Search for Initiatives\n *\n * @export\n * @param {ISearchOptions} searchRequestOptions\n * @returns {Promise<ISearchResult>}\n */\nexport function searchInitiatives(searchRequestOptions) {\n    // since we are mutating the q, make a copy first...\n    var opts = __assign({}, searchRequestOptions);\n    //  inject the type...\n    if (opts.q) {\n        opts.q = opts.q + \" AND type: Hub Initiative\";\n    }\n    else {\n        opts.q = \"type: Hub Initiative\";\n    }\n    return searchItems(opts);\n}\n/**\n * Search for Initiative Templates\n *\n * @export\n * @param {ISearchOptions} searchRequestOptions\n * @returns {Promise<ISearchResult>}\n */\nexport function searchInitiativeTemplates(searchRequestOptions) {\n    // since we are mutating the q, make a copy first...\n    var opts = __assign({}, searchRequestOptions);\n    // inject the type and typeKeywords\n    if (opts.q) {\n        opts.q = opts.q + \" AND type: Hub Initiative AND typekeywords:hubInitiativeTemplate\";\n    }\n    else {\n        opts.q = \"type: Hub Initiative AND typekeywords:hubInitiativeTemplate\";\n    }\n    return searchItems(opts);\n}\n//# sourceMappingURL=search.js.map","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { updateModel } from \"./model\";\n/**\n * Update an existing Initiative Model\n * @param model\n * @param requestOptions\n * @returns {Promise<IInitiativeModel>}\n */\nexport function updateInitiative(model, requestOptions) {\n    return updateModel(model, requestOptions);\n}\n//# sourceMappingURL=update.js.map","import { getProp, isGuid } from \"@esri/hub-common\";\nimport { updateItem, getItem } from \"@esri/arcgis-rest-portal\";\n/**\n * Update the Site associated with an Initiative by setting the\n * `item.properties.siteId` to a new value\n *\n * Used during createSite(...) and any time we need to\n * connect a different Site to an Initiative\n *\n * @param initiativeItemId string | IItem | IModel\n * @param siteId string\n * @param hubRequestOptions IHubRequestOptions\n */\nexport function updateInitiativeSiteId(maybeModel, siteId, hubRequestOptions) {\n    // assume it's an IItem\n    var itemPromise = Promise.resolve(maybeModel);\n    // if we got a string, treat it as an id\n    if (typeof maybeModel === \"string\") {\n        if (!isGuid(maybeModel)) {\n            return Promise.reject(new Error(\"updateInitiativeSiteId was passed a string that is not a GUID.\"));\n        }\n        else {\n            itemPromise = getItem(maybeModel, {\n                authentication: hubRequestOptions.authentication\n            });\n        }\n    }\n    else {\n        // if it's an IModel it will have `.item.id` defined\n        if (getProp(maybeModel, \"item.id\")) {\n            var m = maybeModel;\n            itemPromise = Promise.resolve(m.item);\n        }\n    }\n    // kick off the promise that will return an IItem\n    return itemPromise.then(function (item) {\n        // oddly, IItem does not have .properties even as an optional O_o\n        // regardless, ensure .properties exists\n        if (!item.properties) {\n            item.properties = {};\n        }\n        // set the siteId\n        item.properties.siteId = siteId;\n        // and... update the item\n        return updateItem({\n            item: item,\n            authentication: hubRequestOptions.authentication\n        });\n    });\n}\n//# sourceMappingURL=update-initiative-site-id.js.map"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__assign","assign","t","s","i","n","arguments","length","prototype","call","apply","this","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","e","rejected","result","done","then","__generator","body","f","y","_","label","sent","trys","ops","g","verb","throw","return","Symbol","iterator","v","op","TypeError","pop","push","__spreadArrays","il","r","k","a","j","jl","requiresFormData","params","keys","some","key","toParam","constructor","name","processParams","newParams","forEach","param","firstElementType","_b","_a","JSON","stringify","join","valueOf","isArray","encodeQueryString","map","encodeParam","arrayElem","encodeURIComponent","ArcGISRequestError","message","code","response","url","options","originalMessage","warn","console","create","Error","_super","NODEJS_DEFAULT_REFERER_HEADER","DEFAULT_ARCGIS_REQUEST_OPTIONS","httpMethod","ArcGISAuthError","__","retry","getSession","retryLimit","retryRequest","_this","session","newOptions","authentication","tries","request","catch","requestOptions","headers","missingGlobals","recommendedPackages","fetch","bind","Function","FormData","rawResponse","originalAuthError","fetchOptions","method","credentials","indexOf","getToken","err","token","getDomainCredentials","forceFormData","formData_1","requestHeaders","hideToken","window","urlWithQueryString","maxUrlLength","RegExp","test","useFormData","filename","Blob","append","referer","status_1","statusText","ok","status","json","text","blob","data","truncatedUrl","error","messageCode","errorCode","parse","statusMessage","checkForErrors","toLowerCase","split","federatedServers","expires","Date","now","appendCustomParams","customOptions","baseOptions","reduce","geometryService$1","AGO_GEOMETRY_SERVICE","getUrl","portal","portalService","getProp","shouldAddTokenToCall","project","serviceUrl","inSR","outSR","geometryType","geometries","opts","transformForward","transformation","getPortalUrl","trim","slice","serializeItem","item","clone","file","determineOwner","owner","getUsername","updateItem","folderId","id","createItem","multipart","baseUrl","getItem","getItemBaseUrl","portalUrlOrRequestOptions","getUserMembership","groupId","group","userMembership","memberType","SearchQueryBuilder","match","terms","_i","termStack","concat","in","field","hasRange","hasTerms","q","commit","startGroup","openGroups","endGroup","and","addModifier","or","not","from","term","rangeStack","to","boost","num","cleanup","modifier","currentModifer","toUpperCase","needsQuotes","formatTerm","getTime","undefined","defineProperty","get","enumerable","configurable","oldQ","replace","genericSearch","search","searchType","path","nextStart","nextPage","start","searchItems","chunk","array","size","chunks","addGroupUsers","admins","users","promises","_prepareRequests","errors","all","_consolidateRequestResults","type","usernames","results","notAdded","filter","collection","consolidated","removeGroupUsers","usersToRemove","usersChunk","filtered","propName","notRemoved","updateUserMemberships","newMemberType","getUser","username","getUserUrl","shareItemWithGroup","sortField","searchResponse","total","itm","isShared","itemId","shortcut","notSharedWith","isAdmin_1","isCrossOrgSharing_1","confirmItemControl","itemOwner","currentUser","ownerUser","membership","isSharedEditingGroup","role","roleId","orgId","isAdmin","membershipGuarantees","favGroupId","ensureMembership","membershipAdjustments","revert","promise","sharingResults","shareToGroup","sharingResponse","isCrossOrgSharing","groups","shouldPromote","errorMessage","ownerGroups","find","acc","entry","success","membershipResponse","getSelf","getPortal","idOrSelf","createRequestOptions","model","cloneObject","INITIATIVE_TYPE_NAME","addInitiative","upgradeToOneDotOne","portalUrl","properties","schemaVersion","assets","getResourceUrl","fileName","mimeType","license","values","bannerImage","source","display","position","x","resourceName","folder","convertIndicatorToDefinition","ind","fieldName","optional","definition","description","supportedTypes","layerOptions","geometryTypes","fields","convertIndicatorField","tooltip","flattenField","alias","extractIndicators","prop","obj","convertIndicator","indicator","layerId","mappings","convertStep","templates","items","title","templateIds","byId","itemIds","upgradeToTwoDotZero","clone_1","steps","stepName","indicators","upgradeToTwoDotTwo","templateIdsFromSteps","getTemplateIdsFromSteps","recommendedTemplates","allTemplateIds","CURRENT_SCHEMA_VERSION","migrateSchema","curVersion","isTemplate_1","typeKeywords","configurationSettings","config","stepCategory","el","category","collaborationGroupId","getInitiative","emptyResponseErr","getPortalApiUrl","removeInitiativeGroup","ex","checkGroupExists","exists","createInitiativeModelFromTemplate","template","tags","without","initialParent","groupIds","initiativeKey","copyImageResources","sourceItemId","targetItemId","itemResourceUrl","assetPromises","assetName","addImageAsResource","copyEmbeddedImageResources","asset","resource","resourcesPrefix","prefix","content","access","private","detachSiteFromInitiative","siteId","site","parentInitiativeId","convertInitiativeToTemplate","hubRequestOptions","templateItem","normalizeSolutionTemplateItem","extent","contentGroupId","followersGroupId","followerGroups","openDataGroupId","propifyString","createId","stepTmpl","resources","getUserTag","initiativeId","getUpdateUrl","currentlyFollowedInitiativesByGroupMembership","user","initiativeIdFromGroupTag","isUserFollowing","currentlyFollowedInitiatives","initiativeIdFromUserTag","tag","unique","DEFAULT_INITIATIVE_TEMPLATE","snippet","culture","getDefaultInitiativeTemplate","getCulture","locale","convertToWellKnownLocale","fetchHubTranslation","portalSelf","translation","tmpl","ro","state","camelize","templateItemModel","initiativeModel","newModel","indicatorsHash","sortOrder","createOpts","isOpenData","isSharedEditing","capabilities","_edit_privacy","_edit_contributors","protectOpts","initiative","hasFollowersGroup","groupJoinResponse","siteTemplate","tmplPromise","getHubApiUrl","getUniqueGroupName","proposedName","prms","hasSite","initiativeOwner","protected","searchRequestOptions","index","splice","groupLeaveResponse","maybeModel","itemPromise","isGuid"],"mappings":"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"}